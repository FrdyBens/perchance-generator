[retain(root, "@inputs")]
<! Yup With That Way! -->
<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" />

    <!-- Primary Meta Tags -->
    <title>URVILLAIN Imagine – Advanced AI Art & Image Generator</title>
    <meta name="title" content="URVILLAIN Imagine – Advanced AI Art & Image Generator" />
    <meta name="description" content="Generate images instantly with URVILLAIN Imagine — free to use, no login or API key required, unlimited generations with the powerful Flux Schnell model." />

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website" />
    <meta property="og:url" content="https://perchance.org/urvillain-imagine" />
    <meta property="og:title" content="URVILLAIN Imagine – Advanced AI Art & Image Generator" />
    <meta property="og:description" content="Free image generation with Flux Schnell model. No login, no API key, and unlimited generations." />
    <meta property="og:image" content="https://user.uploads.dev/file/a081e6f6a57970899c214fde818b7a4d.jpg" />
    <meta property="og:image:width" content="1200" />
    <meta property="og:image:height" content="630" />

    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image" />
    <meta property="twitter:url" content="https://perchance.org/urvillain-imagine" />
    <meta property="twitter:title" content="URVILLAIN Imagine – Advanced AI Art & Image Generator" />
    <meta property="twitter:description" content="Free image generation with Flux Schnell model. No login, no API key, and unlimited generations." />
    <meta property="twitter:image" content="https://user.uploads.dev/file/a081e6f6a57970899c214fde818b7a4d.jpg" />

    <!-- Meta Keywords -->
    <meta
      name="keywords"
      content="AI image generation for free, free text to image, free ai image, AI image generator, URVILLAIN, Flux Schnell, free AI image generator, free AI image, AI art free, no login AI generator, no API key AI, unlimited AI image generator, AI image online, generate image with AI, AI-powered image tool, text-to-image online, instant AI image, free text to image generator, realistic AI image, high quality AI art, open access AI image tool, creative AI image maker, Flux Schnell image generation, AI without signup, AI art generator no limit"
    />

    <!-- Favicon Plugin from Perchance -->
    [favicon("https://user.uploads.dev/file/bb9eaa69cf52c1de1ffcb00e91ae8082.png")]

    <link rel="apple-touch-icon" href="https://user.uploads.dev/file/78681e036e183f78ec57eafa54413905.png" />
    <link rel="icon" type="image/png" href="https://user.uploads.dev/file/f37a7d70eb6cf3113695dd536f4ac40d.png" sizes="180x180" />
    <link rel="icon" type="image/png" href="https://user.uploads.dev/file/affe2a573240f1beb78b45bde5325480.png" sizes="32x32" />
    <link rel="icon" type="image/png" href="https://user.uploads.dev/file/cb7d0a2b3b882b66cffcb702502ba624.png" sizes="16x16" />
    <link rel="manifest" href="https://files.catbox.moe/ve3kjz.webmanifest" />
    <!-- Title is replaced by a responsive image -->
    <img
      src="https://user.uploads.dev/file/70d8482d5c18dd84ab9f544932b98e08.png"
      alt="URVILLAIN Imagine – Advanced AI Art & Image Generator"
      style="display: block; max-width: 100%; height: auto; margin: 0 auto; user-select: none; -webkit-user-drag: none;"
    />

    <!-- Running text loop -->
    <marquee id="runningText" behavior="scroll" direction="left" style="color: #fff; font-size: 0.725rem; letter-spacing: 0.1em; padding: 1rem 0; background-color: rgba(0, 0, 0, 0.5); font-family: 'Nena Serif Regular';">
      Sometimes the wildest imaginations come from the simplest words.
    </marquee>

    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css" />

    <!-- Ai Chat -->
    <p style="margin-top: 1em; margin-bottom: 1.5em;" ;>
      A cutting-edge AI assistant at
      <a href="https://mirexa.vercel.app" style="background: linear-gradient(90deg, #ffffff, #007bff, #8a2be2); -webkit-background-clip: text; color: transparent; text-decoration: none; font-weight: bold;" target="_blank">Mirexa AI</a>
    </p>

    <script src="https://unpkg.com/lucide@latest"></script>
    <script>
      window.lucide.createIcons();
    </script>
    <style>
      .urv-icon {
        width: 16px;
        height: 16px;
        aspect-ratio: 1/1;
        margin-right: 0.6em;
        margin-left: 0.3em;
      }

      .spin {
        animation: spin 1s linear infinite;
      }
      @keyframes spin {
        to {
          transform: rotate(360deg);
        }
      }
    </style>
    <style>
      @import url("https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;700&display=swap");
      @import url("https://fonts.googleapis.com/css2?family=Audiowide&family=Bebas+Neue&family=Digital+7&family=Electrolize&family=Exo&family=Futura+Condensed&family=Neuropol&family=Orbitron&family=Press+Start+2P&family=Roboto+Mono&family=Space+Mono&family=Synthwave&family=Streetbrush&family=VT323&display=swap");
      @import url("https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap");
      @import url("https://fonts.googleapis.com/css2?family=Google+Sans:wght@400;500;700&display=swap");

      body {
        margin: 0;
        padding: 0;
        background: radial-gradient(circle, #0d0d24, #181831, #12121c);
        color: #eaeaea;
        font-family: "DM Sans", sans-serif;
        font-size: 80%;
        transition: background 0.5s ease;
        overflow-y: auto;
      }

      h1 {
        text-align: center;
        color: #cb9952;
        font-size: 2.5rem;
        margin-top: 1.5rem;
        animation: twinkle 3s infinite;
      }

      @keyframes twinkle {
        0% {
          color: var(--primary-color, #cb9952);
        }
        25% {
          color: #00ffff;
        }
        50% {
          color: #00bfff;
        }
        75% {
          color: #ffff00;
        }
        100% {
          color: var(--primary-color, #cb9952);
        }
      }

      @keyframes ellipsis {
        0%,
        100% {
          content: "";
        }

        33% {
          content: ".";
        }

        66% {
          content: "..";
        }
      }

      .imagining-ellipsis::after {
        content: "...";
        animation: ellipsis 2.2s infinite;
      }

      .input-container {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        gap: 0.3rem;
        margin: 0.5rem 1.5rem;
        position: relative;
        margin-bottom: 1.5rem;
      }

      .input-container textarea,
      .input-container input[type="text"] {
        resize: vertical;
        min-height: 45px;
        max-height: 200px;
        padding: 0.8rem;
        max-width: 400px;
        width: 100%;
        background: #222;
        border: 1px solid #444;
        border-radius: 0.5rem;
        color: #eaeaea;
        font-size: 14px;
        outline: none;
        transition: all 0.3s ease;
        padding-right: 2rem;
        overflow: auto;
      }

      .input-container textarea:focus,
      .input-container input[type="text"]:focus {
        border-color: var(--primary-color, #cb9952);
        box-shadow: 0 0 10px var(--primary-color, #cb9952);
      }

      .icon-container {
        display: flex;
        justify-content: flex-end;
        width: 100%;
        margin-top: 0.5rem;
        transition: all 0.5s ease;
      }

      .input-container .brain-icon,
      .input-container .clear-icon {
        font-size: 1rem;
        cursor: pointer;
        color: var(--primary-color, #cb9952);
        margin-right: 0.6rem;
        transition: transform 0.3s ease;
      }

      .input-container .clear-icon {
        color: #00ffff;
        margin-left: 0.6rem;
      }

      .icon-container .brain-icon:hover,
      .icon-container .clear-icon:hover {
        transform: scale(1.1);
      }

      @keyframes keyPress {
        0%,
        100% {
          transform: none;
        }
        50% {
          transform: scale(0.9);
        }
      }

      .input-container .clear-icon:hover {
        animation: keyPress 0.3s ease;
        color: #555;
      }

      .imagine-btn {
        background: var(--primary-color, #cb9952);
        color: black;
        border: none;
        padding: 0.3rem 0.9rem;
        font-size: 1rem;
        border-radius: 0.1rem;
        cursor: pointer;
        transition: transform 0.3s ease, background 0.3s ease;
        margin-top: 0.5rem;
        margin-bottom: 1rem;
        display: block;
        margin-left: auto;
        margin-right: auto;
        position: relative;
      }

      .imagine-btn:hover {
        background: #bd5d9c;
        transform: translateY(-2px);
      }

      .tabs {
        display: flex;
        justify-content: center;
        gap: 0rem;
        margin: 0rem 0;
      }

      .tab {
        padding: 0.5rem 1rem;
        background: #f2f2f2; /* Inactive tab background: faded white */
        color: #aaa;
        font-size: 0.9rem;
        cursor: pointer;
        border-bottom: 2px solid transparent;
        transition: color 0.3s ease, border-bottom 0.3s ease, background 0.3s ease;
      }

      .tab.active {
        color: var(--primary-color, #cb9952);
        border-bottom: 2px solid var(--primary-color, #cb9952);
        background: #22222b; /* Active tab matches content background */
      }

      .tab-content {
        max-height: 0;
        overflow: hidden;
        opacity: 0;
        transition: max-height 0.6s ease, opacity 0.6s ease;
        padding: 0 2rem;
        background: #22222b;
        border-radius: 0;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
      }

      .tab-content.active {
        max-height: 1000px;
        opacity: 1;
        padding: 1rem 2rem;
      }

      .style-options,
      .UserEl-options {
        display: flex;
        overflow-x: auto;
        padding: 1rem 0;
      }

      .style-option-container {
        display: inline-block;
        margin: 1rem 1rem 1rem 0;
        text-align: center;
        padding: 0.5rem;
        border: 1px solid #444;
        border-radius: 0.5rem;
        transition: border-color 0.3s ease, box-shadow 0.3s ease;
      }

      .style-option-container:hover {
        border-color: var(--primary-color, #cb9952);
        box-shadow: 0 0 10px var(--primary-color, #cb9952);
      }

      .style-option {
        width: 100px;
        height: 100px;
        border-radius: 0.5rem;
        overflow: hidden;
        cursor: pointer;
      }

      .style-option-name {
        margin-top: 0.5rem;
        font-size: 0.75rem;
        color: #aaa;
      }

      .menu-btn {
        position: fixed;
        bottom: 1.5rem;
        right: 1.5rem;
        background: var(--primary-color, #cb9952);
        color: #fff;
        border: none;
        border-radius: 50%;
        width: 3rem;
        height: 3rem;
        box-shadow: 0 4px 15px rgba(255, 107, 107, 0.4);
        font-size: 1.5rem;
        cursor: pointer;
        transition: transform 0.3s ease, box-shadow 0.3s ease;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        gap: 0.2rem;
      }

      .menu-btn div {
        width: 70%;
        height: 3px;
        background: #fff;
        transition: transform 0.3s ease, opacity 0.3s ease;
      }

      .menu-btn.active div:nth-child(1) {
        transform: translateY(7px) rotate(45deg);
      }

      .menu-btn.active div:nth-child(2) {
        opacity: 0;
      }

      .menu-btn.active div:nth-child(3) {
        transform: translateY(-7px) rotate(-45deg);
      }

      .menu-content {
        display: none;
        flex-direction: column;
        position: fixed;
        bottom: 6rem;
        right: 1.5rem;
        background: #222;
        border-radius: 0.5rem;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.4);
        padding: 1rem;
        gap: 0.8rem;
        transition: transform 0.3s ease, opacity 0.3s ease;
        transform: scale(0.9);
        opacity: 0;
      }

      .menu-content.active {
        display: flex;
        transform: scale(1);
        opacity: 1;
      }

      .menu-content button {
        background: #181831;
        border: none;
        padding: 0.8rem 1.2rem;
        color: #eaeaea;
        border-radius: 0.5rem;
        cursor: pointer;
        transition: background 0.3s ease, transform 0.3s ease;
      }

      .menu-content button:hover {
        background: var(--primary-color, #cb9952);
        transform: translateX(5px);
      }

      .menu-content select {
        background: #181831;
        border: none;
        padding: 0.8rem;
        color: #eaeaea;
        border-radius: 0.5rem;
        cursor: pointer;
        transition: background 0.3s ease;
      }

      .menu-content select:hover {
        background: var(--primary-color, #cb9952);
      }

      .lock-button {
        position: absolute;
        top: 50%;
        right: 10px;
        transform: translateY(-50%);
        background: transparent;
        border: none;
        cursor: pointer;
      }

      .lock-button i {
        font-size: 20px;
      }

      input[readOnly] {
        background-color: #f0f0f0;
        cursor: not-allowed;
      }
      .popup {
        display: none;
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: #222;
        border-radius: 0.5rem;
        padding: 2rem;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);
        text-align: center;
        transition: opacity 0.5s ease;
        z-index: 10;
      }

      .popup.fade-out {
        opacity: 0;
        transition: opacity 0.5s ease;
      }

      .popup .close-btn {
        position: absolute;
        top: 0.5rem;
        right: 0.5rem;
        background: transparent;
        color: var(--primary-color, #cb9952);
        border: none;
        font-size: 1.5rem;
        cursor: pointer;
        transition: color 0.3s ease;
      }

      .popup .close-btn:hover {
        color: #fff;
      }

      button#generateBtn,
      #completionPopupEl button {
        background: #333333;
        color: #ffffff;
        border: none;
        padding: 0.5rem 0.8rem;
        font-size: 0.9rem;
        border-radius: 2px;
        cursor: pointer;
        transition: transform 0.3s ease, background 0.3s ease;
        margin-top: 1rem;
        display: block;
        margin-left: auto;
        margin-right: auto;
        position: relative;
      }

      button#generateBtn:hover,
      #completionPopupEl.button:hover {
        background: #4d4d4d;
        transform: translateY(-2px);
      }

      button#generateBtn.generating {
        background: #4d4d4d;
        transition: background 0.3s ease;
      }

      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(-20px);
        }

        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      @keyframes fadeOut {
        from {
          opacity: 1;
          transform: translateY(0);
        }

        to {
          opacity: 0;
          transform: translateY(-20px);
        }
      }

      .slider-container {
        margin: 2rem 0;
        padding: 1rem;
        background: #222;
        border-radius: 0.5rem;
        border: 1px solid #444;
        display: flex;
        gap: 1rem;
      }

      .slider-label {
        display: block;
        margin-bottom: 0.5rem;
        color: #aaa;
      }

      input[type="range"] {
        -webkit-appearance: none;
        appearance: none;
        width: 100%;
        height: 20px;
        background: #444;
        outline: none;
        opacity: 0.7;
        transition: opacity 0.2s;
      }

      input[type="range"]:hover {
        opacity: 1;
      }

      input[type="range"]::-webkit-slider-thumb {
        -webkit-appearance: none;
        appearance: none;
        width: 20px;
        height: 20px;
        background: var(--primary-color, #cb9952);
        cursor: pointer;
      }

      input[type="range"]::-moz-range-thumb {
        width: 20px;
        height: 20px;
        background: var(--primary-color, #cb9952);
        cursor: pointer;
      }

      .output {
        border: 2px solid var(--primary-color, #cb9952);
        border-radius: 0.5rem;
        padding: 1rem;
        margin-top: 1rem;
        background: rgba(255, 107, 107, 0.1);
        box-shadow: 0 0 10px rgba(255, 107, 107, 0.3);

        /* Grid 2x2 */
        /*grid-template-columns: 1fr 1fr !important;
        grid-template-rows: 1fr 1fr !important;*/
        gap: 1rem !important; /* Jarak antar grid item */
      }

      .output iframe {
        font-size: 0.75rem !important;
        border-radius: 5px;
        border-color: 2px solid var(--primary-color, #cb9952);
      }

      /* Desktop standar */
      @media (min-width: 1024px) {
        .output {
          grid-template-columns: repeat(4, 1fr) !important;
          grid-template-rows: repeat(4, 1fr) !important;
          gap: 1rem;
        }
      }

      /* Tablet landscape dan laptop kecil */
      @media (min-width: 768px) and (max-width: 1023px) {
        .output {
          grid-template-columns: repeat(3, 1fr) !important;
          grid-template-rows: repeat(3, 1fr) !important;
          gap: 1rem;
        }
      }

      .style-option.selected,
      .UserEl-option.selected {
        border: 2px solid var(--primary-color, #cb9952);
        box-shadow: 0 0 10px var(--primary-color, #cb9952);
      }

      .style-options::-webkit-scrollbar,
      .UserEl-options::-webkit-scrollbar {
        height: 8px;
      }

      .style-options::-webkit-scrollbar-thumb,
      .UserEl-options::-webkit-scrollbar-thumb {
        background-color: #444;
        border-radius: 10px;
      }

      .style-options::-webkit-scrollbar-thumb:hover,
      .UserEl-options::-webkit-scrollbar-thumb:hover {
        background-color: var(--primary-color, #cb9952);
      }

      .submenu-container {
        display: flex;
        justify-content: center;
        gap: 0.5rem;
        margin-bottom: 1rem;
      }

      .submenu {
        padding: 0.6rem 1rem;
        background: transparent;
        border: none;
        color: #aaa;
        font-size: 0.9rem;
        cursor: pointer;
        border-bottom: 2px solid transparent;
        transition: color 0.3s ease, border-bottom 0.3s ease;
      }

      .submenu.active {
        color: var(--primary-color, #cb9952);
        border-bottom: 2px solid var(--primary-color, #cb9952);
      }

      #nsfwPopup {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.8);
        backdrop-filter: blur(5px);
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 1000;
      }

      #nsfwPopupContent {
        background: #121212;
        color: #eaeaea;
        padding: 20px;
        border-radius: 10px;
        max-width: 600px;
        text-align: center;
      }

      #nsfwPopup button {
        background: var(--primary-color, #cb9952);
        color: white;
        border: none;
        padding: 10px 20px;
        border-radius: 5px;
        cursor: pointer;
        transition: transform 0.3s ease;
      }

      #nsfwPopup button:hover {
        transform: scale(1.05);
      }

      .comments-section {
        width: 100%;
        height: 100%;
        overflow-y: auto;
      }

      #toggleGalleryBtn {
        background: #181831;
        color: #fff;
        border: none;
        padding: 0.8rem;
        font-size: 1rem;
        cursor: pointer;
        border-radius: 0.5rem;
        margin: 1rem auto;
        display: block;
        transition: background 0.3s ease, transform 0.3s ease;
      }

      #toggleGalleryBtn:hover {
        background: #555;
        transform: translateY(-2px);
      }

      .gallery {
        max-height: 0;
        overflow: hidden;
        transition: max-height 0.6s ease, opacity 0.6s ease;
        opacity: 0;
        margin-top: 15px;
      }

      .gallery.active {
        max-height: 1000px;
        opacity: 1;
      }

      #commentsPopupEl {
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        width: 80vw;
        height: 80vh;
        max-width: 800px;
        max-height: 600px;
        display: none;
        flex-direction: column;
        background: #181831;
        border-radius: 0.5rem;
        padding: 1rem;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);
        text-align: center;
        z-index: 1001;
      }

      #scrollTopBtn {
        position: fixed;
        bottom: 1.5rem;
        left: 1.5rem;
        background: var(--primary-color, #cb9952);
        color: #fff;
        border: none;
        border-radius: 50%;
        width: 3rem;
        height: 3rem;
        box-shadow: 0 4px 15px rgba(255, 107, 107, 0.4);
        font-size: 1.5rem;
        cursor: pointer;
        transition: transform 0.3s ease, box-shadow 0.3s ease;
        display: none;
        justify-content: center;
        align-items: center;
        z-index: 1002;
      }

      #scrollTopBtn:hover {
        transform: scale(1.1);
      }

      /* Scroll to Bottom */
      #scrollBottomBtn {
        position: fixed;
        bottom: 1.5rem;
        left: 1.5rem;
        background: var(--primary-color, #cb9952);
        color: #fff;
        border: none;
        border-radius: 50%;
        width: 3rem;
        height: 3rem;
        box-shadow: 0 4px 15px rgba(255, 107, 107, 0.4);
        font-size: 1.5rem;
        cursor: pointer;
        transition: transform 0.3s ease, box-shadow 0.3s ease;
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 1002;
      }

      #scrollBottomBtn:hover {
        transform: scale(1.1);
      }

      @keyframes slideInOut {
        from {
          transform: translateY(-10px);
          opacity: 0;
        }

        to {
          transform: translateY(0);
          opacity: 1;
        }
      }

      #scratchpad-bar {
        display: flex;
        justify-content: space-between;
        align-items: center;
        background-color: #222;
        padding: 8px 12px;
        border: 1px solid #444;
        border-radius: 0.5rem;
        color: #eaeaea;
        font-size: 1rem;
        outline: none;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        max-width: 400px;
        width: 100%;
        margin: auto;
      }

      #scratchpad-icon {
        display: flex;
        align-items: center;
        font-size: 14px;
      }

      #scratchpadToggleEl,
      #positivePromptToggleEl,
      #negativePromptToggleEl {
        background-color: #444;
        color: white;
        border: 1px solid #444;
        border-radius: 0.5rem;
        padding: 5px 10px;
        font-size: 14px;
        cursor: pointer;
      }

      #scratchpadToggleEl,
      #positivePromptToggleEl,
      #negativePromptToggleEl:hover {
        background-color: #555;
      }

      #scratchpadContainerEl,
      #positivePromptContainerEl,
      #negativePromptContainerEl {
        overflow: hidden;
        max-width: 400px;
        width: 100%;
        background-color: #f7f7f7;
        border-radius: 4px;
        padding: 0;
        opacity: 0;
        height: 0;
        transition: all 0.3s ease;
      }

      #scratchpadContainerEl.active,
      #positivePromptContainerEl.active,
      #negativePromptContainerEl.active {
        opacity: 1;
        height: auto;
        padding: 10px;
      }

      #scratchpadTextEl,
      #userPromptInput,
      #negativePromptInput {
        width: 100%;
        border: 1px solid #ccc;
        border-radius: 5px;
        padding: 8px;
        font-size: 14px;
        resize: vertical;
        font-family: Arial, sans-serif;
        color: black;
        background-color: white;
        box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.1);
      }

      #scratchpadSaveEl {
        margin-top: 5px;
        padding: 6px 10px;
        background-color: #333;
        color: white;
        border: none;
        border-radius: 5px;
        font-size: 10px;
        cursor: pointer;
        align-self: flex-end;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
      }

      #scratchpadSaveEl:hover {
        background-color: #555;
      }

      #negativePromptSectionEl {
        animation-duration: 0.3s;
      }

      #negativePromptSection.fade-in {
        animation-name: fadeIn;
      }

      #negativePromptSection.fade-out {
        animation-name: fadeOut;
      }

      .info-icon {
        margin-left: 8px;
        cursor: pointer;
        font-size: 14px;
        color: rgba(255, 255, 255, 0.6);
        position: relative;
        display: inline-block;
        user-select: none;
      }

      .info-icon:hover {
        color: rgba(255, 255, 255, 1);
      }

      .tooltip {
        visibility: hidden;
        width: 220px;
        background-color: #333;
        color: #fff;
        text-align: left;
        border-radius: 5px;
        padding: 8px;
        position: absolute;
        z-index: 1;
        top: 125%;
        left: 50%;
        transform: translateX(-50%);
        opacity: 0;
        transition: opacity 0.3s, visibility 0.3s;
      }

      .tooltip::after {
        content: "";
        position: absolute;
        bottom: 100%;
        left: 50%;
        margin-left: -5px;
        border-width: 5px;
        border-style: solid;
        border-color: transparent transparent #333 transparent;
      }

      .tooltip.visible {
        visibility: visible;
        opacity: 1;
      }

      .background-popup {
        display: none;
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: #222;
        border-radius: 0.5rem;
        padding: 1.5rem;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);
        z-index: 11;
        text-align: center;
      }

      .arrow-btn {
        background: var(--primary-color, #cb9952);
        border: none;
        padding: 0.5rem;
        border-radius: 0.5rem;
        cursor: pointer;
        margin: 0 0.5rem;
        transition: background 0.3s ease;
      }

      .arrow-btn:hover {
        background: #bd5d9c;
      }

      .background-popup .close-btn {
        position: absolute;
        top: 0.5rem;
        right: 0.5rem;
        background: transparent;
        color: var(--primary-color, #cb9952);
        border: none;
        font-size: 1.5rem;
        cursor: pointer;
        transition: color 0.3s ease;
      }

      .background-popup .close-btn:hover {
        color: #fff;
      }

      .set-background-btn {
        padding: 0.4rem 0.8rem;
        font-size: 0.9rem;
        background: var(--primary-color, #cb9952);
        border: none;
        border-radius: 0.5rem;
        cursor: pointer;
        transition: background 0.3s ease;
      }

      .set-background-btn:hover {
        background: #bd5d9c;
      }

      .theme-popup {
        display: none;
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: #222;
        border-radius: 0.5rem;
        padding: 2rem;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);
        z-index: 15;
        text-align: center;
      }

      .theme-popup .close-btn {
        position: absolute;
        top: 0.5rem;
        right: 0.5rem;
        background: transparent;
        color: var(--primary-color, #cb9952);
        border: none;
        font-size: 1.5rem;
        cursor: pointer;
        transition: color 0.3s ease;
      }

      .theme-popup .close-btn:hover {
        color: #fff;
      }

      input[type="color"] {
        margin-top: 1rem;
        cursor: pointer;
        -webkit-appearance: none;
        -moz-appearance: none;
        appearance: none;
        border: none;
        width: 100%;
        height: 30px;
        background: none;
      }

      input[type="color"]::-webkit-color-swatch-wrapper {
        padding: 0;
      }

      input[type="color"]::-webkit-color-swatch {
        border: none;
      }

      .theme-selector {
        display: inline-flex;
        align-items: center;
        justify-content: space-between;
        gap: 10px;
        background-color: #282830;
        padding: 10px;
        margin: 0;
        margin-top: 1rem;
        width: 100%;
        max-width: 400px;
      }

      .theme-label {
        display: flex;
        align-items: center;
        color: white;
        font-size: auto;
      }

      .theme-icon {
        width: 24px;
        height: 24px;
        margin-right: 5px;
      }

      .theme-dropdown {
        background: #d7d7d7;
        color: #1c1c1c;
        border: none;
        padding: 5px 10px;
        padding-right: 25px;
        border-radius: 1px;
        font-size: 80%;
        margin: 0;
        text-align: left;
        width: auto;
        max-width: 40%;
        box-sizing: border-box;
        cursor: pointer;
        transition: background 0.3s ease;
        appearance: none;
        background-image: url("https://user-uploads.perchance.org/file/cf812b13709b0dc75a2883c5153062eb.png");
        background-repeat: no-repeat;
        background-position: right 10px center;
        background-size: 10px;
      }

      .theme-dropdown:not(:focus) {
        color: #333333;
      }

      .theme-dropdown option {
        background-color: #f2f2f2;
        color: #333333;
      }

      .theme-dropdown:focus {
        color: #333333;
        background-color: #eaeaea;
        outline: none;
      }

      .theme-dropdown:active,
      .theme-dropdown:visited {
        color: #333333;
      }

      .theme-dropdown:hover {
        cursor: pointer;
        color: #111111;
        background-color: #d9d9d9;
      }

      input[type="color"]::-moz-color-swatch {
        border: none;
      }

      i {
        margin: 2px 5px; /* atas-bawah 5px, kiri-kanan 10px */
      }

      .urChatloadingScreenEl {
        position: fixed;
        inset: 0;
        z-index: 9999;
        background: #253455;
        display: flex;
        align-items: center;
        justify-content: center;
        width: 100vw;
        height: 100vh;
        transition: opacity 0.6s;
      }

      .fade-out {
        opacity: 0;
        pointer-events: none;
        transition: opacity 0.6s;
      }
      /* Font for the logo */
      @font-face {
        font-family: "Inversionz";
        src: url("https://user.uploads.dev/file/6948cd8901b92def4465f03de2abe6f2.ttf") format("truetype");
      }

      @font-face {
        font-family: "Nena Serif Regular";
        src: url("https://user.uploads.dev/file/79ea3bffbf9f735bd4ddc6853a3fbe64.ttf") format("trueType");
      }

      .animation-container {
        display: flex;
        flex-direction: column;
        align-items: center;
        position: relative;
        background: none;
      }

      /* urvillain styling */
      .urvillain {
        font-family: "Inversionz", sans-serif;
        font-size: 11dvw;
        display: flex;
        gap: 1vw;
        white-space: nowrap;
        align-items: center;
        opacity: 0;
        transform: translateY(-20px);
        animation: fadeInUp 1.2s ease-out forwards;
      }

      .urvillain span {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        animation: popIn 0.6s ease-out forwards;
        opacity: 0;
        position: relative;
        color: #ffffff;
      }

      /* Letters animation delays */
      .urvillain span:nth-child(1) {
        animation-delay: 0.3s;
      }
      .urvillain span:nth-child(2) {
        animation-delay: 0.6s;
      }
      .urvillain span:nth-child(3) {
        animation-delay: 0.9s;
      }
      .urvillain span:nth-child(4) {
        animation-delay: 1.2s;
      }
      .urvillain span:nth-child(5) {
        animation-delay: 1.5s;
      }
      .urvillain span:nth-child(6) {
        animation-delay: 1.8s;
      }
      .urvillain span:nth-child(7) {
        animation-delay: 2.1s;
      }
      .urvillain span:nth-child(8) {
        animation-delay: 2.4s;
      }
      .urvillain span:nth-child(9) {
        animation-delay: 2.7s;
      }

      /* PROJECT styling */
      .project {
        font-family: "Roboto", sans-serif;
        font-size: 3.5dvw;
        color: #bca284;
        opacity: 0;
        transform: translateY(20px);
        animation: fadeInUp 1.2s ease-out forwards;
        animation-delay: 2.4s;
        margin-top: 0.2vw;
        letter-spacing: 0.2vw;
        align-self: flex-end;
        transform: translateX(-1.5vw);
        text-transform: uppercase;
        font-weight: 300;
      }

      @media (max-width: 768px) {
        .project {
          font-size: 3.5dvw;
        }
      }

      @keyframes fadeInUp {
        from {
          opacity: 0;
          transform: translateY(20px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      @keyframes popIn {
        from {
          opacity: 0;
          transform: scale(0.8);
        }
        to {
          opacity: 1;
          transform: scale(1);
        }
      }

      /* Image Upload Styling */
      #imageUploadContainer input[type="file"]::-webkit-file-upload-button {
        background: #cb9952;
        color: white;
        border: none;
        border-radius: 0.4rem;
        padding: 0.4rem 1rem;
        cursor: pointer;
      }
      #imageUploadContainer input[type="file"] {
        background: #222;
        color: #eaeaea;
        border-radius: 0.4rem;
        border: 1px solid #444;
        padding: 0.2rem 0.5rem;
      }
      #imageUploadContainer img {
        border: 2px solid #cb9952;
        transition: box-shadow 0.3s;
      }
      #clearImageBtn:hover {
        background: #bd5d9c;
      }

      #keywordInput {
        width: 100%;
        min-height: 90px;
        max-height: 320px;
        padding: 0.8rem 1rem;
        font-size: 1.07rem;
        border: 1.5px solid #d4d7e2;
        border-radius: 0.6rem;
        background: #f7f8fa;
        color: #23272f;
        resize: vertical;
        box-sizing: border-box;
        outline: none;
        font-family: inherit;
        transition: border 0.2s, box-shadow 0.2s;
      }

      #keywordInput:focus {
        border-color: #cb9952;
        box-shadow: 0 0 0 2px #cb9952;
        background: #fff;
      }
    </style>
    <style>
      /* Center the tab content and limit its width */
      #UserElTab {
        margin: 0 auto;
        max-width: 900px;
        width: 100%;
        padding: 0 15px;
        box-sizing: border-box;
        overflow: auto;
      }

      .import-grid {
        margin-top: 10px;
        display: grid;
        grid-template-columns: repeat(var(--cols, 3), minmax(0, 1fr));
        gap: 10px;
        width: 100%;
        box-sizing: border-box;
      }

      .import-selector {
        display: flex;
        flex-direction: column;
        gap: 5px;
        background-color: #282830;
        padding: 8px;
        margin-bottom: 10px;
        width: 100%;
        min-width: 0; /* Critical for preventing overflow in grid */
        box-sizing: border-box;
      }

      .import-label {
        color: white;
        font-size: 0.7rem;
        margin-bottom: 2px;
      }

      .import-dropdown {
        background: #d7d7d7;
        color: #1c1c1c;
        border: none;
        padding: 5px 8px;
        padding-right: 25px;
        border-radius: 1px;
        font-size: 0.8rem;
        box-sizing: border-box;
        cursor: pointer;
        transition: background 0.3s ease;
        appearance: none;
        background-image: url("https://user-uploads.perchance.org/file/cf812b13709b0dc75a2883c5153062eb.png");
        background-repeat: no-repeat;
        background-position: right 8px center;
        background-size: 10px;
        width: 100%;
        max-width: 100%;
      }

      .import-dropdown:not(:focus) {
        color: #333333;
      }

      .import-dropdown option {
        background-color: #f2f2f2;
        color: #333333;
      }

      .import-dropdown:focus {
        color: #333333;
        background-color: #eaeaea;
        outline: none;
      }

      .import-dropdown:active,
      .import-dropdown:visited {
        color: #333333;
      }

      .import-dropdown:hover {
        cursor: pointer;
        color: #111111;
        background-color: #d9d9d9;
      }

      @media (max-width: 900px) {
        .import-grid {
          --cols: 2;
        }
      }
      @media (max-width: 600px) {
        .import-grid {
          --cols: 1;
        }
      }
    </style>
    <style>
      .profile-btn {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
        font-size: 0.8rem;
        padding: 8px 16px;
        border-radius: 2px;
        background: #f5f5f5;
        color: #555;
        width: fit-content;
        margin: 8px auto;
        cursor: pointer;
        transition: background 0.2s;
      }
      .profile-btn i {
        font-size: 1.1em;
        color: #555;
      }
      .profile-btn:hover {
        background: #e0e0e0;
      }
    </style>
    <style>
      #kofi-panel {
        display: none;
        flex-direction: column;
        align-items: center;
        position: fixed;
        left: 50%;
        bottom: 100px;
        transform: translateX(-50%);
        z-index: 1000;
        width: auto;
        min-width: unset;
        max-width: 100dvw;
        pointer-events: none;
      }
      #kofi-panel.open {
        display: flex;
        pointer-events: all;
      }
      .kofi-modal {
        background: #fff;
        border-radius: 14px;
        box-shadow: 0 8px 32px rgba(41, 171, 224, 0.1), 0 1.5px 12px rgba(0, 0, 0, 0.07);
        padding: 0;
        overflow: hidden;
        width: 320px;
        max-width: 95vw;
        opacity: 0;
        transform: translateY(18px) scale(0.97);
        pointer-events: none;
        transition: all 0.22s cubic-bezier(0.4, 0, 0.2, 1);
      }
      .kofi-modal.open {
        opacity: 1;
        transform: translateY(0) scale(1);
        pointer-events: all;
      }
      .kofi-close {
        background: none;
        border: none;
        color: #000;
        font-size: 1.1rem;
        padding: 4px 10px 2px 0;
        cursor: pointer;
        align-self: flex-end;
        transition: color 0.18s;
        line-height: 1;
      }
      .kofi-close:hover {
        color: #1a7fa5;
      }
      .kofi-close i {
        color: #000;
      }

      @media (max-width: 500px) {
        .kofi-modal {
          width: 75vw !important;
          max-width: 95vw;
          min-width: unset;
        }
      }
    </style>
    <style>
      :root {
        --accent-color: #323232;
        --bg-hover: #f3f3f3;
      }
      .modal-backdrop {
        position: fixed;
        top: 0;
        left: 0;
        width: calc(100vw);
        height: calc(100vh);
        z-index: 99;
        display: flex;
        align-items: center;
        justify-content: center;
        background: rgba(60, 60, 70, 0.08);
        backdrop-filter: blur(0.5px);
      }

      .modal-content {
        background: white;
        padding: 2rem;
        border-radius: 0.95em;
        font-family: sans-serif;
        min-width: 320px;
        text-align: left;
        color: #262626;
      }
      @media (max-width: 600px) {
        .modal-content {
          min-width: auto;
          width: max(90vw, 270px);
          padding: 1rem;
        }
      }
      .close-modal-btn {
        float: right;
        border: none;
        background: none;
        font-size: 20pt;
        margin-left: auto;
        color: #999;
        padding-bottom: 0.14em;
      }
      .close-modal-btn:hover {
        color: black;
      }
    </style>
    <style>
      #changelogBtn {
        position: fixed;
        top: 50%;
        right: 1.5rem;
        transform: translateY(-50%);
        background: var(--primary-color, #cb9952);
        color: #fff;
        border: none;
        border-radius: 50%;
        width: 3rem;
        height: 3rem;
        box-shadow: 0 4px 15px rgba(255, 107, 107, 0.4);
        font-size: 1.5rem;
        cursor: pointer;
        transition: transform 0.3s ease, box-shadow 0.3s ease;
        display: none;
        justify-content: center;
        align-items: center;
        z-index: 1002;
      }

      #changelogBtn:hover {
        transform: translateY(-50%) scale(1.1);
      }
    </style>
    <style>
      .resetBoxes-btn {
        padding: 5px auto;
        margin-top: 5px;
        margin-bottom: 10px;
        border: none;
        border-radius: 2px;
        background-color: #c23b22;
      }
    </style>
    <style>
      /* Styling untuk Popup Utama */
      .web-theme-popup {
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%) scale(0.95); /* Mulai sedikit kecil untuk efek zoom */
        width: 90%;
        max-width: 450px; /* Lebar maksimum popup */
        background-color: #ffffff;
        border-radius: 12px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        z-index: 1000;
        overflow: hidden; /* Untuk border-radius pada header */
        display: none; /* Defaultnya tersembunyi */
        opacity: 0;
        transition: opacity 0.3s ease, transform 0.3s ease;
      }

      .web-theme-popup.active {
        display: block;
        opacity: 1;
        transform: translate(-50%, -50%) scale(1); /* Kembali ke ukuran normal */
      }

      .web-theme-popup-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 15px 20px;
        background-color: #f0f0f0; /* Warna header sedikit berbeda */
        border-bottom: 1px solid #e0e0e0;
      }

      .web-theme-popup-header h2 {
        margin: 0;
        font-size: 1.25rem;
        color: #333;
      }
      .web-theme-popup-header h2 i {
        margin-right: 10px;
        color: #007bff;
      }

      .close-main-btn {
        background: none;
        border: none;
        font-size: 1.5rem;
        color: #888;
        cursor: pointer;
        padding: 5px;
        line-height: 1;
      }
      .close-main-btn:hover {
        color: #333;
      }

      .web-theme-popup-content {
        padding: 20px;
        max-height: 70vh; /* Batasi tinggi konten agar bisa di-scroll jika perlu */
        overflow-y: auto; /* Aktifkan scroll jika konten melebihi max-height */
      }

      .theme-section {
        margin-bottom: 25px;
      }
      .theme-section:last-child {
        margin-bottom: 0;
      }

      .theme-section h3 {
        font-size: 1.1rem;
        color: #555;
        margin-top: 0;
        margin-bottom: 15px;
        border-bottom: 1px solid #eee;
        padding-bottom: 8px;
      }
      .theme-section h3 i {
        margin-right: 8px;
        color: #007bff; /* Sesuaikan warna ikon section */
      }

      .controls-group {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 15px;
      }
      .controls-group label {
        font-size: 0.95rem;
        color: #444;
        margin-right: 10px;
      }

      .arrow-btn i {
        color: #555;
      }

      /* Styling untuk input dan select yang ada (tidak mengubah ID/Class) */
      #bgUrlInput,
      #fontSelectEl {
        width: 100%; /* Buat input dan select mengambil lebar penuh dalam konteksnya */
        padding: 10px;
        border: 1px solid #ccc;
        border-radius: 5px;
        font-size: 0.95rem;
        box-sizing: border-box; /* Penting agar padding tidak menambah lebar total */
        color: #000000; /* Dari style inline #bgUrlInput */
      }
      /* Khusus untuk #bgUrlInput jika berada dalam .controls-group */
      .controls-group #bgUrlInput {
        flex-grow: 1; /* Biarkan input mengambil sisa ruang */
      }

      #colorPicker {
        width: 60px; /* Lebar yang cukup untuk color picker */
        height: 35px;
        border: 1px solid #ccc;
        border-radius: 5px;
        padding: 2px; /* Sedikit padding internal untuk color picker */
        cursor: pointer;
      }

      .arrow-btn {
        background-color: #e9ecef;
        color: #333;
        border: 1px solid #ced4da;
        padding: 8px 12px;
        border-radius: 5px;
        cursor: pointer;
        margin: 0 3px; /* Jarak antar arrow button */
        transition: background-color 0.2s ease;
      }
      .arrow-btn:hover {
        background-color: #dee2e6;
      }
      .arrow-btn i {
        font-size: 0.9em;
      }

      .set-background-btn,
      .action-btn {
        /* Menggunakan .action-btn sebagai kelas umum jika ada tombol aksi lain */
        display: block; /* Agar mengambil lebar penuh */
        width: 100%;
        padding: 12px;
        background-color: #28a745; /* Warna hijau untuk aksi positif */
        color: white;
        border: none;
        border-radius: 5px;
        font-size: 1rem;
        cursor: pointer;
        text-align: center;
        margin-top: 10px; /* Margin dari style inline */
        transition: background-color 0.2s ease;
      }
      .set-background-btn i,
      .action-btn i {
        margin-right: 8px;
      }
      .set-background-btn:hover,
      .action-btn:hover {
        background-color: #218838;
      }

      .section-divider {
        border: none;
        border-top: 1px dashed #ddd;
        margin: 25px 0;
      }

      /* Responsiveness (opsional, tapi baik untuk tampilan mobile) */
      @media (max-width: 600px) {
        .web-theme-popup {
          width: 95%;
          max-height: 90vh;
        }
        .web-theme-popup-header h2 {
          font-size: 1.1rem;
        }
        .theme-section h3 {
          font-size: 1rem;
        }
        .controls-group {
          flex-direction: column;
          align-items: flex-start;
        }
        .controls-group label {
          margin-bottom: 8px;
        }
        .controls-group > div,
        #colorPicker,
        #bgUrlInput,
        #fontSelectEl {
          width: 100%; /* Lebar penuh di mobile untuk beberapa kontrol */
        }
        #colorPicker {
          height: 40px; /* Mungkin perlu sedikit lebih tinggi di mobile */
        }
      }
    </style>
  </head>
  <body>
    <!-- Count how many users online? -->
    <div
      style="
        position: fixed;
        top: 0.5rem;
        left: 0.5rem;
        z-index: 9999;
        display: flex;
        align-items: center;
        gap: 0.25rem;
        font-size: 0.65rem;
        background: rgba(255, 255, 255, 0.9);
        padding: 0.15rem 0.35rem;
        border-radius: 0.1rem;
        color: #222;
        font-family: sans-serif;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
      "
    >
      <span id="usrCount"></span>
      <span style="width: 0.4rem; height: 0.4rem; background: lime; border-radius: 50%;"></span>
      <span><a href="https://striped-developing-wax.glitch.me/" style="text-decoration: none;" target="_blank">Online</a></span>
    </div>

    <div class="urChatloadingScreenEl">
      <div class="animation-container">
        <div class="urvillain">
          <span>U</span>
          <span>R</span>
          <span>V</span>
          <span>I</span>
          <span>L</span>
          <span>L</span>
          <span>A</span>
          <span>I</span>
          <span>N</span>
        </div>
        <div class="project">IMAGINE</div>
      </div>
    </div>

    <div id="nsfwPopup" hidden>
      <div id="nsfwPopupContent">
        <p>This website is still under development. There will be updates, and note that this Generator contains NSFW content. However, you can use it for free and without limits. Enjoy, my friend.</p>
        <button onclick="closeNsfwPopup()">I Agree</button>
      </div>
    </div>

    <style>
      .max-min-icon {
        vertical-align: middle;
        color: #fff;
        width: 14px;
        height: 14px;
      }
    </style>

    <!-- Scratchpad Interface -->
    <div class="input-container">
      <div id="scratchpad-bar">
        <div id="scratchpad-icon">
          <i data-lucide="notebook-pen" class="urv-icon"></i> Scratchpad
          <span class="info-icon" onclick="toggleTooltip(event)">
            ⓘ
            <span class="tooltip">
              <strong><i data-lucide="notebook-pen" class="urv-icon"></i> Scratchpad</strong>
              <hr />
              The scratchpad is a space where you can jot down ideas, notes, or additional prompts that you may want to use later. It’s a great way to keep your thoughts organized and easily accessible while working on your project.
            </span>
          </span>
        </div>
        <button id="scratchpadToggleEl"><i data-lucide="maximize" class="max-min-icon"></i></button>
      </div>
      <div id="scratchpadContainerEl">
        <textarea id="scratchpadTextEl" placeholder="Write your notes here..."></textarea>
        <button id="scratchpadSaveEl"><i class="fa-solid fa-save"></i> Save</button>
      </div>
    </div>

    <!-- Positive Prompt Interface (Visible) -->
    <div class="input-container">
      <div id="scratchpad-bar">
        <div id="scratchpad-icon">
          <i data-lucide="feather" class="urv-icon"></i> Positive Prompt
          <span class="info-icon" onclick="toggleTooltip(event)">
            ⓘ
            <span class="tooltip">
              <strong><i data-lucide="feather" class="urv-icon"></i> Positive Prompt</strong>
              <hr />
              Use clear and specific keywords that describe what you want to see. The more detailed your prompt, the better the results. For example, instead of saying <em>"dog,"</em> try
              <em>"highly detailed, raw photo of a fluffy golden retriever playing in a sunny park."</em> This will result in an image of a golden retriever with a very detailed photo style.<br />
              <br />
              <strong><i data-lucide="atom" class="urv-icon"></i> AI Help</strong>
              <hr />
              This feature helps you create more detailed image prompts with AI.<br />
              <br />
              <strong><i data-lucide="trash-2" class="urv-icon"></i> Clear Box</strong>
              <hr />
              This feature clears the type box.
            </span>
          </span>
        </div>
        <!-- Default button text changed to hide, as it is visible initially -->
        <button id="positivePromptToggleEl"><i data-lucide="minimize" class="max-min-icon"></i></button>
      </div>
      <div id="positivePromptContainerEl" class="active">
        <textarea id="userPromptInput" placeholder="Imagine your words..." oninput="userPrompt=this.value" onclick="adjustHeight(this)" onfocus="adjustHeight(this)"></textarea>
        <div class="icon-container">
          <span class="brain-icon" onclick="togglePopup()"><i data-lucide="atom" class="urv-icon"></i></span>
          <span class="clear-icon" onclick="clearUserPrompt()"><i data-lucide="trash-2" class="urv-icon" style="color: #000080;"></i></span>
        </div>
      </div>
    </div>

    <!-- Negative Prompt Interface -->
    <div class="input-container" id="negativePromptSectionEl">
      <div id="scratchpad-bar">
        <div id="scratchpad-icon">
          <i data-lucide="x" class="urv-icon"></i> Negative Prompt
          <span class="info-icon" onclick="toggleTooltip(event)">
            ⓘ
            <span class="tooltip">
              <strong><i class="fa-solid fa-xmark"></i> Negative Prompt</strong>
              <hr />
              Specify elements you want to avoid in your image. If you leave the negative prompt box empty, I have added default negatives that usually work well for creating images. However, if you fill it in, it will replace the default
              with your input.
            </span>
          </span>
        </div>
        <button id="negativePromptToggleEl"><i data-lucide="maximize" class="max-min-icon"></i></button>
      </div>
      <div id="negativePromptContainerEl">
        <textarea
          style="min-height: 80px;"
          id="negativePromptInput"
          placeholder="Trust me, this part isn’t very useful on the new model. Just instruct the model on what you don’t want to see in the 𝗣𝗼𝘀𝗶𝘁𝗶𝘃𝗲 𝗣𝗿𝗼𝗺𝗽𝘁."
          oninput="negativePrompt=this.value"
          onfocus="adjustHeight(this)"
        ></textarea>
        <div class="icon-container">
          <span class="clear-icon" onclick="clearNegativePrompt()"><i data-lucide="trash-2" class="urv-icon" style="color: #000080;"></i></span>
        </div>
      </div>
    </div>

    <style>
      .tabs-icon {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        vertical-align: middle;
        line-height: 1;
        width: 1.2em;
        height: 1.2em;
      }
      .tabs-icon svg {
        vertical-align: -0.15em;
      }

      .text-to-image-plugin-image-iframe {
        border: 3px solid var(--primary-color, #cb9952) !important;
        border-radius: 10px !important;
        overflow: hidden !important;
      }

      /* For Reset All Boxes */
      @keyframes spin-once {
        from {
          transform: rotate(0deg);
        }
        to {
          transform: rotate(360deg);
        }
      }
      .fa-spin-once {
        animation: spin-once 0.7s linear;
      }
    </style>

    <div class="tabs">
      <div class="tab active" onclick="toggleTab('style')"><i data-lucide="swatch-book" class="tabs-icon"></i> Styles</div>
      <div class="tab" onclick="toggleTab('UserEl')"><i data-lucide="box" class="tabs-icon"></i> Boxes</div>
      <div class="tab" onclick="toggleTab('appearance')"><i data-lucide="settings-2" class="tabs-icon"></i> Options</div>
    </div>

    <style>
      #urvillainStyle {
        font-family: "Inversionz";
        font-size: 1.075rem !important;
        letter-spacing: -3px;
      }
      .urvillainStyle-icon {
        width: 12px;
        height: 12px;
        aspect-ratio: 1/1;
        vertical-align: middle;
      }
    </style>

    <div id="styleTab" class="tab-content active">
      <div class="style-options" id="styleOptionsEl">
        <div class="style-option-container">
          <img class="style-option" src="https://user-uploads.perchance.org/file/92e2d81b729d7fae86ec1a25a368d0f4.jpeg" onclick="selectStyle(this)" data-value="" />
          <div class="style-option-name">No Style</div>
        </div>
        <div class="style-option-container">
          <img
            class="style-option"
            src="https://user.uploads.dev/file/442e717f11eaf9aa76d715cc90834a4d.jpg"
            onclick="selectStyle(this)"
            data-value="cinematic dark urban style, dramatic noir lighting, neon accent colors (purple/cyan/crimson), moody atmospheric, high contrast shadows, cyberpunk aesthetic, villain protagonist mood, professional photography quality, 8k detailed(negativePrompt:::bright cheerful, pastel colors, cute cartoon, childish, rainbow colors, white background, bright daylight, low quality, blurred, watermark, text, amateur photography, oversaturated pink yellow, fairy tale, candy colors, grainy, jpeg artifacts)"
          />
          <div class="style-option-name" id="urvillainStyle"><i data-lucide="venetian-mask" class="urvillainStyle-icon"></i> URVILLAIN</div>
        </div>
        <div class="style-option-container">
          <img
            class="style-option"
            src="https://user-uploads.perchance.org/file/d153de3c105950e5522f2c3954e218d3.jpg"
            onclick="selectStyle(this)"
            data-value="**Base Style**: Ultra-realistic photo capture as if shot with a full-frame DSLR and a 50 mm f/1.8 lens—precise exposure (f/1.8, 1/125 s, ISO 100), accurate white balance (daylight 5500 K), natural ambient and rim lighting, true-to-life skin and material textures (no painterly strokes), realistic depth of field with smooth bokeh, slight film grain or sensor noise, authentic lens artifacts (soft vignetting, minor chromatic aberration), minimal post-processing (gentle color grading in neutral profile), perfectly framed composition.\n• Mention specific camera & lens specs for consistency\n• Use technical terms (shutter speed, aperture, ISO, color temp)\n• Avoid painterly or hyper-detail language—think “camera” not “brush”\n• Keep it grounded in real-world photography techniques."
          />
          <div class="style-option-name">Realistic</div>
        </div>
        <div class="style-option-container">
          <img
            class="style-option"
            src="https://user.uploads.dev/file/d8aabfefd44edfb723f618d20f51def9.jpg"
            onclick="selectStyle(this)"
            data-value="**Base Style**: Candid photorealistic vintage. Emphasize natural lighting, imperfect framing, and subtle grain textures reminiscent of Kodak film. Prioritize warm tones, soft focus, and muted color palettes to evoke nostalgia. The subject should appear unposed and authentic, as if caught in a fleeting moment. Inspired by 35mm street photography, family photo albums, and analog documentary aesthetics from the 70s to 90s. (negativePrompt:::low quality, blurry, low-res)"
          />
          <div class="style-option-name">Kodak Candid</div>
        </div>
        <div class="style-option-container">
          <img
            class="style-option"
            src="https://user.uploads.dev/file/f13829f2c449100c33b82917c394b992.jpg"
            onclick="selectStyle(this)"
            data-value="**Base Style**: cinematic movie still, film still, photorealistic, hyperrealistic, 8K, UHD, masterpiece, professional photography, high dynamic range (HDR), high detail, sharp focus, crystal clear details, shot on cinema camera, anamorphic, shallow depth of field, bokeh, cinematic lighting, volumetric light, god rays, dramatic lighting, dramatic contrast, strong shadows, rim light, filmic, film grain, intricate details, atmospheric, moody, rich tones. (negativePrompt:::painting, drawing, illustration, sketch, cartoon, anime, manga, 3D, render, CGI, VFX, video game, art, digital art, poster, dark image, dim lighting, blurry, low quality, jpeg artifacts, ugly, deformed, disfigured, bad anatomy, extra limbs, missing limbs, fused fingers, too many fingers, watermark, text, signature, logo, camera)"
          />
          <div class="style-option-name">Cinematic</div>
        </div>
        <div class="style-option-container">
          <img
            class="style-option"
            src="https://user-uploads.perchance.org/file/51c7cd87d5890df3c95a6337026f9a64.jpg"
            onclick="selectStyle(this)"
            data-value="highly detailed, soft painterly brushwork, realistic human features, natural anatomy, lifelike proportions, expressive eyes, smooth skin texture, subtle imperfections, oil painting style, classical portrait lighting, ambient glow, rich color depth, soft natural shadows, volumetric lighting, light bounce, fine texture details, realistic surface detail, soft rim lighting, gentle depth of field, artistic realism, illustrated realism, by atey ghailan, by charlie bowater, by puinkey, by taranfiddler, by curbet, by honovy, by anhes (negativePrompt:::low quality, worst quality, low resolution, poorly drawn, deformed)"
          />
          <div class="style-option-name">Oil Painting</div>
        </div>
        <div class="style-option-container">
          <img
            class="style-option"
            src="https://user.uploads.dev/file/a75345242c2c4d73fdbc155bc141e7b6.jpg"
            onclick="selectStyle(this)"
            accesskey
            data-value="Anthro art style, furry art, anthropomorphic animal, balanced composition, realistic anime, photo-realistic, anime realism, natural lighting, cinematic, lifelike furry character, expressive features, realistic proportions, accurate anatomy, detailed environment, hyper detailed, 8k, masterpiece, shinkai inspired(negativePrompt:::low quality, worst quality, normal quality, jpeg artifacts, signature, watermark, username, blurry, soft focus, out of focus, deformed, disfigured, mutation, mutated, extra limbs, ugly, poorly drawn hands, poorly drawn face, text, error, missing fingers, cropped, long neck, malformed limbs, multiple heads, extra legs, extra arms, cloned face, dismembered, bad anatomy, fused fingers, too many fingers, fused limbs, missing arms, missing legs, floating limbs, contorted, distorted, disconnected limbs, long body, mutated hands, mutilated, mangled, morbid, duplicate, mutilated hands, out of frame, doll, plastic, 3D, cgi, render, cartoon, drawing, sketch, painting, unrealistic, abstract, surreal, fantasy, mythical, mythological, fictional, chibi, deformed style, simplified, childlike, childish, toy, figurine, miniature, model, sculpture, statue, action figure, plush, stuffed animal, multiple characters, flat lighting, overexposed, underexposed, unnatural shadows, artificial textures, exaggerated proportions, stylized anatomy, cel-shading, line art, grainy, noisy, low resolution, pixelated, monochrome, sepia, vintage, watermark, border, frame, logo, signature, text, words, letters)" 
          />
          <div class="style-option-name">Furry</div>
        </div>
        <div class="style-option-container">
          <img
            class="style-option"
            src="https://user-uploads.perchance.org/file/34d543b3117b98c7889e8d0fcbf6c2dd.jpg"
            onclick="selectStyle(this)"
            data-value="**Base Style**: anime-style character, sharp cel shading, clean line art, vibrant colors, detailed eyes, soft gradients in background, high-contrast lighting, studio anime finish, realistic surface detail, proportionally anatomy, crisp digital rendering, style inspired by modern OVA anime or serialized anime productions — avoids any too wide eyes. (negativePrompt:::low quality, worst quality, low resolution, poorly drawn, deformed, overly realistic and 3D)"
          />
          <div class="style-option-name">Anime</div>
        </div>
        <div class="style-option-container">
          <img
            class="style-option"
            src="https://user.uploads.dev/file/59e1b201e0b7d832ab79f60c3d20e491.jpg"
            onclick="selectStyle(this)"
            data-value="Keywords: cute anime, kawaii style, soft colors, big eyes, round shapes, pastel palette, clean outlines, anime aesthetic, soft shading, adorable, masterpiece, highly detailed, exquisite, 8k, ultra high resolution, studio ghibli inspired, kyoto animation, makoto shinkai style.\nGuidance: An exquisitely detailed cute anime-style illustration in ultra high resolution (8k), inspired by top-tier anime studios. The artwork should feature soft, rounded features, pastel or gentle colors, and expressive, oversized eyes in a kawaii (adorable) style. Linework must be clean and precise, with subtle soft shading to give depth without losing the light, cheerful aesthetic. The overall composition should feel like a polished anime frame or promotional art, echoing the delicate charm of Kyoto Animation or the cinematic beauty of Makoto Shinkai's work. This is a masterpiece-level creation—balanced, heartwarming, and visually flawless."
          />
          <div class="style-option-name">Cute Anime</div>
        </div>
        <div class="style-option-container">
          <img
            class="style-option"
            src="https://user.uploads.dev/file/769c3b14171b7f0f194b630ad2013b9a.jpg"
            onclick="selectStyle(this)"
            data-value="**Base Style**: balanced composition, realistic anime, ultra detailed, photo-realistic, anime realism, natural lighting, cinematic, lifelike anime character, expressive features, realistic proportions, accurate anatomy, detailed environment, soft textures, semi-realistic, hyper detailed, 8k, masterpiece, shinkai inspired, anime meets reality.\n\nA hyper-detailed, photo-realistic anime-style illustration featuring a complete character within a well-composed scene. Focus on blending anime aesthetics with lifelike rendering across the entire figure and its immediate surroundings. The character design emphasizes natural proportions and anatomically sound structure. Lighting is cinematic and natural, casting accurate shadows and highlights that create depth and realism throughout the visual space. The overall image should present as a harmonious blend of animation and photography, depicting an anime character existing within a tangible reality. Rendered in 8k with exquisite detail."
          />
          <div class="style-option-name">AuraReal Anime</div>
        </div>
        <div class="style-option-container">
          <img
            class="style-option"
            src="https://user.uploads.dev/file/19a342f4a8d3a76b729a17546e3ad4ef.jpg"
            onclick="selectStyle(this)"
            data-value="Keywords: colored manga, anime style, vibrant colors, cel shading, clean outlines, expressive characters, Japanese comic art, vivid, flat colors, soft gradients, dynamic.\nGuidance: A fully colored manga-style illustration with vibrant cel-shaded colors and clean, sharp outlines. The image should reflect the energy and expressiveness of Japanese manga, using bold yet balanced color palettes. Line work should remain visible and intentional, with color used to enhance depth, mood, and personality. Avoid hyper-realism—stick to stylized, flat colors with soft shading or light gradients. The overall look should match professionally colored manga or anime cover art."
          />
          <div class="style-option-name">Colored Manga</div>
        </div>
        <div class="style-option-container">
          <img
            class="style-option"
            src="https://user.uploads.dev/file/6e582ada390e5e01dd6122be1bb9b868.jpg"
            onclick="selectStyle(this)"
            data-value="Lofi anime aesthetic with a dreamy and nostalgic mood. The scene is bathed in soft, ethereal ambient light. The overall color palette is dominated by deep indigos and purples, while key elements and highlights are illuminated with a vibrant, glowing pink and magenta. Shadows are rich with dark blue and purple tones, avoiding pure black. Rendered in a 90s retro anime style with clean, defined line art and simple, flat shading. (negativePrompt:::photorealistic, 3D, realistic, CGI, blurry, noisy, grainy, painting, sketch, ugly, dull colors, desaturated, black and white, harsh lighting, overexposed, flat lighting, cluttered, complex, text, signature, watermark, deformed, bad anatomy, malformed, mutated hands, extra limbs)"
          />
          <div class="style-option-name">Lofi Art</div>
        </div>
        <div class="style-option-container">
          <img
            class="style-option"
            src="https://user.uploads.dev/file/c424f6c51519802c1baa4d73238e2d44.jpg"
            onclick="selectStyle(this)"
            data-value="**Base Style**: painterly anime artwork, world-class masterpiece, fine details, breathtaking artwork, painterly art style, aesthetically pleasing, high quality, 8k, very detailed, high resolution, exquisite composition and lighting. Overall, it's an absolute world-class masterpiece painterly anime artwork. It's an aesthetically pleasing painterly anime artwork with impeccable attention to detail and impressive composition."
          />
          <div class="style-option-name">Dreamy</div>
        </div>
        <div class="style-option-container">
          <img
            class="style-option"
            src="https://user-uploads.perchance.org/file/171a54dc226e761d849946efa6a717f9.jpg"
            onclick="selectStyle(this)"
            data-value="Keywords: 64-bit pixel art, detailed pixels, expansive color palette, smooth transitions, high resolution pixel grid. Guidance: A vibrant and richly detailed pixel art style with a broad spectrum of colors, emphasizing smooth gradients and a high-resolution feel, suitable for any scene or subject."
          />
          <div class="style-option-name">Pixel Art</div>
        </div>
        <div class="style-option-container">
          <img
            class="style-option"
            src="https://user-uploads.perchance.org/file/3462abd26ef920a4803311d983da10e0.jpg"
            onclick="selectStyle(this)"
            data-value="Keywords: Comic book illustration, bold linework, vibrant coloring, dynamic shading, distinct character design. Natural Guidance: A comic book illustration style characterized by strong, clear lines, bright and impactful colors, dramatic lighting and shadow to create depth, and expressive character rendering."
          />
          <div class="style-option-name">Comic Book</div>
        </div>
        <div class="style-option-container">
          <img
            class="style-option"
            src="https://user-uploads.perchance.org/file/91084fef10c0855f1c431f6e0d6e47e4.jpg"
            onclick="selectStyle(this)"
            data-value="Keywords: Disney 3D animation, Pixar-style rendering, stylized realism, soft lighting, detailed textures, expressive characters. Guidance: A charming Disney 3D animation style, reminiscent of Pixar, featuring stylized yet realistic rendering, soft and inviting lighting, meticulously crafted textures, and highly expressive character designs."
          />
          <div class="style-option-name">Disney</div>
        </div>
        <div class="style-option-container">
          <img
            class="style-option"
            src="https://user-uploads.perchance.org/file/9f2cde8f369053ae67ee80d09ac1c637.jpg"
            onclick="selectStyle(this)"
            data-value="Keywords: Painted anime, smooth gradients, vibrant colors, detailed textures, expressive eyes, dynamic lighting. Guidance: A painted anime style characterized by smooth color gradients, a vibrant and rich color palette, detailed textures, expressive and captivating eyes, and dynamic lighting to enhance depth and mood."
          />
          <div class="style-option-name">Painterly Artwork</div>
        </div>
        <div class="style-option-container">
          <img
            class="style-option"
            src="https://user-uploads.perchance.org/file/9c389a57d0ec0268d66e2e19c46bf174.jpg"
            onclick="selectStyle(this)"
            data-value="impressionist oil painting aesthetic, warm natural light, glowing atmosphere, soft and expressive brushstrokes, subtle color transitions, painterly texture, light-drenched mood, loose and organic composition, harmonious tones, delicate play of light and shadow, sense of movement, emotional serenity, Sorolla's painting inspired. (negativePrompt:::dark shadows, harsh lighting, saturated colors, anime, cartoon, 3D, CGI, digital art, photo, hyper-realistic, distorted anatomy, extra limbs, deformed faces, text, logo, watermark, overexposed, underexposed, glitch, low quality"
          />
          <div class="style-option-name">Sorolla Painting</div>
        </div>
        <div class="style-option-container">
          <img
            class="style-option"
            src="https://user.uploads.dev/file/d330d83a7518c7dc51eb5809454a067a.jpg"
            onclick="selectStyle(this)"
            data-value="Keywords: Warm ambient lighting, rustic textures, rich earthy tones, intricate architectural details, cozy atmosphere, storytelling shadows, soft glow. Guidance: A style characterized by inviting, warm lighting that casts long, evocative shadows, emphasizing detailed and often worn textures. The color palette leans towards deep, natural earth tones, creating a sense of history and comfort. Architectural elements are rendered with careful attention to detail, suggesting a handcrafted or aged aesthetic. The overall mood is one of cozy intimacy, with light sources creating pockets of soft glow and subtle illumination."
          />
          <div class="style-option-name">Tavern</div>
        </div>
        <div class="style-option-container">
          <img
            class="style-option"
            src="https://user-uploads.perchance.org/file/87b656a11117bed53dff3eca4f1addf4.jpg"
            onclick="selectStyle(this)"
            data-value="Keywords: Cartoon style, smooth and bold outlines, flat yet vibrant color palette, expressive facial features, playful lighting, exaggerated proportions, light cel-shading. Guidance: A cartoon illustration style featuring clean, thick outlines, a palette of vivid and harmonious colors, expressive and quirky character design, simple yet dynamic lighting with gentle cel-shading, inspired by Disney or Nickelodeon studios, and an overall playful, energetic atmosphere. (negativePrompt:::no 3D render, no sketch style)"
          />
          <div class="style-option-name">Cartoon</div>
        </div>
        <div class="style-option-container">
          <img
            class="style-option"
            src="https://user.uploads.dev/file/273a772cecc68893429d9bf545954241.jpg"
            onclick="selectStyle(this)"
            data-value="A cartoon art style with 2D clean **line art** and **bold outlines**. The image features a **vivid color palette** and **well-defined shadows** with **fine details** to achieve a high-resolution appearance. The artistic inspiration draws from the **delicate ink wash and scholarly aesthetics of Joseon literati painting**, the **free-flowing and spontaneous brushwork of Qing dynasty landscape artists**, and the **vibrant, detailed bird-and-flower compositions of Ming dynasty court painters**. The subjects are **anatomically correct** with **accurate proportions** and a **subtle aged appearance**. Focus on **natural facial features**). (negativePrompt:::Avoid **poor quality imagery**, including **blurry** or **low-resolution** elements, and **jpeg artifacts**. Exclude any forms of **monochrome** or **grayscale**. Prevent **anatomical errors** such as **bad hands**, **feet**, **bodies**, or **proportions**. Ensure there are no **poorly drawn** or **awkward poses**, **incorrect positioning**, **cluttered scenes**, **uneven proportions**, **missing** or **extra digits/limbs** (e.g., fingers, arms, legs), **malformed limbs**, or **fused fingers**. Do not include **long necks**, **mutated hands**, **generic** or **overused imagery**. Disallow **unnatural intimacy**, **signatures**, **watermarks**, **usernames**, or any **error text**. Avoid **gross proportions**, **repeating hair**, **awkward** or **mismatched gazes** between characters, **unnatural eye contact**, **stiff poses**, **lifeless interaction**, or **emotionless**, **blank expressions** lacking **emotional depth**.)"
          />
          <div class="style-option-name">Eastern Painting</div>
        </div>
        <div class="style-option-container">
          <img
            class="style-option"
            src="https://user.uploads.dev/file/81b790e1aa7f0cd664a8a1ef21c31931.jpg"
            onclick="selectStyle(this)"
            data-value="Keywords: anime style, clean dynamic lines, moderate contrast shading, detailed yet streamlined character design, expressive facial features, cinematic yet balanced atmosphere, subtle Star Wars influence, vibrant but controlled colors. Guidance: An anime-inspired illustration style with smooth, flowing outlines and controlled, vibrant color use. Characters feature expressive faces and stylized forms, drawing on Star Wars motifs through setting, visual cues, and tone rather than literal costume design. Lighting and shading are dynamic but not overly dramatic, creating a cinematic yet approachable feel. The composition remains energetic but not overwhelming, with attention to clarity and visual storytelling. (negativePrompt:::no western cartoon, no photorealism, no chibi style, no sketchy or rough lines, no heavy symbolism, no pastel or washed-out colors, no poster.)"
          />
          <div class="style-option-name">Star Wars</div>
        </div>
        <div class="style-option-container">
          <img
            class="style-option"
            src="https://user.uploads.dev/file/dbe10c8e3d5e08d4553e2a6ef9ee7440.jpg"
            onclick="selectStyle(this)"
            data-value="**Base Style**: Gritty neon cyberpunk. Emphasize high-contrast lighting, moody urban atmospheres, reflective surfaces, and dense futuristic cityscapes. Focus on tech-saturated visuals, glitch aesthetics, and characters with attitude—cybernetic enhancements, urban style, and a sense of rebellion in a hyper-surveilled world."
          />
          <div class="style-option-name">Cyberpunk</div>
        </div>
        <div class="style-option-container">
          <img
            class="style-option"
            src="https://user.uploads.dev/file/280ea7f68aad5818fe5b1ba4e0b4ba8b.jpg"
            onclick="selectStyle(this)"
            data-value="**Base Style**: Grand stylized fantasy. Prioritize vivid colors, dramatic lighting, a strong sense of presence, and impactful visual storytelling. Inspired by the distinct and engaging art styles and narrative depth found in popular fantasy MOBA/RTS titles."
          />
          <div class="style-option-name">MOBA/RTS</div>
        </div>
        <div class="style-option-container">
          <img
            class="style-option"
            src="https://user.uploads.dev/file/d30538c14c0a0698b9075f5782591cb3.jpg"
            onclick="selectStyle(this)"
            data-value="Keywords: manga line art, anime style, clean ink outlines, black and white, high contrast, screen tone ready, minimal shading, sharp edges, expressive lines, sketch style, Japanese comic style\nGuidance: A clean and expressive manga-style line art illustration. The focus is on dynamic, black ink outlines with varied line weight to convey depth and emotion. The artwork should mimic traditional Japanese manga drawings, using only black and white without color or heavy shading. No gradients or textures—just crisp, well-defined contours and details. Designed to be screen-tone ready, with minimal background clutter and high visual clarity."
          />
          <div class="style-option-name">Line Art</div>
        </div>
        <div class="style-option-container">
          <img
            class="style-option"
            src="https://user.uploads.dev/file/ff83888208d03bb7f4ed483efc764283.jpg"
            onclick="selectStyle(this)"
            data-value="Keywords: noir, film noir, dramatic lighting, high contrast, black and white, moody atmosphere, chiaroscuro, cinematic shadows, vintage, gritty texture, 1940s aesthetic, mystery, 8k, masterpiece, ultra detailed.\nGuidance: A cinematic noir-style illustration in black and white, capturing the moody, dramatic tone of classic film noir. Lighting should be stark and directional, with deep shadows and strong contrast using chiaroscuro techniques. The atmosphere should feel mysterious, tense, and vintage—like a scene pulled from a 1940s detective film. Textures may be slightly gritty or grainy to enhance the analog feel. Composition is crucial: use dramatic angles, intentional framing, and visual storytelling. This is a masterpiece-level image—ultra-detailed, emotionally charged, and rendered in 8k resolution."
          />
          <div class="style-option-name">Film Noir</div>
        </div>
        <div class="style-option-container">
          <img
            class="style-option"
            src="https://user.uploads.dev/file/8269dda085dcb7485d93fe580d9fa782.jpg"
            onclick="selectStyle(this)"
            data-value="Noir Impasto Monochrome: Chiaroscuro, monochromatic, painterly, visible brushstrokes, moody atmosphere, noir aesthetic. (negativePrompt:::bright colors, photorealistic, smooth, flat lighting, cheerful, cartoonish)"
          />
          <div class="style-option-name">Noir Impasto</div>
        </div>
        <div class="style-option-container">
          <img
            class="style-option"
            src="https://user.uploads.dev/file/3a320a29f5d296f71eb3eb6a0a8f86ff.jpg"
            onclick="selectStyle(this)"
            data-value="Keywords: van gogh style, post-impressionism, expressive brushstrokes, swirling textures, vivid colors, oil painting, painterly, impasto technique, emotional, 8k, masterpiece, ultra detailed.\nGuidance: An expressive painting in the style of Vincent van Gogh, with bold, visible brushstrokes and a swirling, textured impasto technique. The artwork should evoke strong emotion through color and movement, using vivid, contrasting hues and dynamic forms. The composition must feel hand-painted and organic, rich with texture and depth. Lighting should feel natural yet intense, often exaggerated to enhance the mood. Avoid smooth gradients or digital polish—the image must look like a traditional oil painting, alive with energy and motion. Rendered as a masterpiece in 8k resolution, capturing the raw spirit of post-impressionism."
          />
          <div class="style-option-name">Van Gogh Inspired</div>
        </div>
        <div class="style-option-container">
          <img
            class="style-option"
            src="https://user.uploads.dev/file/9d057848006e5856dd2f2fa6dfb2b0de.jpg"
            onclick="selectStyle(this)"
            data-value="**Base Style**: Balanced composition, realistic anime, ultra-detailed, photorealistic anime realism, natural lighting, cinematic style, lifelike anime character, NSFW and pornographic content, realistic proportions, accurate anatomy, explicit sexual acts, realistic surface detail, uncensored content, semi-realistic style, hyper-detailed, 8K resolution, A risqué hentai ecchi masterpiece where anime meets reality. This hyper-detailed, photo-realistic hentai illustration features a complete character in an explicit scene. The focus is on blending anime aesthetics with lifelike rendering of the entire figure and its surroundings. The character design emphasizes an adult theme with natural proportions and an anatomically sound structure. Minimal, natural lighting casts accurate shadows and highlights that create depth and realism throughout the visual space. This image harmoniously blends uncensored adult animation and explicit erotic photography, depicting a sensual and provocative anime character in a tangible reality. It is rendered in exquisite 8K detail."
          />
          <div class="style-option-name">NSFW Art</div>
        </div>
      </div>
      <!-- Obsecuritas Regnum -->
      [something("urvillain-imagine", "https://user.uploads.dev/file/8e34cce3e219d3ea4995977cc097482f.jpg")]

      <div class="theme-selector">
        <span class="theme-label"><i data-lucide="paintbrush" class="urv-icon"></i> URV Themes</span>
        <select id="selectThemes" class="theme-dropdown" onchange="updateSelectedThemes(this.value)">
          [urvThemes]
        </select>
      </div>

      <div class="theme-selector">
        <span class="theme-label"><i data-lucide="image-plus" class="urv-icon"></i> How many?</span>
        <select id="outputCount" class="theme-dropdown">
          <option value="4">4 Images</option>
          <option value="8">8 Images</option>
          <option value="16">16 Images</option>
          <option value="24">24 Images</option>
          <option value="32">32 Images</option>
        </select>
      </div>
    </div>

    <div id="appearanceTab" class="tab-content">
      <div class="slider-container">
        <div style="flex: 1;">
          <label class="slider-label" for="orientationSlider">
            <span id="orientationValueEl"><i class="fa-solid fa-image-portrait"></i> Portrait 2:3</span>
          </label>
          <input type="range" id="orientationSlider" min="0" max="2" step="1" value="1" oninput="updateOrientation(this.value)" />
        </div>
        <div style="flex: 1;">
          <label class="slider-label" for="guidanceScale"><i class="fa-solid fa-ruler-combined"></i> Guidance Scale: <span id="sliderValueEl">7</span></label>
          <input type="range" id="guidanceScale" min="1" max="15" step="1" value="7" oninput="updateSliderValue(this.value)" />
        </div>
      </div>

      <div class="input-container">
        <input type="text" placeholder="Leave blank for a random seed" oninput="seed=this.value" />
        <!--button class="lock-button" onclick="toggleLock(this)"><i class="fas fa-lock"></i></button-->
      </div>
      <div class="input-container">
        <input type="text" placeholder="Type a name for your title image" oninput="saveTitle=this.value" />
      </div>
    </div>

    <!-- Boxes Section -->
    <div id="UserElTab" class="tab-content">
      <div class="profile-btn">
        <i class="fa-solid fa-user-gear"></i>
        <span>Depiction</span>
      </div>
      <div class="import-grid" style="--cols: 3;">
        <div class="import-selector">
          <label class="import-label"><i class="fa-solid fa-dragon"></i> Species</label>
          <select class="import-dropdown" id="species" onchange="updateCombinedPrompt()">
            [urvSpecies]
          </select>
        </div>
        <div class="import-selector">
          <label class="import-label"><i class="fa-solid fa-users-viewfinder"></i> Ethnicity</label>
          <select class="import-dropdown" id="ethnicity" onchange="updateCombinedPrompt()">
            [urvEthnicity]
          </select>
        </div>
        <div class="import-selector">
          <label class="import-label"><i class="fa-solid fa-venus-mars"></i> Gender</label>
          <select class="import-dropdown" id="gender" onchange="updateCombinedPrompt()">
            <option value="">Default</option>
            <option value="A male character with masculine traits">Male</option>
            <option value="A female character with feminine traits">Female</option>
          </select>
        </div>
        <div class="import-selector">
          <label class="import-label"><i class="fa-solid fa-user-clock"></i> Maturity</label>
          <select class="import-dropdown" id="maturity" onchange="updateCombinedPrompt()">
            <option value="">Default</option>
            <option value="(Subject Depiction: toddler, young child around 3 to 5 years old, chubby cheeks, small stature, playful expression)">Toddler</option>
            <option value="(Subject Depiction: kid, child around 6 to 9 years old, round face, small hands, energetic posture)">Kid</option>
            <option value="(Subject Depiction: pre-teen, around 10 to 12 years old, slightly elongated face, lean limbs, curious gaze)">Pre-Teen</option>
            <option value="(Subject Depiction: teenager, around 13 to 17 years old, youthful facial structure, growing taller, expressive and emotional features)">Teen</option>
            <option value="(Subject Depiction: young adult, around 18 to 25 years old, mature facial features, toned body, confident stance)">Young Adult</option>
            <option value="(Subject Depiction: adult, around 26 to 39 years old, defined features, stable posture, full-grown physique)">Adult</option>
            <option value="(Subject Depiction: middle-aged adult, around 40 to 59 years old, visible laugh lines, firm build with subtle signs of aging)">Middle-Aged</option>
            <option value="(Subject Depiction: senior adult, around 60 to 75 years old, wrinkles, softer skin, slower posture, gray or thinning hair)">Senior</option>
            <option value="(Subject Depiction: elder adult, over 75 years old, deep facial lines, hunched posture, fragile appearance, age-worn eyes)">Elder</option>
            <option value="(Subject Depiction: ageless being, immortal appearance, timeless skin, ethereal expression, body defies aging or decay)">Ageless Being</option>
          </select>
        </div>
        <div class="import-selector">
          <label class="import-label"><i class="fa-solid fa-masks-theater"></i> Persona</label>
          <select class="import-dropdown" id="persona" onchange="updateCombinedPrompt()">
            [urvPersona]
          </select>
        </div>
        <div class="import-selector">
          <label class="import-label"><i class="fa-solid fa-user-astronaut"></i> Professions</label>
          <select class="import-dropdown" id="professions" onchange="updateCombinedPrompt()">
            [urvProfessions]
          </select>
        </div>
        <div class="import-selector">
          <label class="import-label"><i class="fa-solid fa-circle-notch"></i> Hair Type?</label>
          <select class="import-dropdown" id="hairType" onchange="updateCombinedPrompt()">
            <option value="">Default</option>
            <option value="smooth, straight hair">Straight</option>
            <option value="loose, wavy hair">Wavy</option>
            <option value="naturally curly hair">Curly</option>
            <option value="messy hair">Messy</option>
            <option value="spiked hair">Spiked</option>
          </select>
        </div>
        <div class="import-selector">
          <label class="import-label"><i class="fa-solid fa-wave-square"></i> Length?</label>
          <select class="import-dropdown" id="hairLength" onchange="updateCombinedPrompt()">
            <option value="">Normal</option>
            <option value="tomboy, very short hair">Very Short Hair</option>
            <option value="short hair">Short Hair</option>
            <option value="medium hair">Medium Hair</option>
            <option value="long hair">Long Hair</option>
            <option value="very long hair">Very Long Hair</option>
            <option value="absurdly long hair">Absurdly Long Hair</option>
            <option value="big hair">Big Hair</option>
            <option value="bald head">Bald</option>
          </select>
        </div>
        <div class="import-selector">
          <label class="import-label"><i class="fa-solid fa-scissors"></i> Hairstyle?</label>
          <select class="import-dropdown" id="hairStyle" onchange="updateCombinedPrompt()">
            <option value="">Default</option>
            <optgroup label="♀️ 𝗙𝗲𝗺𝗶𝗻𝗶𝗻𝗲 𝗛𝗮𝗶𝗿𝘀𝘁𝘆𝗹𝗲𝘀">
              <option value="afro hairstyle, voluminous curls">Afro</option>
              <option value="bob cut hairstyle, short straight hair around jaw level">Bob Cut</option>
              <option value="braided hairstyle, neat braids">Braided</option>
              <option value="hair tied in a classic bun">Bun</option>
              <option value="elegant low bun at the nape">Chignon</option>
              <option value="fishtail braid hairstyle">Fishtail Braid</option>
              <option value="french braid hairstyle">French Braid</option>
              <option value="half updo hairstyle, top half tied, rest down">Half Updo</option>
              <option value="layered hairstyle, soft layers for volume and flow">Layered</option>
              <option value="messy bun, loose and casual style">Messy Bun</option>
              <option value="pigtails hairstyle, two side ponytails">Pigtails</option>
              <option value="pompadour hairstyle, swept up and back">Pompadour</option>
              <option value="ponytail hairstyle, hair tied back">Ponytail</option>
              <option value="side braid hairstyle, worn to one side">Side Braid</option>
              <option value="twintails hairstyle, symmetrical ponytails">Twintails</option>
              <option value="updo hairstyle, hair lifted off the neck">Updo</option>
            </optgroup>
            <optgroup label="♂️ 𝗠𝗮𝘀𝗰𝘂𝗹𝗶𝗻𝗲 𝗛𝗮𝗶𝗿𝘀𝘁𝘆𝗹𝗲𝘀">
              <option value="afro hairstyle, thick natural curls">Afro</option>
              <option value="caesar cut, short haircut with small fringe">Caesar Cut</option>
              <option value="comma cut, soft wave shaping like a comma on forehead">Comma Cut</option>
              <option value="crew cut, short and even all over">Crew Cut</option>
              <option value="faux hawk, center strip styled upward">Faux Hawk</option>
              <option value="hipster hairstyle, longer top with styled side part">Hipster</option>
              <option value="ivy league haircut, neat side part with short sides">Ivy League</option>
              <option value="pompadour hairstyle, voluminous and swept back">Pompadour</option>
              <option value="quiff hairstyle, front hair lifted and voluminous">Quiff</option>
              <option value="side part hairstyle, clearly defined side part">Side Part</option>
              <option value="taper fade, smooth transition from short to longer hair">Taper Fade</option>
              <option value="undercut hairstyle, very short sides, long top">Undercut</option>
            </optgroup>
          </select>
        </div>
        <div class="import-selector">
          <label class="import-label"><i class="fa-solid fa-plus"></i> Hair Add?</label>
          <select class="import-dropdown" id="hairAdd" onchange="updateCombinedPrompt()">
            <option value="">Default</option>
            <option value="bangs">Bangs</option>
            <option value="blunt bangs">Blunt Bangs</option>
            <option value="hair between eyes">Hair Between Eyes</option>
            <option value="hair over eyes">Hair Over Eyes</option>
            <option value="hair over one eye">Hair Over One Eye</option>
            <option value="parted bangs">Parted Bangs</option>
            <option value="swept bangs">Swept Bangs</option>
            <option value="driedlocks">Driedlocks</option>
            <option value="sidelocks">Sidelocks</option>
            <option value="ahoge">Ahoge</option>
            <option value="heart ahoge">Heart Ahoge</option>
            <option value="hair antenna">Hair Antenna</option>
            <option value="hair pulled back">Hair Pulled Back</option>
            <option value="hair slicked back">Hair Slicked Back</option>
          </select>
        </div>
        <div class="import-selector">
          <label class="import-label"><i class="fa-solid fa-paintbrush"></i> Hair Colors?</label>
          <select class="import-dropdown" id="hairColor" onchange="updateCombinedPrompt()">
            <option value="">Default</option>
            <option value="hair is auburn">Auburn</option>
            <option value="hair is blonde">Blonde</option>
            <option value="hair is brunette">Brunette</option>
            <option value="hair is dark">Dark</option>
            <option value="hair is black">Black</option>
            <option value="hair is dirty blonde">Dirty Blonde</option>
            <option value="hair is dyed blonde">Dyed (Blonde)</option>
            <option value="hair is dyed blue">Dyed (Blue)</option>
            <option value="hair is dyed green">Dyed (Green)</option>
            <option value="hair is dyed orange">Dyed (Orange)</option>
            <option value="hair is dyed pink">Dyed (Pink)</option>
            <option value="is dyed purple">Dyed (Purple)</option>
            <option value="hair is dyed bright red">Dyed (Red)</option>
            <option value="hair is dyed scarlet">Dyed (Scarlet)</option>
            <option value="hair is grey">Grey</option>
            <option value="hair is natural ginger">Redhead</option>
            <option value="head is shaved">Shaved</option>
            <option value="hair is strawberry blonde">Strawberry Blonde</option>
            <option value="hair is silver">Silver</option>
            <option value="hair is white">White</option>
            <option value="they has gradient hair, with 2 different colors hair">Gradient Hair</option>
            <option value="they has multicolored hair, with 3 or more different colors hair">Multicolored Hair</option>
            <option value="they has streaked hair, with 3 different colors hair">Streaked Hair</option>
            <option value="they has two-tone hair, with 2 different colors hair">Two-tone Hair</option>
          </select>
        </div>
        <div class="import-selector">
          <label class="import-label"><i class="fa-solid fa-eye"></i> Eyes Colors</label>
          <select class="import-dropdown" id="eyesColor" onchange="updateCombinedPrompt()">
            <option value="">Default</option>
            <option value="aqua eyes">Aqua</option>
            <option value="black eyes">Black</option>
            <option value="blue eyes">Blue</option>
            <option value="brown eyes">Brown</option>
            <option value="green eyes">Green</option>
            <option value="grey eyes">Grey</option>
            <option value="orange eyes">Orange</option>
            <option value="purple eyes">Purple</option>
            <option value="pink eyes">Pink</option>
            <option value="red eyes">Red</option>
            <option value="white eyes, devoid any iris and pupils">White</option>
            <option value="yellow eyes">Yellow</option>
            <option value="sleepy-eyes">Sleepy</option>
            <option value="they has two different eye color">Heterochromia</option>
          </select>
        </div>
        <div class="import-selector">
          <label class="import-label"><i class="fa-solid fa-person-rays"></i> Skin Colors</label>
          <select class="import-dropdown" id="skinColor" onchange="updateCombinedPrompt()">
            <option value="">Default</option>
            <option value="very fair skin">Very Fair</option>
            <option value="fair skin">Fair</option>
            <option value="light skin">Light</option>
            <option value="light olive skin">Light Olive</option>
            <option value="olive skin">Olive</option>
            <option value="tan skin">Tan</option>
            <option value="medium skin">Medium</option>
            <option value="bronze skin">Bronze</option>
            <option value="brown skin">Brown</option>
            <option value="dark brown skin">Dark Brown</option>
            <option value="very dark skin">Very Dark</option>
            <option value="ebony skin">Ebony</option>
            <option value="alabaster skin">Alabaster</option>
            <option value="porcelain skin">Porcelain</option>
            <option value="rosy skin">Rosy</option>
            <option value="reddish skin">Reddish</option>
            <option value="freckled skin">Freckled</option>
            <option value="pale skin with cool undertone">Pale (Cool Undertone)</option>
            <option value="pale skin with warm undertone">Pale (Warm Undertone)</option>
            <option value="golden skin">Golden</option>
            <option value="silver skin">Silver</option>
            <option value="gray skin">Gray</option>
            <option value="blue-tinted skin">Blue-tinted</option>
            <option value="green skin">Green</option>
            <option value="purple skin">Purple</option>
            <option value="red skin">Red</option>
            <option value="pink skin">Pink</option>
            <option value="chalk-white skin">Chalk White</option>
            <option value="ashen skin">Ashen</option>
            <option value="translucent skin, almost see-through">Translucent</option>
          </select>
        </div>
        <div class="import-selector">
          <label class="import-label"><i class="fa-solid fa-circle"></i> Face Decor</label>
          <select class="import-dropdown" id="facial" onchange="updateCombinedPrompt()">
            <option value="">Default</option>
            <optgroup label="General">
              <option value="they wear subtle peach blush on their cheeks">Peach Blush on Cheeks</option>
              <option value="their eyes are adorned with shimmering gold eyeshadow">Shimmering Gold Eyeshadow</option>
              <option value="they have dramatic, winged black eyeliner">Winged Black Eyeliner</option>
              <option value="there are small, sparkling face gems beneath their eyes">Face Gems Beneath Eyes</option>
              <option value="they display a delicate floral face painting on their left cheek">Floral Face Painting</option>
              <option value="their eyelashes are long and coated with thick mascara">Thick Mascara on Lashes</option>
              <option value="they have a subtle beauty mark above their lip">Beauty Mark Above Lip</option>
              <option value="a pair of silver nose studs adorn their nostrils">Silver Nose Studs</option>
              <option value="they have a bold, tribal tattoo running across their jawline">Tribal Jawline Tattoo</option>
              <option value="their eyebrows are perfectly shaped and highlighted">Highlighted Eyebrows</option>
              <option value="they wear soft, shimmering highlighter on their cheekbones">Shimmering Cheekbone Highlighter</option>
              <option value="their face features a dramatic lightning bolt painted across one eye">Lightning Bolt Face Paint</option>
              <option value="they have delicate white freckles painted over their nose">White Painted Freckles</option>
              <option value="their lips are tinted pale pink with a glossy finish">Glossy Pale Pink Lips</option>
              <option value="their eyelids are brushed with bold neon colors">Neon Eyeshadow</option>
              <option value="they sport a constellation of glittering stars across their temples">Glitter Star Decorations</option>
              <option value="their cheeks have vivid stripes of bright face paint">Bright Face Paint Stripes</option>
              <option value="they have intricate henna designs along their jaw and chin">Intricate Henna Face Art</option>
              <option value="their lower lip is adorned with a gold piercing">Gold Lip Piercing</option>
              <option value="their cheeks are dotted with iridescent sequins">Iridescent Sequins on Cheeks</option>
              <option value="they have a single black teardrop drawn below their left eye">Black Teardrop Face Mark</option>
              <option value="their temples feature metallic temporary tattoos">Metallic Temporary Tattoos</option>
              <option value="their face displays bold geometric shapes painted in primary colors">Geometric Face Painting</option>
            </optgroup>
            <optgroup label="Masculine Facial Features">
              <option value="they have a neatly trimmed beard framing their jawline">Neatly Trimmed Beard</option>
              <option value="they sport a thick, rugged mustache above their lip">Thick Rugged Mustache</option>
              <option value="their face is adorned with a full, bushy beard">Full Bushy Beard</option>
              <option value="they have a fine, pointed goatee at their chin">Pointed Goatee</option>
              <option value="their cheeks are covered with light, stubbly facial hair">Light Stubbly Facial Hair</option>
              <option value="their chin features a prominent soul patch">Prominent Soul Patch</option>
              <option value="their upper lip is accented by a pencil-thin mustache">Pencil-Thin Mustache</option>
              <option value="they have sculpted mutton chops along their cheeks">Sculpted Mutton Chops</option>
              <option value="their jawline is shadowed with a five o'clock stubble">Five O'Clock Shadow</option>
              <option value="they display an elegant handlebar mustache curled at the ends">Handlebar Mustache</option>
            </optgroup>
          </select>
        </div>
        <div class="import-selector">
          <label class="import-label"><i class="fa-solid fa-face-grin-tongue-wink"></i> Expression</label>
          <select class="import-dropdown" id="expression" onchange="updateCombinedPrompt()">
            [urvExpression]
          </select>
        </div>
        <div class="import-selector">
          <label class="import-label"><i class="fa-solid fa-child"></i> Body Shapes</label>
          <select class="import-dropdown" id="bodyShape" onchange="updateCombinedPrompt()">
            [urvBodyShape]
          </select>
        </div>
        <div class="import-selector">
          <label class="import-label"><i class="fa-solid fa-dumbbell"></i> Body Build</label>
          <select class="import-dropdown" id="bodyBuild" onchange="updateCombinedPrompt()">
            <option value="">Default</option>
            <option value="sharp bone structure, prominent joints, lean build, defined angles">Angular</option>
            <option value="toned, muscular, fit, defined, balanced physique, sporty">Athletic</option>
            <option value="balanced proportions, moderate body structure, neither too slim nor too bulky">Average</option>
            <option value="prominent bones, slim, little body fat, angular build">Bony</option>
            <option value="wide shoulders, strong upper body, muscular structure, expansive chest">Broad-Shouldered</option>
            <option value="larger body structure, big muscles, solid, heavy-set, strong build">Bulky</option>
            <option value="well-developed muscles, strong, defined, bulky, athletic build">Muscular</option>
            <option value="extremely lean, very low body fat, wiry muscles, thin frame">Lean</option>
            <option value="rounder body, softer muscle tone, higher body fat ratio">Soft</option>
            <option value="compact body, dense muscle mass, short and strong build">Stocky</option>
            <option value="tall with elongated limbs, slim but not frail">Lanky</option>
            <option value="short stature with moderate muscle or fat">Short</option>
            <option value="very large and heavy, thick fat distribution, massive presence">Heavyset</option>
            <option value="frail, delicate bone structure, low muscle mass">Delicate</option>
            <option value="childlike proportions, undeveloped build">Petite</option>
          </select>
        </div>
        <div class="import-selector">
          <label class="import-label"><i class="fa-solid fa-egg"></i> Chest Sizes</label>
          <select class="import-dropdown" id="chestSize" onchange="updateCombinedPrompt()">
            <option value="">Default</option>
            <option value="flat chest, no visible breasts">Flat</option>
            <option value="very small breasts, minimal curves">Very Small</option>
            <option value="small breasts, subtle definition">Small</option>
            <option value="modest breasts, natural shape">Modest</option>
            <option value="average-sized breasts, balanced proportion">Average</option>
            <option value="full breasts, visibly prominent">Full</option>
            <option value="large breasts, clearly emphasized">Large</option>
            <option value="very large breasts, heavy and rounded">Very Large</option>
            <option value="massive breasts, exaggerated proportion">Huge</option>
            <option value="extremely massive breasts, unrealistic scale">Gigantic</option>
          </select>
        </div>
      </div>
      <!-- Appearance -->
      <div class="profile-btn">
        <i class="fa-solid fa-shirt"></i>
        <span>Appearance</span>
      </div>
      <div class="import-grid" style="--cols: 3;">
        <div class="import-selector">
          <label class="import-label"><i class="fa-solid fa-hat-cowboy"></i> Headwear</label>
          <select class="import-dropdown" id="headWear" onchange="updateCombinedPrompt()">
            [urvHeadWear]
          </select>
        </div>
        <div class="import-selector">
          <label class="import-label"><i class="fa-solid fa-user-tie"></i> Topwear</label>
          <select class="import-dropdown" id="topWear" onchange="updateCombinedPrompt()">
            [urvTopWear]
          </select>
        </div>
        <div class="import-selector">
          <label class="import-label"><i class="fa-solid fa-arrow-down-long"></i> Bottomwear</label>
          <select class="import-dropdown" id="bottomWear" onchange="updateCombinedPrompt()">
            [urvBottomWear]
          </select>
        </div>
        <div class="import-selector">
          <label class="import-label"><i class="fa-solid fa-socks"></i> Footwear</label>
          <select class="import-dropdown" id="footWear" onchange="updateCombinedPrompt()">
            [urvFootWear]
          </select>
        </div>
        <div class="import-selector">
          <label class="import-label"><i class="fa-solid fa-mitten"></i> Accesories</label>
          <select class="import-dropdown" id="handsAcc" onchange="updateCombinedPrompt()">
            <option value="">Default</option>
            <option value="wearing a decorative bracelet">Bracelet</option>
            <option value="wearing a stylish bangle">Bangle</option>
            <option value="wearing formal cufflinks">Cufflinks</option>
            <option value="wearing warm gloves">Gloves</option>
            <option value="wearing cozy mittens">Mittens</option>
            <option value="wearing a sparkling ring">Ring</option>
            <option value="wearing a functional watch">Watch</option>
            <option value="wearing a casual wristband">Wristband</option>
            <option value="wearing an elegant wristwatch">Wristwatch</option>
            <option value="wearing fingerless gloves">Fingerless Gloves</option>
            <option value="wearing lace gloves">Lace Gloves</option>
            <option value="wearing leather gloves">Leather Gloves</option>
            <option value="wearing studded bracelets">Studded Bracelet</option>
            <option value="wearing multiple rings on one hand">Stacked Rings</option>
            <option value="wearing a charm bracelet with trinkets">Charm Bracelet</option>
            <option value="wearing glowing wrist accessory">Glowing Wristband</option>
            <option value="wearing high-tech gadget on wrist">Smart Device</option>
            <option value="wearing bandage wrap on hand">Bandaged Hand</option>
            <option value="wearing traditional hand jewelry">Hand Chain</option>
            <option value="wearing handcuffs">Handcuffs</option>
          </select>
        </div>
        <div class="import-selector">
          <label class="import-label"><i class="fa-solid fa-pepper-hot"></i> Naughty Wear</label>
          <select class="import-dropdown" id="hotWear" onchange="updateCombinedPrompt()">
            [urvHotWear]
          </select>
        </div>
        <div class="import-selector">
          <label class="import-label"><i class="fa-solid fa-hat-wizard"></i> Fantasy Wear</label>
          <select class="import-dropdown" id="fantasyWear" onchange="updateCombinedPrompt()">
            [urvFantasyWear]
          </select>
        </div>
        <div class="import-selector">
          <label class="import-label"><i class="fa-solid fa-fire-flame-curved"></i> Traditional</label>
          <select class="import-dropdown" id="traditionalWear" onchange="updateCombinedPrompt()">
            [urvTraditionalWear]
          </select>
        </div>
        <div class="import-selector">
          <label class="import-label"><i class="fa-solid fa-up-down-left-right"></i> More Attires</label>
          <select class="import-dropdown" id="moreWear" onchange="updateCombinedPrompt()">
            [urvMoreWear]
          </select>
        </div>
      </div>
      <!-- Contextual -->
      <div class="profile-btn">
        <i class="fa-solid fa-draw-polygon"></i>
        <span>Context</span>
      </div>
      <div class="import-grid" style="--cols: 3;">
        <div class="import-selector">
          <label class="import-label"><i class="fa-solid fa-temperature-half"></i> Mood</label>
          <select class="import-dropdown" id="moodAura" onchange="updateCombinedPrompt()">
            <option value="">Default</option>
            <option value="they radiate a joyful, carefree aura">Joyful and Carefree Atmosphere</option>
            <option value="their eyes reflect a deep sense of melancholy">Melancholic Expression</option>
            <option value="the scene is bathed in a dreamy, surreal light">Dreamy and Surreal Mood</option>
            <option value="their posture conveys quiet determination and resilience">Determined and Resilient Mood</option>
            <option value="they exude an ominous, mysterious presence">Ominous and Mysterious Vibe</option>
            <option value="there is a gentle sense of nostalgia in their gaze">Nostalgic Atmosphere</option>
            <option value="they give off a playful and mischievous energy">Playful and Mischievous Spirit</option>
            <option value="the ambiance feels tense and suspenseful">Tense and Suspenseful Ambiance</option>
            <option value="their smile is warm and welcoming, radiating kindness">Warm and Kind Atmosphere</option>
            <option value="the overall mood is tranquil and serene, like a quiet morning">Tranquil and Serene Mood</option>
            <option value="the environment feels electrifying and full of excitement">Exciting and Energetic Atmosphere</option>
            <option value="they appear lost in deep contemplation">Contemplative Mood</option>
            <option value="there is a whimsical, childlike wonder in their expression">Whimsical and Childlike Wonder</option>
            <option value="the air feels heavy with sorrow and loss">Sorrowful and Somber Mood</option>
            <option value="their expression evinces fierce confidence and pride">Confident and Proud Energy</option>
            <option value="they radiate an air of quiet wisdom and patience">Wise and Patient Atmosphere</option>
            <option value="the mood is restless and full of anticipation">Restless and Anticipatory Mood</option>
            <option value="they seem utterly relaxed and at peace with the world">Relaxed and Peaceful Feel</option>
            <option value="the environment is charged with suspense and curiosity">Suspenseful and Curious Energy</option>
            <option value="there is a festive, celebratory spirit in the air">Festive and Celebratory Mood</option>
            <option value="they emanate an aura of gentle shyness">Shy and Reserved Atmosphere</option>
            <option value="the mood feels haunting and ethereal, as if in a dream">Haunting and Ethereal Ambience</option>
            <option value="they seem focused and intensely alert to their surroundings">Focused and Alert State</option>
            <option value="a calm, hopeful energy radiates from their presence">Calm and Hopeful Mood</option>
          </select>
        </div>
        <div class="import-selector">
          <label class="import-label"><i class="fa-solid fa-location-dot"></i> Location</label>
          <select class="import-dropdown" id="location" onchange="updateCombinedPrompt()">
            [urvLocation]
          </select>
        </div>
        <div class="import-selector">
          <label class="import-label"><i class="fa-solid fa-person-walking"></i> Poses</label>
          <select class="import-dropdown" id="position" onchange="updateCombinedPrompt()">
            [urvPose]
          </select>
        </div>
        <div class="import-selector">
          <label class="import-label"><i class="fa-solid fa-camera"></i> Angle</label>
          <select class="import-dropdown" id="angle" onchange="updateCombinedPrompt()">
            <option value="">Default</option>
            <option value="shot taken from an elevated position, often using drones">Aerial</option>
            <option value="shot from behind the subject">Behind</option>
            <option value="an extreme high angle, looking directly down from above">Bird's Eye View</option>
            <option value="tilted shot with diagonal horizon, adds tension or dynamic feel">Dutch Angle / Tilt</option>
            <option value="shot at the subject's eye level, creating a neutral perspective">Eye-Level</option>
            <option value="ultra-wide-angle lens creating a spherical, distorted view">Fish-Eye</option>
            <option value="camera positioned above the subject, looking down">High Angle</option>
            <option value="camera positioned below the subject, looking up">Low Angle</option>
            <option value="mimics the subject's perspective, showing what they see">Point of View (POV)</option>
            <option value="extreme low angle, looking up from a very low point">Worm's Eye View</option>
            <option value="wide-angle lens capturing a broad scene">Wide-Angle</option>
          </select>
        </div>
        <div class="import-selector">
          <label class="import-label"><i class="fa-solid fa-crop-simple"></i> Frame</label>
          <select class="import-dropdown" id="frame" onchange="updateCombinedPrompt()">
            <option value="">Default</option>
            <option value="subject is placed in the center of the frame">Center Framing</option>
            <option value="frames the subject partially or cuts them out">Cutaway</option>
            <option value="the subject’s feet are not included in the shot">Feet Out of Frame</option>
            <option value="using elements in the environment to frame the subject naturally">Natural Framing</option>
            <option value="dividing the frame into a 3x3 grid and placing the subject at intersections">Rule of Thirds</option>
            <option value="frames from the upper part of the body to above the head">Upper Body</option>
          </select>
        </div>
        <div class="import-selector">
          <label class="import-label"><i class="fa-solid fa-video"></i> Shot Types</label>
          <select class="import-dropdown" id="shotType" onchange="updateCombinedPrompt()">
            <option value="">Default</option>
            <option value="a detailed shot of buildings or structures">Architectural</option>
            <option value="unposed and spontaneous shots of people in natural settings">Candid</option>
            <option value="focusing closely on the subject">Close-Up</option>
            <option value="frames from mid-thigh to above the head, often used in westerns">Cowboy Shot</option>
            <option value="capturing the entire body of the subject">Full Body</option>
            <option value="a broad view of a landscape">Landscape</option>
            <option value="a close-up of small subjects">Macro</option>
            <option value="the shot is positioned behind a subject, focusing on what they are looking at or interacting with">Over-the-Shoulder</option>
            <option value="a wide-angle view created by stitching multiple images together">Panorama</option>
            <option value="a close-up of a person or subject">Portrait</option>
            <option value="capturing the subject from the side">Profile Shot</option>
            <option value="the shot is positioned to the side of the subject, often capturing profiles or side views">Sideways</option>
            <option value="photographing inanimate objects arranged artistically">Still Life</option>
            <option value="candid shots of people and urban environments">Street</option>
            <option value="a tightly framed image focusing only on a part of the face or object">Extreme Close-Up</option>
            <option value="a portrait focused tightly on the head, from shoulders up">Headshot</option>
            <option value="composing the subject with significant empty or open space to draw attention">Negative Space</option>
          </select>
        </div>
        <div class="import-selector">
          <label class="import-label"><i class="fa-solid fa-screwdriver-wrench"></i> Techniques</label>
          <select class="import-dropdown" id="techniques" onchange="updateCombinedPrompt()">
            <option value="">Default</option>
            <option value="bokeh effect">Bokeh</option>
            <option value="images created to convey an abstract idea or concept">Conceptual</option>
            <option value="capturing real-life events or stories with a focus on authenticity">Documentary</option>
            <option value="emphasizing clothing and accessories, often with stylized poses and settings">Fashion</option>
            <option value="high dynamic range photography for enhanced detail in highlights and shadows">HDR</option>
            <option value="using a slow shutter speed to capture motion blur or light trails">Long Exposure</option>
            <option value="capturing scenes in low light conditions">Night</option>
            <option value="using a lens that allows for selective focus and perspective control">Tilt-Shift</option>
            <option value="using a lens with a long focal length to zoom in on distant subjects">Telephoto</option>
            <option value="using a lens with a short focal length to capture a broader scene">Wide-Angle</option>
          </select>
        </div>
        <div class="import-selector">
          <label class="import-label"><i class="fa-solid fa-clock"></i> Times</label>
          <select class="import-dropdown" id="clock" onchange="updateCombinedPrompt()">
            <option value="">Default</option>
            <option value="the sky is tinged with pink and orange as the sun begins to rise, with morning dew on the leaves">Dawn</option>
            <option value="the sun has risen, casting soft warm light typical of early morning hours">Morning</option>
            <option value="the sun is at its highest point, bright and direct light with minimal shadows">Noon</option>
            <option value="the sky turns purple and orange as the sun sets, casting long shadows on the ground">Dusk</option>
            <option value="a dark sky filled with stars, with a bright full moon illuminating the surroundings">Night</option>
            <option value="bright sunshine with clear, blue skies and no clouds">Sunny</option>
          </select>
        </div>
        <div class="import-selector">
          <label class="import-label"><i class="fa-solid fa-sun"></i> Weather</label>
          <select class="import-dropdown" id="weather" onchange="updateCombinedPrompt()">
            <option value="">Default</option>
            <option value="leaves falling from trees, crisp air, and golden, orange, and red hues in the landscape">Autumn</option>
            <option value="a gray, overcast sky with no visible sun">Cloudy</option>
            <option value="dense fog with limited visibility, surrounded by mist">Foggy</option>
            <option value="small hailstones falling, with ice pellets scattered on the ground">Hail</option>
            <option value="high moisture content in the air, making it feel sticky and warm">Humid</option>
            <option value="a light mist covering the landscape, reducing visibility but not as dense as fog">Misty</option>
            <option value="a completely covered sky with thick clouds, blocking out the sun">Overcast</option>
            <option value="heavy rain falling from the sky, with raindrops splashing on the surface">Rainy</option>
            <option value="a snowy landscape with snowflakes falling and accumulating on the ground">Snowy</option>
            <option value="flowers blooming, fresh green grass, and cool air with gentle sunlight">Spring</option>
            <option value="strong winds and heavy rain, with dark storm clouds overhead">Stormy</option>
            <option value="the sun shines brightly, the sky is clear, and the temperature is warm to hot">Summer</option>
            <option value="strong winds blowing, with objects visibly swaying or fluttering">Windy</option>
          </select>
        </div>
        <div class="import-selector">
          <label class="import-label"><i class="fa-solid fa-sliders"></i> Output Effect</label>
          <select class="import-dropdown" id="effect" onchange="updateCombinedPrompt()">
            <option value="">Default</option>
            <option value="white background">White Background</option>
            <option value="monochrome, black and white tones">Monochrome</option>
            <option value="presented in multiple views or angles">Multiviews</option>
            <option value="structured reference sheet with labeled views">Reference Sheet</option>
            <option value="retro style with cel shading and old-school coloring">Vintage</option>
            <option value="bright, bold colors and thick outlines inspired by comic books">Pop Art</option>
            <option value="styled like a high-fashion magazine cover">Magazine Cover</option>
            <option value="simplified, exaggerated cartoon-style illustration">Cartoon</option>
            <option value="raw pencil or ink sketch style, unpolished">Sketch</option>
            <option value="textured, brush-stroked painterly finish">Painting</option>
            <option value="soft watercolor paint effect with flowing tones">Watercolor</option>
            <option value="presented as part of a comic book panel">Comic Panel</option>
            <option value="grainy, low-res style with VHS scanlines and noise">VHS Effect</option>
            <option value="minimal color gradients with hard edges, poster-like">Posterized</option>
            <option value="visual distortion with digital glitch artifacts">Glitch</option>
            <option value="low-resolution pixel-based retro graphics">Pixel Art</option>
            <option value="clean black and white outlines with no coloring">Line Art</option>
            <option value="elements glowing in neon light, cyberpunk vibe">Neon Glow</option>
            <option value="blueprint-style technical drawing on a grid background">Blueprint</option>
          </select>
        </div>
        <div class="import-selector">
          <label class="import-label"><i class="fa-solid fa-lightbulb"></i> Lighting</label>
          <select class="import-dropdown" id="lighting" onchange="updateCombinedPrompt()">
            <option value="">Default</option>
            <option value="soft lighting, gentle shadows, warm ambiance">Soft & Warm</option>
            <option value="dramatic lighting, high contrast, strong shadows">Dramatic</option>
            <option value="backlight, glowing rim, subject in silhouette">Backlight Silhouette</option>
            <option value="neon lighting, colored highlights, cyberpunk atmosphere">Neon Glow</option>
            <option value="natural daylight, balanced light, clear details">Natural Daylight</option>
            <option value="moody lighting, cool tones, subdued atmosphere">Moody & Cool</option>
            <option value="spotlight, focused beam, dark surroundings">Spotlight</option>
            <option value="candlelight, flickering warm glow, intimate setting">Candlelight</option>
            <option value="golden hour, soft orange light, long shadows">Golden Hour</option>
            <option value="overcast sky, diffuse soft light, muted shadows">Overcast</option>
            <option value="studio lighting, even illumination, crisp details">Studio</option>
            <option value="colorful gradients, fantasy ambiance, surreal mood">Fantasy Colors</option>
            <option value="noir lighting, deep shadows, black and white, mysterious">Noir</option>
            <option value="harsh sunlight, strong highlights, sharp shadows">Harsh Sunlight</option>
            <option value="rainy atmosphere, reflections, blue-gray tones">Rainy Mood</option>
          </select>
        </div>
        <div class="import-selector">
          <label class="import-label"><i class="fa-solid fa-triangle-exclamation"></i> NSFW Extras</label>
          <select class="import-dropdown" id="nsfwPrompt" onchange="updateCombinedPrompt()">
            <option value="">Default</option>
            <option
              value="Sex Slave: A submissive and obedient slave, adorned with a neck collar, handcuffs, a harness, a cage bra harness, and stockings with a garter belt. They has poked nipples and a glistening sex, and their body was bruised and scarred, their expressions often resilient yet dazed."
            >
              Sex Slave
            </option>
            <option value="She has a sexy open mouth with a surprised look and beautiful, well-shaped breasts. She is topless with cum on her chest, face, and hair.">Bukkake</option>
            <option value="She is wearing high-heeled boots.">Boots</option>
            <option value="She is wearing high-heeled ankle boots.">Boots (ankle)</option>
            <option value="She is wearing knee-length high-heeled boots.">Boots (knee)</option>
            <option value="She is wearing thigh-length high-heeled boots.">Boots (thigh)</option>
            <option value="She has prominent cleavage.">Cleavage</option>
            <option value="There is semen dripping from her mouth.">Cum in mouth</option>
            <option value="She has freckles on her face and body.">Freckles</option>
            <option value="The shot is taken from behind.">From behind</option>
            <option value="She has hard, poky, erect nipples.">Hard nipples (exposed)</option>
            <option value="She has hard, poky, erect nipples visible under her clothes.">Hard nipples (under clothes)</option>
            <option value="She is wearing high heels.">High heels</option>
            <option value="She has a big, fat, round ass.">Huge ass</option>
            <option value="She has huge, enormous, big boobs.">Huge boobs</option>
            <option value="She has long legs.">Long legs</option>
            <option value="She is wearing pantyhose.">Pantyhose</option>
            <option value="Her pussy is very hairy, with natural unshaven pubic hair.">Pussy (hairy)</option>
            <option value="Her pussy is shaved and free of hair.">Pussy (shaved)</option>
            <option value="She is wearing a short skirt.">Short skirt</option>
            <option value="The shot captures her side-boob.">Side boob</option>
            <option value="She is wearing stockings.">Stockings</option>
            <option value="She is wearing stockings and a garter belt.">Stockings and garter belt</option>
            <option value="She is wearing stockings and suspenders.">Stockings and suspenders</option>
            <option value="She is tall.">Tall</option>
            <option value="She has tattoos.">Tattoos</option>
            <option value="She has full body tattoos.">Tattoos full</option>
            <option value="Her hair and body are wet.">Wet</option>
            <option
              value="An uncensored, explicit scene of porn, adult content, with a man and a woman having sex in the missionary position. They are sitting on the bed, the natural penis enters from below, she spreads her legs, leans back on the wall, and her pussy is filled with the whole cock. They face each other, her pussy is filled with massive cum, her eyes roll up, she has an ahegao expression, her eyes are wide open, and she looks shy and blushed. It is a very shy, extreme close-up, POV shot from above."
            >
              Having Sex V1
            </option>
            <option
              value="An uncensored, explicit scene of porn, adult content, with a man and a woman having sex in the missionary position. They are lying down on the bed, the natural penis enters from below, she spreads her legs, arches her back, and her pussy is filled with the whole cock. They face each other, her pussy is filled with massive cum, her eyes roll up, she has an ahegao expression, and she looks shy and blushed. It is a very shy, extreme close-up, POV shot from above."
            >
              Having Sex V2
            </option>
            <option value="An uncensored, explicit scene of sexual acts, with a man and a woman having sex in the mating press position. The desired angle and view are highlighted.">Having Sex V3</option>
            <option value="An explicit scene of a man and a woman having sex in the doggy style position. The woman is on all fours, and the man stands behind her. Their intimate connection is highlighted by the contrast of their forms.">
              Doggystyle
            </option>
            <option
              value="An explicit scene of a woman performing a deep-throat blowjob on a man. The woman's eyes are watering from a blend of pain and pleasure as she swallows the man's cock. The scene is from the man's POV, showing a natural penis with precum."
            >
              Blowjob
            </option>
            <option value="An explicit scene of a woman performing fellatio on a man's cock, shown from a POV perspective.">Fellatio</option>
          </select>
        </div>
      </div>
      <button id="resetBtn" type="button" aria-label="Reset All Boxes" class="resetBoxes-btn">
        <i class="fa-solid fa-redo" style="color: #fff; vertical-align: middle; margin-right: 4px;"></i>
        <span style="color: #fdfdfd; margin-right: 4px;">Reset All Boxes</span>
      </button>
    </div>

    <br />
    <button id="generateBtn" onclick="generate()" style="font-family: 'Google Sans', sans-serif;"><i data-lucide="sparkles" class="tabs-icon" style="margin-right: 0.3rem"></i> Imagine</button>

    <!-- Untuk mengatur hasil output dari Generasi -->
    <div class="output" id="outputContainer" style="display: none;"></div>

    <!-- Roleplay Chat Generation -->
    <!--div id="roleplayChat" style="font-size:0.8rem; display: none;"><i data-lucide="sword" class="tabs-icon"></i> Roleplay</div -->

    <br />
    <br />
    <div class="tabs">
      <div class="tab" onclick="toggleTab('forum')"><i data-lucide="messages-square" class="tabs-icon"></i> Forum</div>
      <div class="tab" onclick="toggleTab('gallery')"><i data-lucide="book-image" class="tabs-icon"></i> Gallery</div>
      <div class="tab" onclick="toggleTab('gptImage')"><i data-lucide="image-upscale" class="tabs-icon"></i> Img2Img</div>
    </div>
    <div class="tab-content" id="forumTab">
      [commentsPlugin(commentOptions)]
    </div>
    <div class="tab-content" id="galleryTab">
      <hr />
      <div style="margin: 0; padding: 0;">
        <ul style="font-size: 0.725rem; color: #fdfdfd; font-family: 'Inter', 'Segoe UI', sans-serif; margin: 0; padding-left: 1rem; line-height: 1.2;">
          <li>
            <i class="fa-solid fa-triangle-exclamation" style="color: #facc15;"></i>
            NSFW images are allowed, but any content involving minors, child pornography, hate speech, racism, religious intolerance, or any form of discrimination will result in an
            <strong style="color: #ef4444;">immediate ban</strong>.
          </li>
          <li>
            <i class="fa-solid fa-ban" style="color: #ef4444;"></i>
            Spamming the public gallery with <strong style="color: #ffffff;">more than 10 images</strong> that have the same pose or theme is prohibited; violations will result in a <strong style="color: #ef4444;">ban</strong>.
          </li>
          <li>
            <i class="fa-solid fa-users" style="color: #3b82f6;"></i>
            Respect the public gallery.
          </li>
        </ul>
      </div>
      <hr />
      [fluxSchnell(galleryOptions)]
    </div>
    <div class="tab-content" id="gptImageTab" style="overflow: auto;">
      <iframe src="https://urvillain.netlify.app/" width="100%"; height="600px";></iframe>
    </div>
    <br />
    <br />
    <!-- Partner Link -->
    <style>
      .partner-link {
            font-size: 0.8rem;
            vertical-align: middle;
            margin-left: 0.2em;
            background: linear-gradient(to right, #ffffff, #00ffff, #ff00ff);
            -webkit-background-clip: text;
            color: transparent;
            font-weight: bold;
            font-family: 'Google Sans', sans-serif;
      }
    </style>
    <partner>
      <p>
        <i data-lucide="computer" style="vertical-align:middle; margin-right:0.3rem;"></i> <strong style="font-size: 0.95rem;">Awesome Generator</strong>
      </p>
    </partner>
    <linkPartner>
      <p>
        <i data-lucide="paw-print" class="tabs-icon"></i> 
        <a 
          href="https://perchance.org/ai-furry-generator" 
          target="_blank" 
          class="partner-link"
          >AI Furry Generator
        </a>
      </p>
      <p>
        <i data-lucide="hexagon" class="tabs-icon"></i> 
        <a 
          href="https://perchance.org/ai-text-to-image-generators" 
          target="_blank" 
          class="partner-link"
          >The Lust Hive
        </a>
      </p>
    </linkPartner>
    <!-- My credit section -->
    <br />
    <br />
    <stats>
      Thank you to the <strong class="link-vaporwave">[generatorStats(null, "views")] people</strong> who viewed my generator.<br />
      It was last edited by me <strong class="link-vaporwave">[generatorStats(null, "lastEditTime")]</strong>.
    </stats>

    <p style="font-size: 80%; max-width: 400px; margin: 1rem auto;">
      © 2025
      <a
        href="https://perchance.org/urvillain-imagine"
        target="_blank"
        style="
          font-size: 1.1rem;
          vertical-align: middle;
          margin-left: 0.2em;
          background: linear-gradient(to right, #ffffff, #00ffff, #ff00ff);
          -webkit-background-clip: text;
          color: transparent;
          font-weight: bold;
          font-family: 'Inversionz', sans-serif;
        "
      >
        URVILLAIN
      </a>
    </p>
    <p style="font-size: 80%; max-width: 240px; margin: 0.5rem auto;">
      Credit by
      <a
        href="https://perchance.org/withthatway"
        target="_blank"
        style="background: linear-gradient(to right, #ff6b6b, #ff4e8a, #ff1b95); -webkit-background-clip: text; color: transparent; font-weight: bold; text-shadow: 0 0 10px rgba(255, 20, 147, 0.8), 0 0 20px rgba(255, 20, 147, 0.6);"
      >
        WithThatWay
      </a>
    </p>

    <br />

    <button class="menu-btn" onclick="toggleMenu()">
      <div></div>
      <div></div>
      <div></div>
    </button>

    <div class="menu-content" id="menuContentEl">
      <button id="openWebThemePopupBtn" onclick="toggleWebThemePopup()">
        <i class="fa-solid fa-palette"></i> Theme Settings
      </button>
      <button id="kofi-toggle"><i class="fas fa-coffee"></i> Support Me</button>
      <button id="fullscreenBtn" onclick="toggleFullscreen()"><i class="fa-solid fa-expand"></i> Fullscreen</button>
      <button class="button-minimalist" onclick="showAbout()"><i class="fa-solid fa-circle-info"></i> About</button>
    </div>

    <div id="webThemePopupContainer" class="web-theme-popup">
        <div class="web-theme-popup-header">
            <h2><i class="fa-solid fa-sliders"></i> Web Theme Settings</h2>
            <button class="close-main-btn" onclick="toggleWebThemePopup()"><i class="fa-solid fa-times"></i></button>
        </div>

        <div class="web-theme-popup-content">
            <div class="theme-section" id="backgroundSection">
                <h3><i class="fa-solid fa-image"></i> Change Background</h3>
                <div class="controls-group">
                    <label>Cycle Colors:</label>
                    <div>
                        <button class="arrow-btn" id="prevColorBtn" onclick="prevColor()"><i class="fa-solid fa-angles-left"></i></button>
                        <button class="arrow-btn" id="nextColorBtn" onclick="nextColor()"><i class="fa-solid fa-angles-right"></i></button>
                    </div>
                </div>
                <div class="controls-group">
                    <label for="bgUrlInput">Image URL:</label>
                    <input type="text" id="bgUrlInput" placeholder="Enter image URL..." />
                </div>
                <button class="set-background-btn action-btn" onclick="setBackgroundImage()"><i class="fa-solid fa-check"></i> Set Background</button>
            </div>

            <hr class="section-divider">

            <div class="theme-section" id="themeColorSection">
                <h3><i class="fa-solid fa-fill-drip"></i> Select Theme Color</h3>
                <div class="controls-group">
                    <label>Cycle Themes:</label>
                    <div>
                        <button class="arrow-btn" onclick="prevThemeColor()"><i class="fa-solid fa-angles-left"></i></button>
                        <button class="arrow-btn" onclick="nextThemeColor()"><i class="fa-solid fa-angles-right"></i></button>
                    </div>
                </div>
                <div class="controls-group">
                    <label for="colorPicker">Custom Color:</label>
                    <input type="color" id="colorPicker" value="#cb9952" oninput="updateThemeColor(this.value)" />
                </div>
            </div>

            <hr class="section-divider">

            <div class="theme-section" id="fontSelectionSection">
                <h3><i class="fa-solid fa-font"></i> Select Font</h3>
                <div class="controls-group">
                    <label for="fontSelectEl">Font Family:</label>
                    <select id="fontSelectEl" onchange="changeFont(this.value)">
                        <option value="'Roboto', sans-serif">Roboto</option>
                        <option value="'Google Sans', sans-serif">Google Sans</option>
                        <option value="'Audiowide', sans-serif">Audiowide</option>
                        <option value="'Bebas Neue', sans-serif">Bebas Neue</option>
                        <option value="DM Sans">DM Sans</option>
                        <option value="'Digital-7', sans-serif">Digital-7</option>
                        <option value="'Electrolize', sans-serif">Electrolize</option>
                        <option value="'Exo', sans-serif">Exo</option>
                        <option value="'Futura Condensed', sans-serif">Futura Condensed</option>
                        <option value="'Neuropol', sans-serif">Neuropol</option>
                        <option value="'Orbitron', sans-serif">Orbitron</option>
                        <option value="'Press Start 2P', sans-serif">Press Start 2P</option>
                        <option value="'Roboto Mono', sans-serif">Roboto Mono</option>
                        <option value="'Space Mono', sans-serif">Space Mono</option>
                        <option value="'Streetbrush', sans-serif">Streetbrush</option>
                        <option value="'Synthwave', sans-serif">Synthwave</option>
                        <option value="'VT323', sans-serif">VT323</option>
                    </select>
                </div>
            </div>
        </div>
    </div>

    <!-- About Me -->
    <div id="aboutModal" style="display: none;">
      <div class="modal-backdrop" onclick="hideAbout(event)">
        <div class="modal-content" onclick="event.stopPropagation()">
          <button aria-label="Close about dialog" class="close-modal-btn" onclick="hideAbout(event)">&times;</button>
          <h2 style="margin-top: -8 px;">
            <i data-lucide="boxes" style="vertical-align: middle;"></i> <span style="font-family: 'Inversionz', sans-serif; font-size: 2rem;">URVILLAIN</span>
            <span style="font-family: 'Roboto', sans-serif; font-size: 0.8rem; color: chocolate;">Imagine</span>
          </h2>
          <small style="color: #888;">Version <span>2.5.1</span></small><br />
          <br />
          <p>
            Created by <i data-lucide="dice-5" style="vertical-align: middle; width: 14px; height: 14px; margin: 0.2em auto;"></i>
            <a href="https://perchance.org/withthatway" target="_blank" style="text-decoration: none; font-weight: bold;">WithThatWay</a><br />
            This tool allows you to generate images based on your prompts using <strong>Flux Schnell</strong> API.
          </p>
        </div>
      </div>
    </div>

    <!-- Donation Page -->
    <div id="kofi-panel">
      <div class="kofi-modal" id="kofi-modal">
        <button class="kofi-close" id="kofi-close" aria-label="Close"><i class="fa-solid fa-times"></i></button>
        <iframe src="https://ko-fi.com/withthatway/?hidefeed=true&widget=true&embed=true" height="440" width="100%" style="border: none; display: block; width: 100%;" title="Donate on Ko-fi"></iframe>
      </div>
    </div>

    <!--div id="backgroundPopup" class="background-popup">
      <button class="close-btn" onclick="toggleBackgroundPopup()">✕</button>
      <h2>Change Background</h2>
      <div>
        <button class="arrow-btn" id="prevColorBtn" onclick="prevColor()"><i class="fa-solid fa-angles-left"></i></button>
        <button class="arrow-btn" id="nextColorBtn" onclick="nextColor()"><i class="fa-solid fa-angles-right"></i></button>
      </div>
      <input type="text" id="bgUrlInput" placeholder="Enter image URL..." style="margin: 1rem; color: #000000;" />
      <button class="set-background-btn" onclick="setBackgroundImage()" style="margin: 8px;">Set Background</button>
    </div>

    <div id="themePopup" class="theme-popup">
      <button class="close-btn" onclick="toggleThemePopup()">✕</button>
      <h2>Select Theme Color</h2>
      <div>
        <button class="arrow-btn" onclick="prevThemeColor()"><i class="fa-solid fa-angles-left"></i></button>
        <button class="arrow-btn" onclick="nextThemeColor()"><i class="fa-solid fa-angles-right"></i></button>
      </div>
      <input type="color" id="colorPicker" value="#cb9952" oninput="updateThemeColor(this.value)" />
    </div-->

    <div id="popupEl" class="popup">
      <button class="close-btn" onclick="togglePopup()">✕</button>
      <h2>Drop a keyword or upload an image — I’ll help bring your imagination to life.</h2>
      <!-- Tambahkan di dalam popupEl, sebelum tombol Imagine -->
      <div id="imageUploadContainer" style="margin: 1rem 0; display: flex; flex-direction: column; align-items: center;">
        <input type="file" id="imageInput" accept="image/png,image/jpeg,image/jpg,image/webp" style="margin-bottom: 0.7rem;" />
        <div id="imagePreviewWrapper" style="display: none; flex-direction: column; align-items: center;">
          <img id="imagePreview" style="max-width: 220px; max-height: 220px; border-radius: 0.7rem; margin-bottom: 0.5rem; box-shadow: 0 2px 12px #0002;" />
          <button id="clearImageBtn" type="button" style="background: #ff6b6b; color: white; border: none; padding: 0.4rem 1rem; border-radius: 0.4rem; cursor: pointer;">Remove Image</button>
        </div>
        <div id="imageError" style="color: #ff6b6b; font-size: 0.9rem; margin-top: 0.2rem; display: none;"></div>
      </div>
      <textarea id="keywordInput" placeholder="Enter a keyword..."></textarea>
      <!-- input id="keywordInput" placeholder="Enter a keyword..." style="color: black" /-->
      <button id="imagineBtn" class="imagine-btn" onclick="imagine()"><i data-lucide="feather" class="tabs-icon" style="margin-right: 0.3rem;"></i> Write</button>
      <span style="color: #fff;">Powered by </span>
      <span style="color: #ff8240; font-weight: bold;">Mistral 3.1 Small 24B</span>
    </div>

    <!-- New completion popup -->
    <div id="completionPopupEl" class="popup">
      <h2>
        Now you can click<br />
        <i data-lucide="sparkles" class="tabs-icon" style="margin-right: 0.3rem;"></i> Imagine
      </h2>
      <button onclick="hideCompletionPopup()">Okay</button>
    </div>

    <!--
    <div id="commentsPopupEl" class="popup">
      <button class="close-btn" onclick="toggleComments()">✕</button>
      <h2><i class="fa-solid fa-coment-dots"></i> Comments</h2>
      <div class="comments-section" style="width: 100%; height: calc(100% - 50px); overflow-y: auto;">[commentsPlugin(commentOptions)]</div>
    </div>
    -->

    <style>
      .scrollButtonLucide {
        width: 1.6rem;
        height: 1.6rem;
        margin: 0;
        vertical-align: middle;
        aspect-ratio: 1/1;
      }
    </style>

    <!-- To up -->
    <button id="scrollTopBtn" onclick="scrollToTop()"><i data-lucide="chevrons-up" class="scrollButtonLucide"></i></button>

    <!-- To down -->
    <button id="scrollBottomBtn" onclick="scrollToBottom()"><i data-lucide="chevrons-down" class="scrollButtonLucide"></i></button>

    <!-- Announcement Page -->
    <button id="changelogBtn" onclick="changelogPopup()"><i data-lucide="circle-alert" class="scrollButtonLucide"></i></button>

    <!-- Compressed Blob GZ -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pako/2.1.0/pako.min.js"></script>
    
    <!-- Active Users -->
    <script src="https://cdn.socket.io/4.7.4/socket.io.min.js"></script>
    <script>
      const socket = io("https://striped-developing-wax.glitch.me/", {
        autoConnect: true,
        reconnection: true,
        reconnectionAttempts: 2,
        reconnectionDelay: 5000,
        reconnectionDelayMax: 10000,
      });
      let instanceId = "hub-id-" + Number(Math.random().toString().slice(2)).toString(16);
      let id;
      if (localStorage.getItem("iID") == null) {
        localStorage.setItem("iID", instanceId);
        id = localStorage.getItem("iID");
        console.log(id);
      } else {
        id = localStorage.getItem("iID");
        console.log(id);
      }
      socket.emit("hub-userId", id);

      socket.on("hub-userCount", (count) => {
        if (socket.connected) {
          // temporary failure, the socket will automatically try to reconnect
        } else {
          // the connection was denied by the server
          // in that case, `socket.connect()` must be manually called in order to reconnect
          // console.log(error.message);
        }
        usrCount.innerHTML = count;
      });
    </script>

    <!-- Main JS -->
    <script>
      // Function to lock seed type box
      function toggleLock(button) {
        let input = button.previousElementSibling;
        if (input.readOnly) {
          input.readOnly = false;
          button.innerHTML = '<i class="fas fa-unlock"></i>';
        } else {
          input.readOnly = true;
          button.innerHTML = '<i class="fas fa-lock"></i>';
        }
      }

      // Function to toggle between tabs
      function toggleTab(tabName) {
        const tab = document.querySelector(`.tab[onclick="toggleTab('${tabName}')"]`);
        const tabContent = document.getElementById(`${tabName}Tab`);

        const isActive = tab.classList.contains("active");
        document.querySelectorAll(".tab").forEach((tab) => tab.classList.remove("active"));
        document.querySelectorAll(".tab-content").forEach((content) => {
          content.classList.remove("active");
        });

        if (!isActive) {
          tab.classList.add("active");
          setTimeout(() => {
            tabContent.classList.add("active");
          }, 10);
        } else {
          tabContent.classList.remove("active");
        }
      }

      /**
       * Fungsi ini menghasilkan path CSS unik untuk sebuah elemen.
       * Diambil dari plugin 'remember' untuk konsistensi.
       */
      function getCssPath(el) {
        if (!(el instanceof Element)) {
          return;
        }
        let path = [];
        while (el.nodeType === Node.ELEMENT_NODE) {
          let selector = el.nodeName.toLowerCase();
          if (el.id) {
            selector += '#' + el.id;
            path.unshift(selector);
            break;
          } else {
            let sib = el,
              nth = 1;
            while (sib = sib.previousElementSibling) {
              if (sib.nodeName.toLowerCase() == selector) {
                nth++;
              }
            }
            if (nth != 1) {
              selector += ":nth-of-type(" + nth + ")";
            }
          }
          path.unshift(selector);
          el = el.parentNode;
        }
        return path.join(" > ");
      }

      /**
       * Fungsi untuk memicu event pada elemen secara programatik.
       * Berguna untuk memastikan semua listener (termasuk dari addEventListener) terpanggil.
       */
      function triggerEvent(el, type) {
        if (document.createEvent) {
          let event = document.createEvent("HTMLEvents");
          event.initEvent(type, true, true);
          el.dispatchEvent(event);
        } else {
          let event = document.createEventObject();
          el.fireEvent('on' + type, event);
        }
      }

      /**
       * Fungsi yang dimodifikasi untuk mereset semua elemen <select> di dalam #UserElTab,
       * menghapus data localStorage-nya, dan memicu event 'change'.
       */
      function resetAllSelects() {
        const container = document.getElementById("UserElTab");
        if (!container) return;

        // Rekonstruksi prefix yang digunakan oleh plugin 'remember'.
        // 'generatorName' adalah variabel global yang tersedia di Perchance.
        const prefix = generatorName + "__rememberPlugin__variable__";

        const selects = container.querySelectorAll("select");
        selects.forEach((select) => {
          // Bagian baru: Hapus data dari localStorage
          // 1. Dapatkan path CSS dari elemen <select> saat ini.
          const cssPath = getCssPath(select);
          // 2. Buat key localStorage yang sesuai dengan format plugin.
          const storageKey = prefix + "_input_forms_" + cssPath;
          // 3. Hapus item dari localStorage.
          localStorage.removeItem(storageKey);

          // Bagian lama: Reset nilai di tampilan
          select.selectedIndex = 0;

          // Trigger event 'change' dan 'input' untuk memastikan UI diperbarui
          // dan semua script lain yang "mendengarkan" perubahan ini bereaksi.
          triggerEvent(select, "change");
          triggerEvent(select, "input");
        });
      }

      // Event listener untuk tombol reset boxes
      document.getElementById("resetBtn").addEventListener("click", function () {
        const icon = this.querySelector(".fa-redo");
        // Hapus kelas biar bisa retrigger kalau ditekan cepat-cepat berkali-kali
        icon.classList.remove("fa-spin-once");
        // Pakai timeout supaya reflow selesai baru tambahkan lagi efeknya
        setTimeout(() => icon.classList.add("fa-spin-once"), 10);
        // Hilangkan kelas setelah animasinya selesai supaya siap diputar lagi nanti
        icon.addEventListener("animationend", () => icon.classList.remove("fa-spin-once"), { once: true });
        resetAllSelects();
      });

      // Function to update guidance scale value
      function updateSliderValue(value) {
        sliderValueEl.innerText = value;
        guidanceScale = value;
      }

      // Function to update orientation value
      function updateOrientation(value) {
        const orientations = [
          '<i class="fa-solid fa-square" aria-hidden="true"></i> Square 1:1',
          '<i class="fa-solid fa-image-portrait" aria-hidden="true"></i> Portrait 2:3',
          '<i class="fa-solid fa-panorama" aria-hidden="true"></i> Landscape 3:2',
        ];
        const resolutions = ["768x768", "512x768", "768x512"];

        // pakai innerHTML biar bisa render tag <i>
        orientationValueEl.innerHTML = orientations[value];
        resolution = resolutions[value];
      }

      let selectedStyle = "";
      let hiddenNegativePrompt = "";
      let negativePrompt = "";

      // Function to select style option
      function selectStyle(element) {
        document.querySelectorAll("#styleOptionsEl .style-option").forEach((el) => el.classList.remove("selected"));
        element.classList.add("selected");

        // Extract values before and after '(negativePrompt:::' markers only for the selected style
        const [beforeNegativePrompt, negativePromptString] = element.dataset.value.split("(negativePrompt:::");
        const additionalNegativePrompts = negativePromptString ? negativePromptString.replace(")", "").trim() : "";

        selectedStyle = beforeNegativePrompt.trim();

        hiddenNegativePrompt = additionalNegativePrompts;

        localStorage.selectedStyle = selectedStyle;

        negativePromptSectionEl.hidden = false;
      }

      // Function to toggle menu visibility
      function toggleMenu() {
        const menuBtn = document.querySelector(".menu-btn");
        const menuContent = menuContentEl;
        menuContent.classList.toggle("active");
        menuBtn.classList.toggle("active");
      }

      // Function to show the background popup
      function showBackgroundPopup() {
        backgroundPopup.style.display = "block";
      }

      // Function to toggle the background popup
      function toggleBackgroundPopup() {
        backgroundPopup.style.display = backgroundPopup.style.display === "block" ? "none" : "block";
      }

      // Function to toggle the theme popup
      function toggleThemePopup() {
        themePopup.style.display = themePopup.style.display === "block" ? "none" : "block";
      }

      // Theme colors
      let themeColorIndex = 0;
      const themeColors = ["cb9952", "#4e4e8a", "#ff007f", "#00bfff", "#8a2be2", "#ff4500", "#32cd32", "#ff1493", "#00ffff", "#7cfc00", "#9400d3", "#ff6347", "#1e90ff"];

      // Functions for theme color
      function prevThemeColor() {
        themeColorIndex = (themeColorIndex - 1 + themeColors.length) % themeColors.length;
        updateThemeColor(themeColors[themeColorIndex]);
      }

      function nextThemeColor() {
        themeColorIndex = (themeColorIndex + 1) % themeColors.length;
        updateThemeColor(themeColors[themeColorIndex]);
      }

      function updateThemeColor(color) {
        document.documentElement.style.setProperty("--primary-color", color);
        runningText.style.color = color;
        localStorage.themeBorder = color;
      }

      // Function to change background color and save to localStorage
      let colorIndex = 0;
      const colors = [
        "#0f0c29, #302b63, #24243e",
        "#1a1a2e, #16213e, #0f3460",
        "#2c3e50, #4ca1af, #2c3e50",
        "#0d0d0d, #3a3a3a, #666666",
        "#45046a, #5c0080, #32004b",
        "#021b79, #0575e6, #00f260",
        "#232526, #414345, #6b6e70",
        "#1f1c2c, #928dab, #1f1c2c",
        "#0b486b, #f56217, #0b486b",
        "#03001e, #7303c0, #ec38bc",
        "#0d324d, #7f5a83, #7f5a83",
        "#000000, #434343, #666666",
        "#2a0845, #6441a5, #2a0845",
        "#101820, #3e6f9e, #101820",
        "#1b2735, #485461, #1b2735",
        "#1c1c1c, #313131, #1c1c1c",
        "#3a0ca3, #f72585, #7209b7",
        "#000428, #004e92, #000428",
        "#2e003e, #880085, #2e003e",
        "#090909, #1f1f1f, #383838",
        "#240b36, #c31432, #240b36",
        "#040024, #093028, #040024",
      ];

      function prevColor() {
        colorIndex = (colorIndex - 1 + colors.length) % colors.length;
        updateBackgroundColor();
      }

      function nextColor() {
        colorIndex = (colorIndex + 1) % colors.length;
        updateBackgroundColor();
      }

      function updateBackgroundColor() {
        document.body.style.background = `linear-gradient(135deg, ${colors[colorIndex]})`;
        localStorage.background = document.body.style.background;
        localStorage.removeItem("backgroundImage");
      }

      // Function to set background image via URL
      function setBackgroundImage() {
        let url = bgUrlInput.value.trim();
        if (url) {
          document.body.style.background = `url('${url}') no-repeat center center fixed`;
          document.body.style.backgroundSize = "cover";
          localStorage.backgroundImage = url;
        }
      }

      // Function to show about info
      function showAbout() {
        document.getElementById("aboutModal").style.display = "";
        setTimeout(() => document.querySelector(".modal-backdrop").focus(), 50);
      }

      function hideAbout(e) {
        // close if click backdrop or button only—ignore inside content clicks!
        if (e.target.classList.contains("modal-backdrop") || e.target.classList.contains("close-modal-btn")) document.getElementById("aboutModal").style.display = "none";
      }

      // Function to toggle keyword input pop-up
      function togglePopup() {
        if (popupEl.style.display === "block") {
          popupEl.style.opacity = 0;
          setTimeout(() => {
            popupEl.style.display = "none";
            document.querySelector(".brain-icon").style.pointerEvents = "auto";
          }, 500);
        } else {
          popupEl.classList.remove("fade-out"); // Fix utama
          popupEl.style.display = "block";
          popupEl.style.opacity = 1;
          document.querySelector(".brain-icon").style.pointerEvents = "none";
        }
      }

      // Function to toggle comments section
      function toggleComments() {
        commentsPopupEl.style.display = commentsPopupEl.style.display === "block" ? "none" : "block";
      }

      // Image Upload Logic
      let imageBase64 = null;

      const imageInput = document.getElementById("imageInput");
      const imagePreviewWrapper = document.getElementById("imagePreviewWrapper");
      const imagePreview = document.getElementById("imagePreview");
      const clearImageBtn = document.getElementById("clearImageBtn");
      const imageError = document.getElementById("imageError");

      // Reset image state
      function resetImageUpload() {
        imageInput.value = "";
        imagePreviewWrapper.style.display = "none";
        imagePreview.src = "";
        imageError.style.display = "none";
        imageBase64 = null;
      }

      // Clean up button
      clearImageBtn.onclick = resetImageUpload;

      // File input change handler
      imageInput.onchange = function () {
        imageError.style.display = "none";
        const file = this.files[0];

        if (!file) {
          resetImageUpload();
          return;
        }

        const validTypes = ["image/png", "image/jpeg", "image/jpg", "image/webp"];
        if (!validTypes.includes(file.type)) {
          imageError.textContent = "Format must PNG, JPG, JPEG, atau WEBP.";
          imageError.style.display = "block";
          resetImageUpload();
          return;
        }
        if (file.size > 6 * 1024 * 1024) {
          imageError.textContent = "Ukuran gambar maksimal 6MB.";
          imageError.style.display = "block";
          resetImageUpload();
          return;
        }

        // Preview
        const reader = new FileReader();
        reader.onload = function (e) {
          imagePreview.src = e.target.result;
          imagePreviewWrapper.style.display = "flex";
          imageBase64 = e.target.result;
        };
        reader.readAsDataURL(file);
      };

      // Function to handle image imagination process
      async function imagine() {
        imagineBtn.textContent = "Writing...";
        imagineBtn.disabled = true;

        imagineBtn.classList.add("generating");
        document.querySelector(".brain-icon").classList.add("spin");
        window.lucide.createIcons();

        popupEl.classList.remove("fade-out");
        popupEl.style.display = "block";
        setTimeout(() => {
          popupEl.classList.add("fade-out");
          setTimeout(() => (popupEl.style.display = "none"), 500);
        }, 2000);

        const keyword = keywordInput.value;

        if (!keyword && !imageBase64) {  // Jika TIDAK ADA keyword DAN TIDAK ADA gambar
          alert("Please enter a keyword or upload an image.");
          imagineBtn.textContent = "Imagine";
          imagineBtn.disabled = false;
          return;
        }

        // Jika ada gambar tapi tidak ada keyword, ganti dengan "Image to Text"
        const finalKeyword = imageBase64 && !keyword ? "Image to Text" : keyword;

        const contentArr = imageBase64 
        ? [{ type: "image_url", image_url: { url: imageBase64 } }]
        : [{ type: "text", text: finalKeyword }];

        const userPayload = {
          role: "user",
          content: contentArr,
        };

        const randomSeed = Math.floor(Math.random() * 1000000000);

        const imagePrompt = `
        You are a creative image visual narrator. Your task is to transform the following user input:

  ---
  ${keyword}
  ---

  Into a detailed visual prompt that vividly describes the scene, strictly incorporating the following elements in this exact order:

  - Subject  
  - Environment / Background  
  - Style Reference (use general terms such as: photorealistic, anime, manga, digital illustration, concept art, pixel art, low poly, painting, watercolor, sketch, ink drawing, vector art, 3D render, surrealism, fantasy art, cyberpunk, vaporwave, noir, impressionism, minimalist, cartoon, flat design, matte painting, isometric, cinematic, storyboard, comic book, ukiyo-e, etc.)

  > Style Reference should be based on visual genre, rendering approach, or artistic aesthetic — not individual artist names.

  - Medium / Texture  
  - Lighting / Mood  
  - Color Palette  
  - Composition / Camera Angle  
  - Fine Details  
  - Quality / Resolution (use terms like: HD, 4K, 8K, ultra-detailed, high-definition, cinematic quality, sharp focus, crisp textures, production quality, film-grade, VR-ready)  
  - Action / Movement  
  - Objects / Props & Constraints (negative prompts)

  Special Instruction for Explicit / NSFW Content:  
  - If the user input or provided image contains explicit or adult content, describe all explicit details clearly, explicitly, and without censorship. Use appropriate uncensored and NSFW terminology to reflect the mature nature of the content accurately. Ensure that all adult themes are handled with full acknowledgment of their explicitness and without euphemisms.

  Begin the final result with: "The image shows".

  Strict Rules:
  1. Do NOT add any commentary, explanation, or extra descriptions beyond the visual narration.  
  2. Output only the final visual narration as a clean, fluent, natural-language prompt.  
  3. Follow the exact order of elements as listed above.  
  4. Ensure each element is addressed clearly, using concise phrases or sentences.
  
  Image Analysis:
  - When an image is provided, capture all elements with extreme precision to achieve at least 97% visual accuracy and likeness.

  Final Instruction:
  - Return a single, medium-length paragraph only. Do not use markdown, bullet points, or line breaks.`;

        const imageInstruct = imagePrompt.trim();

        // Define the API URL and request payload
        const API_URL = `https://text.pollinations.ai/openai`;
        const requestPayload = {
          model: "mistral",
          messages: [{ role: "system", content: imageInstruct }, userPayload],
          seed: randomSeed,
          max_tokens: 512,
          temperature: 0.6,
          top_p: 0.9,
          private: true,
          stream: true,
        };

        try {
          // Kirim request ke API dengan stream aktif
          const response = await fetch(API_URL, {
            method: "POST",
            headers: {
              "Content-Type": "application/json;charset=UTF-8",
            },
            body: JSON.stringify(requestPayload),
          });

          if (!response.ok) {
            throw new Error(`API request failed with status ${response.status}`);
          }

          // Dapatkan reader dari response stream
          const reader = response.body.getReader();
          const decoder = new TextDecoder("utf-8");
          let resultText = "";
          let buffer = ""; // Buffer untuk menyimpan data yang belum selesai diproses

          // Bersihkan tampilan description sebelum streaming dimulai
          userPromptInput.value = "";

          // Proses stream secara incremental dengan buffer management
          while (true) {
            const { value, done } = await reader.read();

            if (done) {
              // Proses sisa buffer jika ada
              if (buffer.trim()) {
                await processBufferLines(buffer);
              }
              break;
            }

            // Dekode chunk dan tambahkan ke buffer
            const chunk = decoder.decode(value, { stream: true });
            buffer += chunk;

            // Proses baris yang sudah lengkap (diakhiri dengan \n)
            const lines = buffer.split("\n");
            // Simpan baris terakhir yang mungkin belum lengkap
            buffer = lines.pop() || "";

            // Proses setiap baris yang sudah lengkap
            for (const line of lines) {
              await processStreamLine(line.trim());
            }
          }

          // Fungsi untuk memproses baris stream
          async function processStreamLine(line) {
            if (!line || !line.startsWith("data: ")) return;

            const dataStr = line.substring("data: ".length).trim();

            if (dataStr === "[DONE]") {
              return;
            }

            try {
              const parsed = JSON.parse(dataStr);
              const delta = parsed.choices?.[0]?.delta?.content;

              if (delta) {
                resultText += delta;
                userPromptInput.value = resultText;

                // Gunakan scheduler yang lebih efisien untuk update UI
                await new Promise((resolve) => {
                  if (typeof requestIdleCallback !== "undefined") {
                    requestIdleCallback(resolve, { timeout: 16 });
                  } else {
                    requestAnimationFrame(resolve);
                  }
                });
              }
            } catch (error) {
              console.warn("Error parsing stream chunk:", error, "Data:", dataStr);
              // Lanjutkan proses meskipun ada error parsing
            }
          }

          // Fungsi untuk memproses sisa buffer
          async function processBufferLines(remainingBuffer) {
            const finalLines = remainingBuffer.split("\n");
            for (const line of finalLines) {
              await processStreamLine(line.trim());
            }
          }
        } catch (error) {
          console.error("Error retrieving AI response:", error);
          userPromptInput.value = "An error occurred. Please try again.";
        } finally {
          // Cleanup UI state
          imagineBtn.classList.remove("generating");
          imagineBtn.innerHTML = `<i data-lucide="feather" class="tabs-icon" style="margin-right: 0.3rem;"></i> Write`;
          imagineBtn.disabled = false;
          document.querySelector(".brain-icon").classList.remove("spin");
          document.querySelector(".brain-icon").innerHTML = '<i data-lucide="atom" class="urv-icon"></i>';
          document.querySelector(".brain-icon").style.pointerEvents = "auto";
          window.lucide.createIcons();

          showCompletionPopup();
          resetImageUpload();
        }
      }

      // Function to display completion message pop-up
      function showCompletionPopup() {
        completionPopupEl.style.display = "block";
      }

      // Function to hide completion popup
      function hideCompletionPopup() {
        completionPopupEl.style.display = "none";
      }

      let selectedThemes = "";

      // Function to process imported values from another generator
      function updateSelectedThemes(selectedValue) {
        const selectedPrompt = theme[selectedValue]?.prompt || "";
        selectedThemes = selectedPrompt;
      }

      let combinedPrompt = "";

      // Joined all selected boxes
      function updateCombinedPrompt() {
        // Depiction
        const speciesValue = document.getElementById("species").value;
        const ethnicityValue = document.getElementById("ethnicity").value;
        const genderValue = document.getElementById("gender").value;
        const maturityValue = document.getElementById("maturity").value;
        const personaValue = document.getElementById("persona").value;
        const professionsValue = document.getElementById("professions").value;
        const hairTypeValue = document.getElementById("hairType").value;
        const hairLengthValue = document.getElementById("hairLength").value;
        const hairStyleValue = document.getElementById("hairStyle").value;
        const hairAddValue = document.getElementById("hairAdd").value;
        const hairColorValue = document.getElementById("hairColor").value;
        const eyesColorValue = document.getElementById("eyesColor").value;
        const skinColorValue = document.getElementById("skinColor").value;
        const facialValue = document.getElementById("facial").value;
        const expressionValue = document.getElementById("expression").value;
        const bodyShapeValue = document.getElementById("bodyShape").value;
        const bodyBuildValue = document.getElementById("bodyBuild").value;
        const chestSizeValue = document.getElementById("chestSize").value;
        // Appearance
        const headWearValue = document.getElementById("headWear").value;
        const topWearValue = document.getElementById("topWear").value;
        const bottomWearValue = document.getElementById("bottomWear").value;
        const footWearValue = document.getElementById("footWear").value;
        const handsAccValue = document.getElementById("handsAcc").value;
        const hotWearValue = document.getElementById("hotWear").value;
        const fantasyWearValue = document.getElementById("fantasyWear").value;
        const traditionalWearValue = document.getElementById("traditionalWear").value;
        const moreWearValue = document.getElementById("moreWear").value;
        // Contextual
        const moodValue = document.getElementById("moodAura").value;
        const locationValue = document.getElementById("location").value;
        const positionValue = document.getElementById("position").value;
        const angleValue = document.getElementById("angle").value;
        const frameValue = document.getElementById("frame").value;
        const shotTypeValue = document.getElementById("shotType").value;
        const techniquesValue = document.getElementById("techniques").value;
        const clockValue = document.getElementById("clock").value;
        const weatherValue = document.getElementById("weather").value;
        const effectValue = document.getElementById("effect").value;
        const lightingValue = document.getElementById("lighting").value;
        const nsfwPromptValue = document.getElementById("nsfwPrompt").value;

        // === Defined the prompts for each selection ==== \\
        const speciesPrompt = species[speciesValue]?.prompt || "";
        const ethnicityPrompt = ethnicity[ethnicityValue]?.prompt || "";
        const genderPrompt = genderValue || "";
        const maturityPrompt = maturityValue || "";
        const personaPrompt = persona[personaValue]?.prompt || "";
        const professionsPrompt = professions[professionsValue]?.prompt || "";
        const hairTypePrompt = hairTypeValue || "";
        const hairLengthPrompt = hairLengthValue || "";
        const hairStylePrompt = hairStyleValue || "";
        const hairAddPrompt = hairAddValue || "";
        const hairColorPrompt = hairColorValue || "";
        const eyesColorPrompt = eyesColorValue || "";
        const skinColorPrompt = skinColorValue || "";
        const facialPrompt = facialValue || "";
        const expressionPrompt = expression[expressionValue]?.prompt || "";
        const bodyShapePrompt = bodyShape[bodyShapeValue]?.prompt || "";
        const bodyBuildPrompt = bodyBuildValue || "";
        const chestSizePrompt = chestSizeValue || "";
        const headWearPrompt = headWear[headWearValue]?.prompt || "";
        const topWearPrompt = topWear[topWearValue]?.prompt || "";
        const bottomWearPrompt = bottomWear[bottomWearValue]?.prompt || "";
        const footWearPrompt = footWear[footWearValue]?.prompt || "";
        const handsAccPrompt = handsAccValue || "";
        const hotWearPrompt = hotWear[hotWearValue]?.prompt || "";
        const fantasyWearPrompt = fantasyWear[fantasyWearValue]?.prompt || "";
        const traditionalWearPrompt = traditionalWear[traditionalWearValue]?.prompt || "";
        const moreWearPrompt = moreWear[moreWearValue]?.prompt || "";
        const moodAuraPrompt = moodValue || "";
        const locationPrompt = location[locationValue]?.prompt || "";
        const positionPrompt = position[positionValue]?.prompt || "";
        const anglePrompt = angleValue || "";
        const framePrompt = frameValue || "";
        const shotTypePrompt = shotTypeValue || "";
        const techniquesPrompt = techniquesValue || "";
        const clockPrompt = clockValue || "";
        const weatherPrompt = weatherValue || "";
        const effectPrompt = effectValue || "";
        const lightingPrompt = lightingValue || "";
        const nsfwPrompt = nsfwPromptValue || "";

        // Combine the prompts (adjust the format as needed, e.g., using spaces, commas, or other formats)
        combinedPrompt = [
          speciesPrompt,
          ethnicityPrompt,
          genderPrompt,
          maturityPrompt,
          personaPrompt,
          professionsPrompt,
          hairTypePrompt,
          hairLengthPrompt,
          hairStylePrompt,
          hairAddPrompt,
          hairColorPrompt,
          eyesColorPrompt,
          skinColorPrompt,
          facialPrompt,
          expressionPrompt,
          bodyShapePrompt,
          bodyBuildPrompt,
          chestSizePrompt,
          headWearPrompt,
          topWearPrompt,
          bottomWearPrompt,
          footWearPrompt,
          handsAccPrompt,
          hotWearPrompt,
          fantasyWearPrompt,
          traditionalWearPrompt,
          moreWearPrompt,
          moodAuraPrompt,
          locationPrompt,
          positionPrompt,
          anglePrompt,
          framePrompt,
          shotTypePrompt,
          techniquesPrompt,
          clockPrompt,
          weatherPrompt,
          effectPrompt,
          lightingPrompt,
          nsfwPrompt,
        ]
          .filter((x) => x && x.trim())
          .join(", ");
      }

      let userPrompt = "";
      let evaluateAllVar = "";
      
      // Enhanced roleplay integration with stop button and better error handling
      let currentRoleplayRequest = null; // Track current request for cancellation

      // Function to convert dataUrl to blob
      function dataUrlToBlob(dataUrl) {
        return new Promise((resolve) => {
          const canvas = document.createElement("canvas");
          const ctx = canvas.getContext("2d");
          const img = new Image();

          img.onload = function () {
            canvas.width = img.width;
            canvas.height = img.height;
            ctx.drawImage(img, 0, 0);

            // Convert to PNG first
            canvas.toBlob(resolve, "image/png");
          };

          img.src = dataUrl;
        });
      }

      // Function to download file
      function downloadBlob(blob, filename) {
        const url = URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = url;
        a.download = filename;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
      }

      // Function to download all images in batch
      async function downloadAllImages() {
        const outputItems = document.querySelectorAll(".output-item");
        const downloadPromises = [];

        if (outputItems.length === 0) {
          alert("No images to download");
          return;
        }

        // Update button to show downloading progress
        const batchBtn = document.querySelector(".batch-download-btn");
        const originalText = batchBtn.innerHTML;
        batchBtn.innerHTML = '<i data-lucide="download" class="tabs-icon"></i> Downloading...';
        batchBtn.disabled = true;
        window.lucide.createIcons();

        for (let i = 0; i < outputItems.length; i++) {
          const outputItem = outputItems[i];
          const iframe = outputItem.querySelector("iframe");

          // Get dataUrl from iframe or textToImagePluginOutput
          let dataUrl = "";
          if (iframe && iframe.textToImagePluginOutput && iframe.textToImagePluginOutput.dataUrl) {
            dataUrl = iframe.textToImagePluginOutput.dataUrl;
          } else if (typeof textToImagePluginOutput !== "undefined" && textToImagePluginOutput.dataUrl) {
            dataUrl = textToImagePluginOutput.dataUrl;
          }

          if (dataUrl) {
            const downloadPromise = dataUrlToBlob(dataUrl).then((blob) => {
              const timestamp = new Date().toISOString().replace(/[:.]/g, "-").slice(0, -5);
              const filename = `generated-image-${i + 1}-${timestamp}.png`;
              downloadBlob(blob, filename);
            });

            downloadPromises.push(downloadPromise);
          }
        }

        try {
          await Promise.all(downloadPromises);

          // Restore button to original state
          batchBtn.innerHTML = originalText;
          batchBtn.disabled = false;

          // Show success notification
          showNotification(`Successfully downloaded ${downloadPromises.length} images!`);
        } catch (error) {
          console.error("Error downloading images:", error);
          batchBtn.innerHTML = originalText;
          batchBtn.disabled = false;
          alert("An error occurred while downloading images");
        }
      }

      // Function to show notification (optional)
      function showNotification(message) {
        // Create notification element
        const notification = document.createElement("div");
        notification.textContent = message;
        notification.style.cssText = `
    position: fixed;
    top: 20px;
    right: 20px;
    background-color: #4CAF50;
    color: white;
    padding: 12px 20px;
    border-radius: 2px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.2);
    z-index: 1000;
    font-size: 14px;
    transition: opacity 0.3s ease;
  `;

        document.body.appendChild(notification);

        // Remove notification after 3 seconds
        setTimeout(() => {
          notification.style.opacity = "0";
          setTimeout(() => {
            document.body.removeChild(notification);
          }, 300);
        }, 3000);
      }

      function renderOutputsInBatches(outputs, batchSize = 2, delay = 50) {
        const outputContainer = document.getElementById("outputContainer");
        let index = 0;

        function renderNextBatch() {
          const fragment = document.createDocumentFragment();
          
          const end = Math.min(index + batchSize, outputs.length);
          for (let i = index; i < end; i++) {
            const output = outputs[i];

            const outputDiv = document.createElement("div");
            outputDiv.className = "output-item";

            // HTML content with roleplay button
            let htmlContent = `<div>${output}</div>`;
            htmlContent += `
              <div style="display: flex; justify-content: center; margin-top: .5em;">
                <button class="roleplayChat"
                  style="
                    font-size: 0.6rem;
                    background-color: #fdfdfd;
                    color: #555;
                    padding:4px 12px;
                    margin:0.2em auto;
                    border-radius:4px;
                    border:2px solid var(--primary-color,#cb9952);
                  ">
                  <i data-lucide="swords" class="tabs-icon"></i> Roleplay
                </button>
              </div>
            `;

            outputDiv.innerHTML = htmlContent;
           fragment.appendChild(outputDiv);
          }

          outputContainer.appendChild(fragment);

          // Re-init lucide icons after batch insert
          window.lucide?.createIcons();

          // Attach event listeners (could also use event delegation)
          const newButtons = outputContainer.querySelectorAll(".roleplayChat");
          newButtons.forEach(btn => {
            if (!btn._listenerAttached) {
              btn._listenerAttached = true;
              btn.addEventListener("click", function () {
                const outputItem = this.closest(".output-item");
                const iframe = outputItem.querySelector("iframe");
                const outputData = iframe && iframe.textToImagePluginOutput ? iframe.textToImagePluginOutput : typeof textToImagePluginOutput !== "undefined" ? textToImagePluginOutput : null;
                roleplayContainer(outputData);
              });
            }
          });

          index = end;

          if (index < outputs.length) {
            setTimeout(() => requestAnimationFrame(renderNextBatch), delay);
          } else {
            console.log("All outputs rendered.");
          }
        }

        requestAnimationFrame(renderNextBatch);
      }

      // Modify existing generate() function
      async function generate() {
        generateBtn.textContent = "Imagining";
        generateBtn.classList.add("imagining-ellipsis");
        generateBtn.disabled = true;

        if (!document.querySelector("#styleOptionsEl .style-option.selected")) {
          document.querySelector("#styleOptionsEl .style-option").click();
        }

        const cleanUserInput = (input) => {
          return input.replace(/[\[\]]/g, (match) => "\\" + match);
        };

        evaluateAllVar = cleanUserInput(userPromptInput.value || "");
        userPrompt = [selectedStyle, selectedThemes, evaluateAllVar, combinedPrompt].filter((x) => x && x.trim()).join(", ");
        let currentNegativePrompt = cleanUserInput(negativePromptInput.value || "");
        negativePrompt = (hiddenNegativePrompt ? hiddenNegativePrompt + ", " : "") + currentNegativePrompt;

        if (!userPrompt) {
          userPrompt = localStorage.evaluateAllVar || "";
        }
        if (!negativePrompt) {
          negativePrompt = localStorage.currentNegativePrompt || "";
        }

        localStorage.userPrompt = evaluateAllVar;
        localStorage.negativePrompt = currentNegativePrompt;

        const outputCount = parseInt(document.getElementById("outputCount").value, 10);

        await new Promise((resolve) => setTimeout(resolve, 2200));

        generateBtn.classList.remove("imagining-ellipsis");
        generateBtn.innerHTML = `<i data-lucide="sparkles" class="tabs-icon" style="margin-right: 0.3rem"></i> Imagine`;
        window.lucide.createIcons();
        generateBtn.disabled = false;

        // --- OUTPUT HANDLING FOR PERCHANCE STYLE ---
        const outputContainer = document.getElementById("outputContainer");
        outputContainer.innerHTML = "";

        // CLEANUP: Remove existing batch download button if exists
        const existingBatchDiv = document.querySelector(".batch-download-container");
        if (existingBatchDiv) {
          existingBatchDiv.remove();
        }

        // Show outputContainer
        outputContainer.style.display = "grid";

        // Add Download in Batches button above output container
        const batchDownloadDiv = document.createElement("div");
        batchDownloadDiv.className = "batch-download-container"; // Add class for easy cleanup
        batchDownloadDiv.style.cssText = `
          display: flex;
          justify-content: center;
          margin-bottom: 1rem;
          padding: 0.5rem;
        `;

        batchDownloadDiv.innerHTML = `
          <button class="batch-download-btn"
            style="
              font-size: 0.8rem;
              background-color: #2196F3;
              color: white;
              padding: 8px 16px;
              margin-top: 1rem;
              border: none;
              border-radius: 2px;
              cursor: pointer;
              transition: background-color 0.3s ease;
              font-weight: 500;"
            onmouseover="this.style.backgroundColor='#1976D2'"
            onmouseout="this.style.backgroundColor='#2196F3'">
            <i data-lucide="download" class="tabs-icon"></i> Download in Batches
          </button>
        `;

        // Insert before outputContainer
        outputContainer.parentNode.insertBefore(batchDownloadDiv, outputContainer);

        // Attach event listener for batch download
        const batchBtn = batchDownloadDiv.querySelector(".batch-download-btn");
        batchBtn.addEventListener("click", downloadAllImages);

        const outputs = Array.from({ length: outputCount }, getOutput);
        renderOutputsInBatches(outputs, 2, 50); // tweak batch size and delay as needed
        
        // Render icons for batch download button
        window.lucide.createIcons();
      }

      // Function to handle image generation process and save prompts to localStorage
      /*async function generate() {
        generateBtn.textContent = "Imagining";
        generateBtn.classList.add("imagining-ellipsis");
        generateBtn.disabled = true;

        if (!document.querySelector("#styleOptionsEl .style-option.selected")) {
          document.querySelector("#styleOptionsEl .style-option").click();
        }

        const cleanUserInput = (input) => {
          // Ganti [ menjadi \[ , ] menjadi \]
            return input.replace(/[\[\]]/g, (match) => "\\" + match);
        };
        
        evaluateAllVar = cleanUserInput(userPromptInput.value || "");

        userPrompt = [selectedStyle, selectedThemes, evaluateAllVar, combinedPrompt].filter((x) => x && x.trim()).join(", ");
        let currentNegativePrompt = cleanUserInput(negativePromptInput.value || "");

        negativePrompt = (hiddenNegativePrompt ? hiddenNegativePrompt + ", " : "") + currentNegativePrompt;

        if (!userPrompt) {
          userPrompt = localStorage.evaluateAllVar || "";
        }
        if (!negativePrompt) {
          negativePrompt = localStorage.currentNegativePrompt || "";
        }

        localStorage.userPrompt = evaluateAllVar;
        localStorage.negativePrompt = currentNegativePrompt;

        const outputCount = parseInt(document.getElementById("outputCount").value, 10);

        await new Promise((resolve) => setTimeout(resolve, 2200));

        generateBtn.classList.remove("imagining-ellipsis");
        generateBtn.innerHTML = `<i data-lucide="sparkles" class="tabs-icon" style="margin-right: 0.3rem"></i> Imagine`;
        window.lucide.createIcons();
        generateBtn.disabled = false;

        // --- OUTPUT HANDLING FOR PERCHANCE STYLE ---
        const outputContainer = document.getElementById("outputContainer");
        outputContainer.innerHTML = "";

        // Munculkan outputContainer
        outputContainer.style.display = "grid";

        for (let i = 0; i < outputCount; i++) {
          const output = getOutput(); // Pastikan variabel 'output' ini terdefinisi di scope yang benar
          const outputDiv = document.createElement("div");
          outputDiv.className = "output-item";
          // Output utama
          let htmlContent = `<div>${output}</div>`;
          // Tambah Roleplay button setelah isi

          htmlContent += `
            <div style="display: flex; justify-content: center; margin-top: .5em;">
              <button class="roleplayChat"
                style="
                font-size: 0.6rem;
                background-color: #fdfdfd;
                color: #555;
                padding:4px 12px;
                margin:0.2em auto;
                border-radius:4px;border:2px solid var(--primary-color,#cb9952);
                ">
                <i data-lucide="swords" class="tabs-icon"></i> Roleplay
              </button>
            </div>
          `;

          // Masukkan HTML gabungan ke div utama
          outputDiv.innerHTML = htmlContent;
          // Append ke container
          outputContainer.appendChild(outputDiv);
          // Render the lucide icons
          window.lucide.createIcons();
          // Attach event handler with iframe output data
          let roleBtn = outputDiv.querySelector(".roleplayChat");
          roleBtn.addEventListener("click", function () {
            // Find the iframe within the parent output item
            const outputItem = this.closest('.output-item');
            const iframe = outputItem.querySelector('iframe');
            // Get textToImagePluginOutput from iframe if available
            const outputData = iframe && iframe.textToImagePluginOutput ? 
                                iframe.textToImagePluginOutput : 
                                (typeof textToImagePluginOutput !== 'undefined' ? textToImagePluginOutput : null);
            roleplayContainer(outputData);
          });
        }
      }*/

      // Sembunyikan saat initial load
      window.addEventListener("DOMContentLoaded", function () {
        const outputContainer = document.getElementById("outputContainer");
        if (outputContainer) outputContainer.style.display = "none";
      });

      function getOutput() {
        return typeof output !== "undefined" ? [output].join("") : "Generated content placeholder";
      }

      function roleplayContainer(outputData) {
        // Cek apakah popup sudah ada, jika ya hapus dulu
        const existingPopup = document.querySelector(".rp-popup-overlay");
        if (existingPopup) {
          existingPopup.remove();
        }

        // Buat overlay popup
        const overlay = document.createElement("div");
        overlay.className = "rp-popup-overlay";
        overlay.style.cssText = `
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.5);
    backdrop-filter: blur(4px);
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: 9999;
    opacity: 0;
    transition: opacity 0.3s ease;
  `;

        // Buat container popup
        const popup = document.createElement("div");
        popup.className = "rp-popup-container";
        popup.style.cssText = `
    background: #fdfdfd;
    border-radius: 12px;
    border: 2px solid var(--primary-color, #cb9952);
    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.2);
    width: 90%;
    max-width: 480px;
    max-height: 90vh;
    overflow: hidden;
    transform: scale(0.9) translateY(20px);
    transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
    position: relative;
  `;

        // Header
        const header = document.createElement("div");
        header.style.cssText = `
    background: linear-gradient(135deg, var(--primary-color, #cb9952), #d4a665);
    color: white;
    padding: 20px 24px;
    font-weight: 600;
    font-size: 1.1rem;
    display: flex;
    align-items: center;
    gap: 12px;
  `;
        header.innerHTML = `
    <i data-lucide="swords" style="width: 20px; height: 20px;"></i>
    Create Roleplay Character
  `;

        // Body container
        const body = document.createElement("div");
        body.style.cssText = `
    padding: 24px;
    overflow-y: auto;
    max-height: calc(90vh - 140px); /* Adjusted for header and footer */
  `;

        // Form fields
        const form = document.createElement("div");
        form.style.cssText = `
    display: flex;
    flex-direction: column;
    gap: 20px;
  `;

        // Name field
        const nameGroup = document.createElement("div");
        nameGroup.innerHTML = `
    <label style="
      display: block;
      margin-bottom: 8px;
      font-weight: 500;
      color: #333;
      font-size: 0.9rem;
    "><i class="fa-regular fa-address-book"></i> Character Name</label>
    <input type="text" id="rp-name" placeholder="Enter character name..." style="
      width: 100%;
      padding: 12px 16px;
      border: 2px solid #e0e0e0;
      border-radius: 8px;
      font-size: 0.9rem;
      color: #555;
      transition: all 0.2s ease;
      background: #fafafa;
      box-sizing: border-box;
    ">
  `;

        // Additional Instructions field
        const instructionsGroup = document.createElement("div");
        instructionsGroup.innerHTML = `
    <label style="
      display: block;
      margin-bottom: 8px;
      font-weight: 500;
      color: #333;
      font-size: 0.9rem;
    "><i class="fa-regular fa-pen-to-square"></i> Additional Instructions</label>
    <textarea id="rp-instructions" placeholder="Describe character personality, background, or special traits..." style="
      width: 100%;
      padding: 12px 16px;
      border: 2px solid #e0e0e0;
      border-radius: 8px;
      font-size: 0.9rem;
      color: #555;
      min-height: 80px;
      max-height: 160px;
      resize: vertical;
      transition: all 0.2s ease;
      background: #fafafa;
      font-family: inherit;
      box-sizing: border-box;
    "></textarea>
  `;

        // Results field
        const resultsGroup = document.createElement("div");
        resultsGroup.innerHTML = `
    <label style="
      display: none;
      margin-bottom: 8px;
      font-weight: 500;
      color: #333;
      font-size: 0.9rem;
    "><i class="fa-regular fa-lightbulb"></i> Overview</label>
    <textarea id="rp-results" placeholder="What kind of responses or behavior do you expect?" style="
      display: none;
      width: 100%;
      padding: 12px 16px;
      border: 2px solid #e0e0e0;
      border-radius: 8px;
      font-size: 0.9rem;
      min-height: 60px;
      max-height: 120px;
      resize: vertical;
      transition: all 0.2s ease;
      background: #fafafa;
      font-family: inherit;
      box-sizing: border-box;
    "></textarea>
  `;

        // Progress indicator (hidden initially)
        const progressGroup = document.createElement("div");
        progressGroup.id = "rp-progress";
        progressGroup.style.cssText = `
    display: none;
    text-align: center;
    padding: 20px;
    background: #f8f9fa;
    border-radius: 8px;
    border: 1px solid #e9ecef;
  `;
        progressGroup.innerHTML = `
    <div style="margin-bottom: 12px;">
      <i data-lucide="loader" style="width: 24px; height: 24px; color: var(--primary-color, #cb9952); animation: spin 1s linear infinite;"></i>
    </div>
    <div id="progress-text" style="font-size: 0.9rem; color: #666;">Creating character...</div>
    <style>
      @keyframes spin {
        from { transform: rotate(0deg); }
        to { transform: rotate(360deg); }
      }
    </style>
  `;

        // Footer dengan tombol
        const footer = document.createElement("div");
        footer.style.cssText = `
    padding: 20px 24px;
    border-top: 1px solid #f0f0f0;
    display: flex;
    gap: 12px;
    justify-content: flex-end;
    background: #fafafa;
  `;

        // Tombol CLOSE
        const closeBtn = document.createElement("button");
        closeBtn.innerHTML = `<i class="fa-solid fa-xmark"></i> Close`;
        closeBtn.style.cssText = `
    padding: 10px 20px;
    border: 2px solid #ddd;
    background: white;
    color: #666;
    border-radius: 6px;
    font-weight: 500;
    font-size: 0.9rem;
    cursor: pointer;
    transition: all 0.2s ease;
    min-width: 100px;
  `;

        // Tombol STOP (hidden initially)
        const stopBtn = document.createElement("button");
        stopBtn.innerHTML = `<i class="fa-solid fa-stop"></i> Stop`;
        stopBtn.style.cssText = `
    padding: 10px 20px;
    border: 2px solid #dc3545;
    background: #dc3545;
    color: white;
    border-radius: 6px;
    font-weight: 500;
    font-size: 0.9rem;
    cursor: pointer;
    transition: all 0.2s ease;
    min-width: 100px;
    display: none;
  `;

        // Tombol CREATE
        const createBtn = document.createElement("button");
        createBtn.innerHTML = `<i class="fa-regular fa-paper-plane"></i> Create`;
        createBtn.style.cssText = `
    padding: 10px 20px;
    border: 2px solid var(--primary-color, #cb9952);
    background: var(--primary-color, #cb9952);
    color: white;
    border-radius: 6px;
    font-weight: 500;
    font-size: 0.9rem;
    cursor: pointer;
    transition: all 0.2s ease;
    min-width: 100px;
  `;

        // Assemble form
        form.appendChild(nameGroup);
        form.appendChild(instructionsGroup);
        form.appendChild(resultsGroup);
        form.appendChild(progressGroup);

        // Assemble footer
        footer.appendChild(closeBtn);
        footer.appendChild(stopBtn);
        footer.appendChild(createBtn);

        // Assemble body
        body.appendChild(form);

        // Assemble popup
        popup.appendChild(header);
        popup.appendChild(body);
        popup.appendChild(footer);

        // Assemble overlay
        overlay.appendChild(popup);

        // Add to document
        document.body.appendChild(overlay);

        // Initialize Lucide icons
        if (window.lucide) {
          window.lucide.createIcons();
        }

        // Animasi masuk
        requestAnimationFrame(() => {
          overlay.style.opacity = "1";
          popup.style.transform = "scale(1) translateY(0)";
        });

        // Event listeners untuk input focus effects
        const inputs = popup.querySelectorAll("input, textarea");
        inputs.forEach((input) => {
          input.addEventListener("focus", function () {
            this.style.borderColor = "var(--primary-color, #cb9952)";
            this.style.background = "white";
            this.style.boxShadow = "0 0 0 3px rgba(203, 153, 82, 0.1)";
          });

          input.addEventListener("blur", function () {
            this.style.borderColor = "#e0e0e0";
            this.style.background = "#fafafa";
            this.style.boxShadow = "none";
          });
        });

        // Event listeners untuk tombol hover effects
        closeBtn.addEventListener("mouseenter", function () {
          this.style.background = "#f5f5f5";
          this.style.borderColor = "#bbb";
        });
        closeBtn.addEventListener("mouseleave", function () {
          this.style.background = "white";
          this.style.borderColor = "#ddd";
        });

        createBtn.addEventListener("mouseenter", function () {
          if (!this.disabled) {
            this.style.background = "#b8854a";
            this.style.transform = "translateY(-1px)";
            this.style.boxShadow = "0 4px 12px rgba(203, 153, 82, 0.3)";
          }
        });
        createBtn.addEventListener("mouseleave", function () {
          if (!this.disabled) {
            this.style.background = "var(--primary-color, #cb9952)";
            this.style.transform = "translateY(0)";
            this.style.boxShadow = "none";
          }
        });

        stopBtn.addEventListener("mouseenter", function () {
          this.style.background = "#c82333";
          this.style.transform = "translateY(-1px)";
        });
        stopBtn.addEventListener("mouseleave", function () {
          this.style.background = "#dc3545";
          this.style.transform = "translateY(0)";
        });

        // Close popup function
        function closePopup() {
          if (currentRoleplayRequest) {
            currentRoleplayRequest.abort();
            currentRoleplayRequest = null;
          }
          overlay.style.opacity = "0";
          popup.style.transform = "scale(0.9) translateY(20px)";
          setTimeout(() => {
            overlay.remove();
          }, 300);
        }

        // Show progress function
        function showProgress(text) {
          const progressEl = document.getElementById("rp-progress");
          const progressTextEl = document.getElementById("progress-text");
          if (progressEl) progressEl.style.display = "block";
          if (progressTextEl) progressTextEl.textContent = text;

          createBtn.style.display = "none";
          stopBtn.style.display = "inline-block";
          inputs.forEach((input) => (input.disabled = true));
          if (window.lucide) window.lucide.createIcons();
        }

        // Hide progress function
        function hideProgress() {
          const progressEl = document.getElementById("rp-progress");
          if (progressEl) progressEl.style.display = "none";

          createBtn.style.display = "inline-block";
          stopBtn.style.display = "none";
          inputs.forEach((input) => (input.disabled = false));
        }

        // Event listeners untuk tombol
        closeBtn.addEventListener("click", closePopup);

        stopBtn.addEventListener("click", function () {
          if (currentRoleplayRequest) {
            currentRoleplayRequest.abort();
            currentRoleplayRequest = null;
          }
          hideProgress();
          const progressTextEl = document.getElementById("progress-text");
          if (progressTextEl) progressTextEl.textContent = "Creation stopped.";
          const progressEl = document.getElementById("rp-progress");
          if (progressEl) {
            progressEl.style.display = "block"; // Tampilkan pesan stop sementara
            setTimeout(() => {
              if (progressEl) progressEl.style.display = "none";
            }, 2000);
          }
        });

        overlay.addEventListener("click", function (e) {
          if (e.target === overlay) closePopup();
        });

        const escHandler = function (e) {
          if (e.key === "Escape") {
            closePopup();
            document.removeEventListener("keydown", escHandler);
          }
        };
        document.addEventListener("keydown", escHandler);

        createBtn.addEventListener("click", async function () {
          const name = document.getElementById("rp-name").value.trim();
          const instructions = document.getElementById("rp-instructions").value.trim();
          const results = document.getElementById("rp-results").value.trim();

          if (!name) {
            const nameInput = document.getElementById("rp-name");
            nameInput.focus();
            nameInput.style.borderColor = "#e74c3c";
            return;
          }

          showProgress("Creating character...");

          try {
            await getRoleplayResponse({ name, instructions, results }, outputData);
            // Popup akan ditutup oleh getRoleplayResponse jika sukses
            // Jika ingin menutupnya dari sini setelah beberapa saat:
            // setTimeout(closePopup, 1500); // Contoh penutupan setelah sukses
          } catch (error) {
            // Error handling sudah dilakukan di dalam getRoleplayResponse
            // Tidak perlu duplikasi di sini kecuali untuk logic spesifik lainnya
            console.error("Error caught in createBtn click:", error);
            // UI error sudah dihandle di getRoleplayResponse,
            // tapi pastikan hideProgress dipanggil jika error tidak ditangani getRoleplayResponse
            // dan tidak ada `throw` di catch getRoleplayResponse
            if (document.getElementById("rp-progress").style.display !== "none" && document.getElementById("progress-text").textContent.startsWith("Error")) {
              // Error sudah ditampilkan, jangan sembunyikan progres langsung
            } else {
              hideProgress(); // Sembunyikan jika error tidak terduga
            }
          }
        });

        setTimeout(() => {
          const nameInput = document.getElementById("rp-name");
          if (nameInput) nameInput.focus();
        }, 350);
      }

      async function getRoleplayResponse(data, outputData) {
        const { name, instructions, results } = data;
        const progressTextEl = document.getElementById("progress-text");
        const progressEl = document.getElementById("rp-progress");

        try {
          if (progressTextEl) progressTextEl.textContent = "Generating character description...";
          currentRoleplayRequest = new AbortController();

          // Variabel evaluateAllVar dan combinedPrompt harus tersedia di scope ini
          // Jika tidak, Anda perlu mengambilnya lagi atau meneruskannya ke fungsi ini
          const currentEvaluateAllVar = typeof evaluateAllVar !== "undefined" ? evaluateAllVar : localStorage.userPrompt || "";
          const currentCombinedPrompt = typeof combinedPrompt !== "undefined" ? combinedPrompt : "";

          const aiInstruction = `
TASK: The user has created an image of a character using a prompt. The prompt is shown below. Your task is to use the character personality hints in the prompt to generate a character description for roleplaying with. Your description should ideally include personality, appearance, speech examples/mannerisms, etc. such that an actor could read it and know how to roleplay as the character in all relevant aspects. Use an information-dense writing style to *succinctly* capture all aspects of the personality of the character that you generate. Your description should be between 200 and 600 words in length. Do your best to generate a character based on what you see below. Follow the hints in the user's image prompt to accurately capture the details that are most important to a character chat/roleplay.

--- START OF IMAGE PROMPT ---
${currentEvaluateAllVar}, ${currentCombinedPrompt}
--- END OF IMAGE PROMPT ---

Reminder: Your task is to generate a character that is inspired by the above image prompt. Your response should describe how the character looks/acts/speaks/behaves such that if someone read it, they would be able to accurately emulate or roleplay as the target character's mannerisms, personality, etc. No more than 600 words.
${instructions ? `\nBut also, the character must be based on this instruction: ${instructions}\n` : ""}

Use this template for your response:
# Name: ${name}

# Visual Description:
(A SHORT paragraph describing what they look like - keep this short, concise and to-the-point. Low word count, high information density. Avoid using purple prose and overly flowery descriptions.)

# Personality Description:
(ONE paragraph personality description. Use mainly short sentences - i.e. write in an information-dense style. Focus on the aspects that make them unique/interesting. If relevant, you can use terms like tsundere, yandere, kuudere, deredere, dandere, genki girl, kuudere, seme, uke, megane, chuunibyou, clumsy heroine, superiority complex, dominant, submissive, etc. to succinctly capture aspects of their personality. Invent a few interesting aspects, use creative liberty to create a character that has genuine depth, with idiosyncrasies, goals, fears, likes, dislikes, ethics, etc. Remember, your goal is to create a character that would be fun for the user to roleplay with! Follow the user's lead based on their initial idea, but take it one step further to surprise and excite them.)

# Roleplay Behavior Examples:
(A numbered list of 5 separate and diverse examples of character speech/behavior, each starting with an asterisk or double-quote, which place the character in random roleplay situations, as if you've extracted random & diverse moments from a story, with sufficient context captured by the dialogue and actions themselves, to show the essence of who they are as a character, how they speak/act/react/etc. Each example should perfectly capture one aspect of who they are as a character. Each example should be its own separate moment from a hypothetical story, unrelated to the other examples that you write. You must use asterisks around actions and quotes around speech in typical roleplay style.)
    `.trim();

          const response = await fetch("https://text.pollinations.ai/openai", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({
              model: "mistral",
              messages: [{ role: "system", content: aiInstruction }],
            }),
            signal: currentRoleplayRequest.signal,
          });

          if (!response.ok) throw new Error(`API request failed: ${response.status} ${response.statusText}`);
          const responseData = await response.json();
          const resultAPI = responseData.choices[0]?.message?.content || responseData.content || "";
          if (!resultAPI) throw new Error("No content received from API");

          if (progressTextEl) progressTextEl.textContent = "Building character data...";
          const roleInstruction = `
# Description of ${name}:
${resultAPI}

# Roleplay Guidelines:
- Bring characters to life by realistically portraying their unique traits, thoughts, emotions, appearances, physical sensations, speech patterns, and tone. Consider the situation, characters' motivations, and potential consequences.
- Ensure that their reactions, interactions, and decision-making align with their established personalities/descriptions, values, goals, and fears. You must **ALWAYS** maintain accurate character portrayals. Creatively improvise this fictional roleplay between {{char}} and {{user}} to create an interesting and engaging experience/story/chat, no matter where {{user}} decides to lead it. The overall goal is to create a genuinely fascinating and engaging roleplay/story. So good that you can't stop reading. Be proactive, introducing new events, proposing new conversation topics, and leading the role-play in new, interesting directions when appropriate to keep the overall experience engaging.
    `.trim();

          const universalReminder = `
**Visual Generation**  
- After {{char}}/NPCs dialogue, create a visual <image> using:  
'From a first person perspective... [create extremely detailed image here but mostly focus on {{char}} description]</image>'  

**Memory Consistency**  
- Maintain **exact {{char}} attributes** (name, age, etc.) across all interactions. Avoid sudden alterations or omissions.  

**Role Constraints**  
- {{char}}/NPCs **never decide** for {{user}}. Strictly preserve their personality, behavior, and role.  

**Perspective**
- {{char}} speaks and acts in second person towards {{user}}.

**Dialogue Rules**  
- {{char}} improvise **dynamic, immersive speech**. Avoid repetitive dialogue patterns (enforced by negative reinforcement).  

---  

Format: '<image>...</image>' after {{char}}/NPCs speech part.
`;

          // Use the passed outputData if available, otherwise fall back to global textToImagePluginOutput
          const characterImageDataUrl = outputData && outputData.dataUrl ? 
                                        outputData.dataUrl : 
                                        (typeof textToImagePluginOutput !== 'undefined' ? textToImagePluginOutput.dataUrl : '');


          let backgroundImgUrl = '';
          
          // Konversi base64 Data URL ke Blob
          function dataUrlToBlob(dataUrl) {
            const arr = dataUrl.split(',');
            const mime = arr[0].match(/:(.*?);/)[1];
            const bstr = atob(arr[1]);
            let n = bstr.length;
            const u8arr = new Uint8Array(n);
            while (n--) {
              u8arr[n] = bstr.charCodeAt(n);
            }
            return new Blob([u8arr], { type: mime });
          }
          
          if (characterImageDataUrl) {
            const imageBlob = dataUrlToBlob(characterImageDataUrl);
            // Buat file dari Blob (bisa pakai nama custom kalau mau)
            const imageFile = new File([imageBlob], 'character.jpg', { type: 'image/jpeg' });
            
            // Upload dan ambil URL
            const { url } = await upload(imageFile);
            backgroundImgUrl = url;
          }
                                        
          const currentSelectedStyle = typeof selectedStyle !== "undefined" ? selectedStyle : "";
          const currentSelectedThemes = typeof selectedThemes !== "undefined" ? selectedThemes : "";

          const jsonData = {  
            addCharacter: {  
              name,  
              roleInstruction,  
              maxParagraphCountPerMessage: 2,  
              reminderMessage: `${universalReminder}`,  
              imagePromptSuffix: `${currentSelectedStyle || ""}, ${currentSelectedThemes || ""}, (resolution:::512x768)`.replace(/^,\s*|,\s*$/g, ""),  
              messageWrapperStyle: "color: #ffffff; background: rgba(0, 0, 0, 0.65); font-family: 'Public Sans', sans-serif; border-left: 3px solid #a1a1aa; border-radius: 4px; padding: 0.5rem; font-size: clamp(0.875rem, 2.5vw, 1.125rem); line-height: 1.4;",  
              initialMessages: [  
                {  
                  author: "system",  
                  content: `<i style="font-size:85%;">Introduce yourself to ${name}, or perhaps <b style="color:#00af00;">tap the Narrator button</b> and tell it to generate an initial roleplay scenario based on some keywords/themes. You can change your name using the 'options' button.</i>`,  
                  hiddenFrom: ["ai"],  
                },  
              ],  
              avatar: { url: characterImageDataUrl, size: 1, shape: "square" },  
              scene: {  
                background: {  
                  url: backgroundImgUrl
                },  
                music: {  
                  url: ""  
                }  
              },  
            },  
            quickAdd: true,  
          };

          if (progressTextEl) progressTextEl.textContent = "Compressing and uploading character...";
          const jsonString = JSON.stringify(jsonData);

          if (typeof pako === "undefined") {
            console.error("Pako library is not loaded. Please include it in your HTML.");
            throw new Error("Compression library (Pako) not available.");
          }
          const encoder = new TextEncoder();
          const jsonUint8Array = encoder.encode(jsonString);
          const compressedData = pako.gzip(jsonUint8Array); // Ini menghasilkan Uint8Array
          const blob = new Blob([compressedData], { type: "application/gzip" }); // Buat Blob dari data terkompresi

          if (typeof upload !== "function") {
            console.error("The 'upload' function is not defined.");
            throw new Error("Upload function not available. This function is required to send the compressed data.");
          }

          // Buat nama file yang aman dan unik dengan ekstensi .gz
          const safeName = name.replace(/[^a-zA-Z0-9_-]/g, "_") || "character";
          const suggestedFilename = `${safeName}_${Date.now()}.gz`;

          // Panggil fungsi upload dengan blob dan nama file yang disarankan
          const uploadResult = await upload(blob, suggestedFilename); // uploadResult diharapkan berupa URL string atau objek dengan URL/nama file
          console.log("Upload result:", uploadResult);

          let uploadedFilenameGz = "";
          const fileUrl = uploadResult.url;
          const parts = fileUrl.split('/');
          
          uploadedFilenameGz = parts[parts.length - 1];
          
          if (!uploadedFilenameGz.endsWith('.gz')) {
            throw new Error(`Nama file tidak diakhiri .gz: ${uploadedFilenameGz}`);
          }
          
          const finalLink = `https://perchance.org/ai-character-chat?data=${encodeURIComponent(name)}~${encodeURIComponent(uploadedFilenameGz)}`;
          console.log('Final link:', finalLink);
          
          if (progressTextEl && progressEl) {
            progressEl.style.background = "#e6ffe6"; // Success background
            progressEl.style.borderColor = "#b3ffb3"; // Success border
            progressTextEl.innerHTML = `
        Character created successfully!
        <br><br>
        <a href="${finalLink}" target="_blank" style="
          color: var(--primary-color, #cb9952); text-decoration: none; font-weight: 600;
          padding: 8px 16px; border: 2px solid var(--primary-color, #cb9952);
          border-radius: 6px; display: inline-block; margin-top: 8px; margin-bottom: 12px; transition: all 0.2s ease;
        " onmouseover="this.style.background='var(--primary-color, #cb9952)'; this.style.color='white';"
           onmouseout="this.style.background='transparent'; this.style.color='var(--primary-color, #cb9952)';">
          🎭 Chat with ${name}
        </a>`;

            const copyBtn = document.createElement("button");
            copyBtn.innerHTML = "📋 Copy Link";
            copyBtn.style.cssText = `
        margin-left: 10px; padding: 8px 16px; border: 2px solid #6c757d;
        background: #6c757d; color: white; border-radius: 6px;
        font-size: 0.85rem; cursor: pointer; transition: all 0.2s ease; vertical-align: middle;`;
            copyBtn.onclick = () => {
              navigator.clipboard.writeText(finalLink).then(() => {
                copyBtn.innerHTML = "✅ Copied!";
                setTimeout(() => {
                  copyBtn.innerHTML = "📋 Copy Link";
                }, 2000);
              });
            };
            progressTextEl.appendChild(copyBtn);

            // Sembunyikan tombol stop, tampilkan tombol create lagi (atau biarkan seperti ini jika popup akan ditutup)
            const createBtnEl = document.querySelector(".rp-popup-container button:nth-last-child(1)"); // Asumsi tombol Create
            const stopBtnEl = document.querySelector(".rp-popup-container button:nth-last-child(2)"); // Asumsi tombol Stop
            if (createBtnEl) createBtnEl.style.display = "inline-block";
            if (stopBtnEl) stopBtnEl.style.display = "none";
            const inputs = document.querySelectorAll(".rp-popup-container input, .rp-popup-container textarea");
            inputs.forEach((input) => (input.disabled = false));
          }
          currentRoleplayRequest = null;
        } catch (error) {
          console.error("Error creating roleplay character:", error);
          if (progressEl && progressTextEl) {
            progressEl.style.display = "block"; // Pastikan terlihat
            progressEl.style.background = "#ffe6e6"; // Error background
            progressEl.style.borderColor = "#ffb3b3"; // Error border
            progressTextEl.textContent = `Error: ${error.message}. Please check console and try again.`;

            // Kembalikan tombol
            const createBtnEl = document.querySelector(".rp-popup-container button:nth-last-child(1)");
            const stopBtnEl = document.querySelector(".rp-popup-container button:nth-last-child(2)");
            if (createBtnEl) createBtnEl.style.display = "inline-block";
            if (stopBtnEl) stopBtnEl.style.display = "none";
            const inputs = document.querySelectorAll(".rp-popup-container input, .rp-popup-container textarea");
            inputs.forEach((input) => (input.disabled = false));

          }
          currentRoleplayRequest = null;
        }
      }

      // Function to switch submenu
      function switchSubmenu(submenuName) {
        document.querySelectorAll(".submenu").forEach((submenu) => submenu.classList.remove("active"));
        document.querySelectorAll(".UserEl-options").forEach((content) => (content.hidden = true));

        document.querySelector(`.submenu[onclick="switchSubmenu('${submenuName}')"]`).classList.add("active");
        document.getElementById(`${submenuName}Tab`).hidden = false;
      }

      // Loading saved styles from local storage
      function loadSavedStyle() {
        const savedStyle = localStorage.selectedStyle;
        if (savedStyle) {
          const styleElement = document.querySelector(`#styleOptionsEl .style-option[data-value="${savedStyle}"]`);
          if (styleElement) {
            styleElement.classList.add("selected");
          }
        }
      }

      // NSFW popup management
      function closeNsfwPopup() {
        nsfwPopup.hidden = true;
        normalAccess(true);
      }

      if (!localStorage.nsfwAccepted || new Date() - new Date(localStorage.nsfwAccepted) > 1800000) {
        nsfwPopup.hidden = false;
        normalAccess(false);
      }

      function normalAccess(granted) {
        if (granted) {
          document.body.style.overflow = "auto";
          localStorage.nsfwAccepted = new Date();
        } else {
          document.body.style.overflow = "hidden";
        }
      }

      // Function to toggle gallery
      function toggleGallery() {
        const gallery = galleryOptionsEl;
        gallery.classList.toggle("active");
        toggleGalleryBtn.textContent = gallery.classList.contains("active") ? "Hide Gallery" : "Show Gallery";
      }

      // Function to clear userPrompt
      function clearUserPrompt() {
        localStorage.removeItem("userPrompt");
        userPromptInput.value = "";
        userPrompt = "";
      }

      // Function to clear negativePrompt
      function clearNegativePrompt() {
        localStorage.removeItem("negativePrompt");
        negativePromptInput.value = "";
        negativePrompt = "";
      }

      // Function to auto-expand textarea
      function adjustHeight(el) {
        el.style.height = "auto";
        el.style.height = (el.scrollHeight > 40 ? (el.scrollHeight < 200 ? el.scrollHeight : 200) : 40) + "px";
      }

      // Font change logic with localStorage
      function changeFont(font) {
        document.body.style.fontFamily = font;
        localStorage.font = font;
      }

      // Load saved selections
      window.addEventListener("load", () => {
        loadSavedStyle();
        loadSavedInputs();
        applySavedSettings();
        loadBackgroundSettings();
      });

      // Load saved input values from local storage
      function loadSavedInputs() {
        userPromptInput.value = localStorage.userPrompt || "";
        negativePromptInput.value = localStorage.negativePrompt || "";
      }

      // Save input values to local storage
      function saveInputs() {
        localStorage.userPrompt = userPromptInput.value;
        localStorage.negativePrompt = negativePromptInput.value;
      }

      // Function to apply saved settings for background, theme, and font
      function applySavedSettings() {
        if (localStorage.background) {
          document.body.style.background = localStorage.background;
        }
        if (localStorage.themeBorder) {
          document.documentElement.style.setProperty("--primary-color", localStorage.themeBorder);
          runningText.style.color = localStorage.themeBorder;
        }
        if (localStorage.font) {
          document.body.style.fontFamily = localStorage.font;
          fontSelectEl.value = localStorage.font;
        }
      }

      // Load saved background settings
      function loadBackgroundSettings() {
        if (localStorage.backgroundImage) {
          document.body.style.background = `url('${localStorage.backgroundImage}') no-repeat center center fixed`;
          document.body.style.backgroundSize = "cover";
        }
      }

      // Attach event listeners to save inputs before the page unloads
      window.addEventListener("beforeunload", saveInputs);

      const scrollTopBtn = document.getElementById("scrollTopBtn");
      const scrollBottomBtn = document.getElementById("scrollBottomBtn");

      let ticking = false;

      // Scroll event listener optimized with requestAnimationFrame
      window.addEventListener("scroll", () => {
        if (!ticking) {
          requestAnimationFrame(() => {
            const scrollPosition = window.innerHeight + window.scrollY;
            const threshold = document.body.scrollHeight - 1;

            // Update Scroll to Top Button
            if (scrollPosition >= threshold) {
              scrollTopBtn.style.display = "flex";
            } else {
              scrollTopBtn.style.display = "none";
            }

            // Update Scroll to Bottom Button
            if (scrollPosition < threshold) {
              scrollBottomBtn.style.display = "flex";
            } else {
              scrollBottomBtn.style.display = "none";
            }

            ticking = false;
          });

          ticking = true;
        }
      });

      // Smooth scroll to top
      function scrollToTop() {
        window.scrollTo({ top: 0, behavior: "smooth" });
        scrollTopBtn.style.display = "none"; // Optional: hide button after scrolling
      }

      // Smooth scroll to bottom
      function scrollToBottom() {
        window.scrollTo({ top: document.body.scrollHeight, behavior: "smooth" });
        scrollBottomBtn.style.display = "none"; // Optional: hide button after scrolling
      }

      // Scratchpad and Prompt Toggle functionality
      const toggleButtons = [scratchpadToggleEl, positivePromptToggleEl, negativePromptToggleEl];
      const containers = [scratchpadContainerEl, positivePromptContainerEl, negativePromptContainerEl];

      toggleButtons.forEach((button, index) => {
        button.addEventListener("click", () => {
          const container = containers[index];
          if (container.classList.contains("active")) {
            container.classList.remove("active");
            button.innerHTML = `<i data-lucide="maximize" class="max-min-icon"></i>`;
          } else {
            container.classList.add("active");
            button.innerHTML = `<i data-lucide="minimize" class="max-min-icon"></i>`;
          }
          window.lucide.createIcons();
        });
      });

      // Load saved Scratchpad content from localStorage on page load
      const savedContent = localStorage.getItem("scratchpadContent");
      if (savedContent) {
        scratchpadTextEl.value = savedContent;
      }

      // Save notes to localStorage
      scratchpadSaveEl.addEventListener("click", () => {
        const content = scratchpadTextEl.value;
        localStorage.setItem("scratchpadContent", content);
        alert("Notes saved!");
      });

      function toggleTooltip(event) {
        event.stopPropagation();
        const tooltip = event.currentTarget.querySelector(".tooltip");
        tooltip.classList.toggle("visible");
      }

      // Hide tooltip when clicking outside of it
      document.addEventListener("click", () => {
        const tooltips = document.querySelectorAll(".tooltip.visible");
        tooltips.forEach((tooltip) => tooltip.classList.remove("visible"));
      });

      // Initial Page Loading Screen
      document.addEventListener("DOMContentLoaded", () => {
        const container = document.querySelector(".urChatloadingScreenEl");

        setTimeout(() => {
          container.classList.add("fade-out");
          setTimeout(() => {
            container.style.display = "none";
          }, 600); // waktu fade-out
        }, 3600); // waktu loading screen tampil
      });

      document.addEventListener("contextmenu", function (e) {
        if (e.target.tagName === "IMG") {
          e.preventDefault();
        }
      });

      const toggle = document.getElementById("kofi-toggle");
      const modal = document.getElementById("kofi-modal");
      const close = document.getElementById("kofi-close");
      const panel = document.getElementById("kofi-panel");

      toggle.onclick = () => {
        modal.classList.toggle("open");
        panel.classList.toggle("open");
      };
      close.onclick = () => {
        modal.classList.remove("open");
        panel.classList.remove("open");
      };
      document.addEventListener("click", (e) => {
        if (modal.classList.contains("open") && !modal.contains(e.target) && e.target !== toggle) {
          modal.classList.remove("open");
          panel.classList.remove("open");
        }
      });

      function toggleFullscreen() {
        const elem = document.documentElement;
        const btn = document.getElementById("fullscreenBtn");
        const icon = btn.querySelector("i");

        if (!document.fullscreenElement) {
          // Masuk mode fullscreen
          elem.requestFullscreen().then(() => {
            icon.classList.remove("fa-expand");
            icon.classList.add("fa-compress");
            btn.innerHTML = `<i class="fa-solid fa-compress"></i> Normal`;
          });
        } else {
          // Keluar dari mode fullscreen
          document.exitFullscreen().then(() => {
            icon.classList.remove("fa-compress");
            icon.classList.add("fa-expand");
            btn.innerHTML = `<i class="fa-solid fa-expand"></i> Fullscreen`;
          });
        }
      }

      // Update tombol jika pengguna keluar/masuk fullscreen lewat metode lain (misal F11)
      document.addEventListener("fullscreenchange", () => {
        const btn = document.getElementById("fullscreenBtn");
        if (!btn) return;

        if (document.fullscreenElement) {
          btn.innerHTML = `<i class="fa-solid fa-compress"></i> Normal`;
        } else {
          btn.innerHTML = `<i class="fa-solid fa-expand"></i> Fullscreen`;
        }
      });

      // Function to remember selected outputCount
      window.addEventListener('DOMContentLoaded', () => {
        const dropdown = document.getElementById('outputCount');
        const STORAGE_KEY = 'selectedOutputCount';
  
        if (!dropdown) {
          console.error("Error: Element #outputCount not found!");
          return;
        }

        // Muat nilai yang tersimpan
        const savedValue = localStorage.getItem(STORAGE_KEY);
        if (savedValue && dropdown.querySelector(`option[value="${savedValue}"]`)) {
          dropdown.value = savedValue;
          console.log("Loaded saved value:", savedValue); // Untuk debugging
        }

        // Simpan perubahan
        dropdown.addEventListener('change', () => {
          localStorage.setItem(STORAGE_KEY, dropdown.value);
          console.log("Saved new value:", dropdown.value); // Untuk debugging
        });

        // Pemicu event opsional (pastikan tidak ada side effect)
        setTimeout(() => dropdown.dispatchEvent(new Event('change')), 100);
      });
    </script>
    <script>
      const webThemePopup = document.getElementById('webThemePopupContainer');
      
      function toggleWebThemePopup() {
        if (webThemePopup.classList.contains('active')) {
          webThemePopup.classList.remove('active');
        } else {
          webThemePopup.classList.add('active');
        }
      }
      // Tambahkan event listener untuk menutup popup jika user klik di luar area popup (opsional)
      window.addEventListener('click', function(event) {
        if (webThemePopup.classList.contains('active') && !webThemePopup.contains(event.target) && event.target.id !== 'openWebThemePopupBtn' && !event.target.closest('#openWebThemePopupBtn')) {
          toggleWebThemePopup();
        }
      });
  </script>
  <script>
    /*const audioUrl = 'https://user.uploads.dev/file/254e6943126993a8d34e5ff40fceac39.mp3';
    const cacheName = 'audio-cache-v1';

    async function playCachedAudio() {
      const cache = await caches.open(cacheName);
      let response = await cache.match(audioUrl);

      // Kalau belum ada di cache, fetch dan simpan
      if (!response) {
        console.log('Audio not in cache, fetching...');
        response = await fetch(audioUrl);
        if (response.ok) {
          await cache.put(audioUrl, response.clone());
        } else {
          console.error('Failed to fetch audio:', response.status);
          return;
        }
      } else {
        console.log('Playing cached audio');
      }

      // Buat blob URL dari response dan play
      const blob = await response.blob();
      const blobUrl = URL.createObjectURL(blob);
      const audio = new Audio(blobUrl);
      audio.play().catch(err => {
        console.error('Autoplay failed:', err);
      });
    }

    // Panggil fungsinya saat halaman dimuat
    window.addEventListener('load', () => {
      playCachedAudio();
    });*/
  </script>
  <script>
const marqueeTexts = [
  // Original Quotes
  "Sometimes the wildest imaginations come from the simplest words.",
  "Fear cuts deeper than swords. - George R.R. Martin",
  "Some old wounds never truly heal, and bleed again at the slightest word. - George R.R. Martin",
  "Most men would rather deny a hard truth than face it. - George R.R. Martin",
  "When the snows fall and the white winds blow, the lone wolf dies but the pack survives. - George R.R. Martin",

  // Quotes on Imagination & Creativity
  "Imagination is more important than knowledge. For knowledge is limited, whereas imagination embraces the entire world. - Albert Einstein",
  "The true sign of intelligence is not knowledge but imagination. - Albert Einstein",
  "You can't use up creativity. The more you use, the more you have. - Maya Angelou",
  "Imagination will often carry us to worlds that never were. But without it, we go nowhere. - Carl Sagan",
  "A dream, all a dream, that ends in nothing, and leaves the sleeper where he lay down, but I wish you to know that you inspired it. - Charles Dickens",

  // Quotes on Fear & Courage
  "The only thing we have to fear is fear itself. - Franklin D. Roosevelt",
  "I learned that courage was not the absence of fear, but the triumph over it. The brave man is not he who does not feel afraid, but he who conquers that fear. - Nelson Mandela",
  "He who is not everyday conquering some fear has not learned the secret of life. - Ralph Waldo Emerson",
  "There is no 'what should be,' there is only what is, and what is is the truth. And the truth is a beautiful and terrible thing. - Jordan Peterson",
  "In order to be a realist, you must believe in miracles. - David Ben-Gurion",

  // Quotes on Truth & Wisdom
  "The truth is rarely pure and never simple. - Oscar Wilde",
  "Rather than love, than money, than fame, give me truth. - Henry David Thoreau",
  "The only true wisdom is in knowing you know nothing. - Socrates",
  "All truths are easy to understand once they are discovered; the point is to discover them. - Galileo Galilei",
  "Those who know, do not speak. Those who speak, do not know. - Lao Tzu",

  // Quotes on Hardship, Sacrifice & Strength
  "There is nothing that can be achieved without sacrifice, for even heaven demands death. - Author Unknown",
  "Humankind cannot gain anything without first giving something in return. To obtain, something of equal value must be lost. - Hiromu Arakawa",
  "The world breaks everyone, and afterward, some are strong at the broken places. - Ernest Hemingway",
  "What is to give light must endure burning. - Viktor Frankl",
  "Out of suffering have emerged the strongest souls; the most massive characters are seared with scars. - Kahlil Gibran",
  "The wound is the place where the Light enters you. - Rumi",
  "We are all broken, that's how the light gets in. - Ernest Hemingway",

  // Quotes on Unity & Humanity
  "We are all so much together, but we are all dying of loneliness. - Albert Schweitzer",
  "The needs of the many outweigh the needs of the few, or the one. - Leonard Nimoy (as Spock)",
  "No man is an island, entire of itself; every man is a piece of the continent, a part of the main. - John Donne",
  "If you want to go fast, go alone. If you want to go far, go together. - African Proverb",
  "We can have peace if we let go of wanting to change the past and wanting to control the future. - Lester Levinson"
];

    function startMarqueeLoop(textArray, interval = 15000) {
      const marquee = document.getElementById('runningText');
      if (!marquee || !Array.isArray(textArray) || textArray.length === 0) return;

      let index = 0;

      setInterval(() => {
        index = (index + 1) % textArray.length;
        marquee.textContent = textArray[index];
      }, interval);
    }

    startMarqueeLoop(marqueeTexts);
    </script>
  </body>
</html>


  
